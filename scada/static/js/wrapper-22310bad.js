import{ci as et,d as M,h as w,i as S,F as j,a9 as be,bN as F,n as l,ea as Q,au as V,eb as _e,D as H,ec as Ce,ed as Se,ee as ke,ef as K,eg as Ee,M as Pe,_ as q,ao as tt,z as Le,u as at,r as P,bU as O,eh as ot,V as J,ei as st,o as nt,ej as Ie,a7 as it,ce as rt,f as Y,k as T,t as Re,l as I,w as U,m as lt,bX as dt,p as ct,j as c,aF as ut,ek as B,el as pt,cd as gt,cM as xe,ai as ft,aj as je,S as Te,em as ht,en as mt,eo as $e,__tla as yt}from"./index-35337fd3.js";import{g as ee,__tla as vt}from"./storage-74447fc1.js";import"./querySelectorAll-a0b713c4.js";import{u as $,b as wt,f as bt,C as _t,c as Ct,__tla as St}from"./chartEditStore-a8bbc3da.js";import{l as Ae}from"./listen-42d046d4.js";import{u as kt,__tla as Et}from"./useSync.hook-92e9f5f7.js";import"./plugin-11a308bb.js";import"./icon-ebc544b2.js";import{__tla as Pt}from"./chartLayoutStore-6d3b55f0.js";let Oe,Lt=Promise.all([(()=>{try{return yt}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return St}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return Pt}catch{}})()]).then(async()=>{const te=(e,a)=>({zIndex:a+1,left:`${e.x}px`,top:`${e.y}px`}),X=(e,a)=>({width:`${a?a*e.w:e.w}px`,height:`${a?a*e.h:e.h}px`}),ae=e=>({display:e.hide?"none":"block"}),oe=e=>{const a={};return e&&e.overFlowHidden&&(a.overflow="hidden"),a},se=e=>{const a=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return{position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%",...a}},De=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=e=>{const{keyCode:a}=e;if(a==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(a)&&window.$KeyboardActive)switch(a){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;const g=document.querySelector(".go-preview");g&&g.style.position==="absolute"&&(g.style.cursor="move");break}},document.onkeyup=e=>{const{keyCode:a}=e;if(a==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(a)&&window.$KeyboardActive)switch(a){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}const g=document.querySelector(".go-preview");g&&(g.style.cursor="default")}};let W=[0,0],Z=[0,0];const ne=e=>{const a=document.querySelector(".go-preview");if(!a||a.style.position!=="absolute"||!window.$KeyboardActive?.space)return;e.preventDefault(),e.stopPropagation(),document.activeElement?.blur();const g=e.screenX,t=e.screenY,d=Ae(window,"mousemove",et(_=>{const D=_.screenX-g,L=_.screenY-t,[y,C]=W,[R,A]=Z;if(W=[C,D],Z=[A,L],a){const k=a.style.left?Number(a.style.left.split("px")[0]):0,E=a.style.top?Number(a.style.top.split("px")[0]):0;a.style.left=k+(C>y?Math.abs(C-y):-Math.abs(C-y))+"px",a.style.top=E+(A>R?Math.abs(A-R):-Math.abs(A-R))+"px"}},20)),v=Ae(window,"mouseup",()=>{W=[0,0],Z=[0,0],d(),v()})},Ne=M({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(a,g)=>(w(),S("div",{class:F(l(Q)(e.groupData.styles.animations)),style:V({...l(X)(e.groupData.attr),...l(K)(e.groupData.styles)})},[(w(!0),S(j,null,be(e.groupData.groupList,t=>(w(),S("div",{class:F(["chart-item",l(Q)(t.styles.animations)]),key:t.id,style:V({...l(te)(t.attr,e.groupIndex),...l(ae)(t.status),...l(oe)(t.preview),...l(_e)(t.styles)})},[(w(),H(Pe(t.chartConfig.chartKey),Ce({id:t.id,chartConfig:t,themeSetting:e.themeSetting,themeColor:e.themeColor,style:{...l(X)(t.attr),...l(K)(t.styles),...l(Ee)(t.styles)}},Se(l(ke)(t,l($),t.id))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))],6))}}),Ge=q(Ne,[["__scopeId","data-v-deb2e07f"],["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/preview/components/PreviewRenderGroup/index.vue"]]),Me=$(),Ve=()=>{let e=[],a=[],g=[];return Me.componentList.forEach(t=>{if(t.option.flag==="1"&&t.option.category==="siglePoint")console.log("--",t),e.push({flag:t.option.flag,dataset:t.option.dataset,bindPoint:t.option.bindPoint,id:t.id,category:t.option.category});else if(t.option.flag==="1"&&t.option.category==="multiplePoint"){const d={flag:t.option.flag,bindPointList:t.option.bindPointList,id:t.id,source:t.option.dataset.source.map(v=>({product:v.product,data:v.data,tagId:v.tagId})),category:t.option.category};a.push(d)}else if(t.option.category==="specialComponent"){let d=t.option.bindPointListSpecial,v={bindPoint:"",flag:"",id:"",name:"",dataset:{}};for(let _ in d)d[_]&&(v={flag:t.option.flag,bindPoint:d[_],name:_,id:t.id,dataset:tt(t.option.dataset)},g.push(v))}}),{pointList:e,multiplePointList:a,specialComponentList:g}},He={key:0,class:"box"},Ke={class:"container"},qe={class:"text"},Ue={style:{display:"flex","justify-content":"center","margin-top":"35px"}},Be=["id"],Xe=M({__name:"index",setup(e){const a=Le(),g=at();let t=P(),d=P("");const v=P({password:"",username:"User   "});let _=P(!1);const D=P({password:[{required:!0,message:O.global.t("project.enterSecurityPassword"),trigger:"blur"}]}),L=P([]),y=P([]),C=P([]),{initDataPond:R,clearMittDataPondMap:A}=wt(),k=$(),E=ot(),ue=J(()=>k.editCanvasConfig.chartThemeSetting),pe=J(()=>st(k.editCanvasConfig.chartCustomThemeColorInfo)[k.editCanvasConfig.chartThemeColor]);A();const ge=async()=>{const u=g.projectDetail.id,i=we();E.socket&&E.socket.readyState===WebSocket.OPEN||(E.initWebSocket(i,u),E.socket&&(E.socket.removeEventListener("message",fe),E.socket.removeEventListener("close",he)),E.socket&&(E.socket.addEventListener("message",fe),E.socket.addEventListener("close",he)))},fe=u=>{let i=k.getEditCanvasConfig.keepBad==null?!0:k.getEditCanvasConfig.keepBad;const s=JSON.parse(u.data);if(s.code===200&&Array.isArray(s.data)&&s.msg!="GwOffline"){const b=Array.isArray(s.data)?s.data:[];if(b.length===0)return;const n=new Map;y.value.forEach(h=>{n.has(h.bindPoint)||n.set(h.bindPoint,[]),n.get(h.bindPoint).push(h)});const p=new Map;C.value.forEach(h=>{p.has(h.bindPoint)||p.set(h.bindPoint,[]),p.get(h.bindPoint).push(h)});const o=me();let r=[];b.forEach(h=>{const m=n.get(h.id),f=p.get(h.id),G=o.get(h.id)||[];if(m||G.length>0||f){let x="";x=h.val,i==!1&&(h.status==="Good"?x=h.val:x=k.getEditCanvasConfig.errorToValue);const z=ye(m,G,f,x);r=r.concat(z)}}),ve(r)}else if(s.code===200&&Array.isArray(s.data)&&s.msg=="GwOffline"){if(console.log("\u5E7F\u64AD"),i)return;const b=we(),n=s.data[0];let p=b.filter(f=>f.split(".")[0]==n);if(p.length===0)return;const o=new Map;y.value.forEach(f=>{o.has(f.bindPoint)||o.set(f.bindPoint,[]),o.get(f.bindPoint).push(f)});const r=new Map;C.value.forEach(f=>{r.has(f.bindPoint)||r.set(f.bindPoint,[]),r.get(f.bindPoint).push(f)});const h=me();let m=[];p.forEach(f=>{const G=o.get(f),x=r.get(f),z=h.get(f)||[];if(G||z.length>0||x){let Ze=k.getEditCanvasConfig.errorToValue;const Qe=ye(G,z,x,Ze);m=m.concat(Qe)}}),ve(m)}else{if(typeof s.data=="string")return;window.$message.warning(`${s.code}-${s.message}`);return}},he=()=>{window.$message.error(O.global.t("project.websocketDisconnected"))},me=()=>{const u=new Map;return L.value.forEach(i=>{i.bindPointList.forEach(s=>{u.has(s.tagId)||u.set(s.tagId,[]),u.get(s.tagId).push({flag:i.flag,tagId:s.tagId,desc:s.desc,showValue:s.showValue,dataset:s.dataset,id:i.id,category:i.category})})}),u},ye=(u,i,s,b)=>{let n=[];return u&&u.forEach(p=>{p.dataset=b}),s&&s.forEach(p=>{for(let o in p.dataset)o==p.name&&(p.dataset[o]=b)}),i.forEach(p=>{p.dataset=b,n.push(p)}),n};let N={};const ve=u=>{const i=ut(new Date,"MM/dd HH:mm:ss.SSS"),s=y.value.reduce((n,p)=>(n[p.id]=p,n),{}),b=new Set;k.componentList.forEach(n=>{const p=s[n.id],o=n.option.precision;if(p){if(n.key==="ButtonHistory"||n.key==="RectangleHistory")return;if(p.dataset==="ERR"&&n.option.isShowBindPoint)return n.option.dataset="ERR";const r=isNaN(Number(p.dataset))?p.dataset:Number(p.dataset);n.option.isShowBindPoint?o!==""?(n.option.dataset=B(r,o),n.option.judgmentValue=B(r,o)):(n.option.dataset=r,n.option.judgmentValue=r):o!==""?n.option.judgmentValue=B(r,o):(console.log("precision is null",r),n.option.judgmentValue=r)}u.forEach(r=>{if(n.id===r.id){if(n.key==="LineHistory"||n.key==="PieHistory")return;if(n.key==="LineTime"){let m={};if(r.dataset==="ERR"){m[r.showValue]="ERR",m.id=r.id;return}o!==""?m[r.showValue]=B(Number(r.dataset),o):m[r.showValue]=r.dataset,m.id=r.id,m.product=i,Object.keys(N).length===0&&(N={...m}),Object.keys(N).forEach(f=>{f in m||(m[f]=N[f])}),N={...m},b.has(m.id)||(k.componentList.forEach(f=>{f.key==="LineTime"&&f.id===m.id&&f.option.dataset.source.push(m)}),b.add(m.id))}const h=n.option.dataset.source.find(m=>m.tagId===r.tagId);if(h){if(r.dataset==="ERR")return h.data="ERR";o!==""?h.data=B(Number(r.dataset),o):h.data=r.dataset}}}),n.events.action&&n.events.action.forEach(r=>{r.triggerType==="valueChange"&&pt(n,n.id)})})};function we(){let u=[];return L.value.forEach(i=>{u.push(...i.bindPointList)}),u.push(...y.value),u.push(...C.value),u.reduce((i,s)=>(s.bindPoint!==null&&!i.set.has(s.bindPoint)&&!i.set.has(s.tagId)&&(i.set.add(s.bindPoint||s.tagId),i.result.push(s)),i),{set:new Set,result:[]}).result.map(i=>i.bindPoint||i.tagId)}nt(()=>{let u=Ie("GO_CHART_STORAGE_LIST")?Ie("GO_CHART_STORAGE_LIST"):a.params.id;t.value=u[0].id?u[0].id:u[0],Ye(t.value),R($);const{pointList:i,multiplePointList:s,specialComponentList:b}=Ve();y.value=i,L.value=s,console.log(y.value,".................."),C.value=b,it("webSocketListenerAdded")});const Ye=async u=>{let i={id:Number(u)};if((await rt(i)).data)_.value=!0;else{if(_.value=!1,y.value.length==0&&L.value.length==0&&C.value.length===0)return;ge()}},We=async()=>{let u={id:Number(t.value),name:d.value,password:v.value.password};(await gt(u)).code===200&&(_.value=!1,ge(),window.$message.success(O.global.t("project.passwordVerificationSuccess")))};return(u,i)=>{const s=Y("n-input"),b=Y("n-form-item"),n=Y("n-button"),p=Y("n-form");return w(),S(j,null,[l(_)?(w(),S("div",He,[T("div",Ke,[T("h3",qe,Re(l(O).global.t("project.welcomeLogin")),1),I(p,{ref:"formRef",model:v.value,rules:D.value,size:"large","label-placement":"left","label-width":"auto"},{default:U(()=>[I(b,{path:"username",label:"\u8D26\u53F7:",style:{"margin-bottom":"20px"}},{default:U(()=>[I(s,{value:v.value.username,"onUpdate:value":i[0]||(i[0]=o=>v.value.username=o),type:"username",disabled:""},null,8,["value"])]),_:1}),I(b,{path:"password",label:"\u5BC6\u7801:","show-require-mark":!1},{default:U(()=>[I(s,{value:v.value.password,"onUpdate:value":i[1]||(i[1]=o=>v.value.password=o),type:"password",onKeydown:i[2]||(i[2]=lt(dt(()=>{},["prevent"]),["enter"])),"show-password-on":"click",autocomplete:"new-password"},null,8,["value"])]),_:1}),T("div",Ue,[I(n,{type:"success",size:"large",style:{width:"90%"},onClick:We,secondary:""},{default:U(()=>[ct(Re(l(O).global.t("project.login")),1)]),_:1})])]),_:1},8,["model","rules"])])])):c("v-if",!0),c(" \u9884\u89C8\u9875 "),c(" getComponentAttrStyle \u8BBE\u7F6E\u7EC4\u4EF6\u4F4D\u7F6E Z-index,left,top "),c(" getTransformStyle \u516C\u5171\u5DE5\u5177\u7C7B\u4E2D \u53D8\u6362\u5C5E\u6027 rotateZ rotateX rotateY skewX skewY  "),c(" getStatusStyle \u8BBE\u7F6E\u72B6\u6001\u6837\u5F0F hide \u662F\u5426\u9690\u85CF\u7EC4\u4EF6 "),c(" getPreviewConfigStyle \u8BBE\u7F6E\u9884\u89C8\u914D\u7F6E\u6837\u5F0F  overFlowHidden \u6EA2\u51FA\u9690\u85CF..? "),c(" getBlendModeStyle \u516C\u5171\u5DE5\u5177\u7C7B\u4E2D \u6DF7\u5408\u6A21\u5F0F..?  "),c(" getSizeStyle \u8BBE\u7F6E\u7EC4\u4EF6\u5927\u5C0F scale w h "),(w(!0),S(j,null,be(l(k).componentList,(o,r)=>(w(),S("div",{class:F(["chart-item",l(Q)(o.styles.animations)]),id:o.id,key:o.id,style:V({...l(te)(o.attr,r),...l(Ee)(o.styles),...l(ae)(o.status),...l(oe)(o.preview),...l(_e)(o.styles),...l(X)(o.attr)})},[c(" \u5206\u7EC4 "),o.isGroup?(w(),H(l(Ge),{key:0,groupData:o,groupIndex:r,themeSetting:ue.value,themeColor:pe.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(w(),S(j,{key:1},[c(" \u5355\u7EC4\u4EF6 "),c(" component \u52A8\u6001\u7EC4\u4EF6 "),c(" is \u901A\u8FC7is\u5B57\u6BB5\u5728\u591A\u4E2A\u7EC4\u4EF6\u4E4B\u95F4\u6765\u56DE\u5207\u6362  \u6587\u672C\u6846\u4E3AVTextCommon"),c(" id \u5F53\u524D\u7EC4\u4EF6\u6240\u751F\u6210\u7684\u72EC\u4E00\u65E0\u4E8C\u7684id "),c(" chartConfig \u5F53\u524D\u7EC4\u4EF6\u7684\u6240\u6709\u914D\u7F6E\u4FE1\u606F "),c(" themeSetting \u5168\u5C40\u4E3B\u9898\u8272 "),c(" themeColor \u914D\u7F6E\u9879 "),c(" useLifeHandler \u7EC4\u4EF6\u4E8B\u4EF6\u5904\u7406hook "),(w(),H(Pe(o.chartConfig.chartKey),Ce({id:o.id,chartConfig:o,themeSetting:ue.value,themeColor:pe.value,style:{...l(X)(o.attr),...l(K)(o.styles)}},Se(l(ke)(o,l($),o.id))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],2112))],14,Be))),128))],64)}}}),ie=q(Xe,[["__scopeId","data-v-ef78c251"],["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/preview/components/PreviewRenderList/index.vue"]]),ze=e=>{console.log(2222);const a=P(!1),g=setInterval(()=>{if(window.$vue.component){clearInterval(g);const t=d=>{window.$vue.component(d.chartConfig.chartKey)||window.$vue.component(d.chartConfig.chartKey,bt(d.chartConfig))};e.componentList.forEach(async d=>{d.isGroup?d.groupList.forEach(v=>{t(v)}):t(d)}),a.value=!0}},200);return{show:a}},Fe=e=>{const a=$();a.requestGlobalConfig=e[_t.REQUEST_GLOBAL_CONFIG]},Je=M({__name:"suspenseIndex",setup(e){const{updateComponent:a}=kt(),g=Le(),t=P(!1);ee(),ee();const d=$();(async()=>{if(isNaN(g.params.id[0]-0))ze(d),setTimeout(()=>{t.value=!0},200);else try{const y=await ft({id:g.params.id[0]-0});y.code==200&&(d.componentList=[],je(Te.GO_CHART_STORAGE_LIST,[{id:g.params.id[0]-0+"",...JSON.parse(y.data)}]),await a(JSON.parse(y.data)),t.value=!0,ht(`${O.global.t("project.preview")}-${JSON.parse(y.data).editCanvasConfig.projectName}`))}catch(y){console.log(y)}})();const v=J(()=>(console.log("\u7F29\u653E\u5C42",{overflow:"hidden",...se(d.editCanvasConfig),...K(d.editCanvasConfig)}),{overflow:"hidden",...se(d.editCanvasConfig),...K(d.editCanvasConfig)})),_=J(()=>{const y=d.editCanvasConfig.previewScaleType;return y===xe.SCROLL_Y||y===xe.SCROLL_X});Fe(d);const{entityRef:D,previewRef:L}=Ct(d);return De(),(y,C)=>(w(),S(j,null,[c(" \u4ECEStore\u4E2D\u62FF\u5230previewScaleType \uFF08\u9002\u914D\u5C5E\u6027\uFF09\u6765\u53D8\u66F4class \u66F4\u6539\u9884\u89C8\u6A21\u5F0F\u4E0B\u5C55\u793A\u7684\u9002\u914D\u6837\u5F0F "),c(" \u76D1\u542C\u9F20\u6807\u6309\u4E0B \u89E6\u53D1\u62D6\u62FD\u4E8B\u4EF6 \u4E3A\u4EC0\u4E48\u89E6\u53D1\u672A\u77E5. "),T("div",{class:F(`go-preview ${l(d).editCanvasConfig.previewScaleType}`),onMousedown:C[0]||(C[0]=(...R)=>l(ne)&&l(ne)(...R))},[c(" showEntity \u662F\u5426\u5C55\u793A\u5B9E\u4F53\u533A\u57DF "),_.value?(w(),S(j,{key:0},[c(" \u5B9E\u4F53\u533A\u57DF "),T("div",{ref_key:"entityRef",ref:D,class:"go-preview-entity"},[c(" \u7F29\u653E\u5C42 "),T("div",{ref_key:"previewRef",ref:L,class:"go-preview-scale"},[c(" \u5C55\u793A\u5C42 "),t.value?(w(),S("div",{key:0,style:V(v.value)},[c(" \u6E32\u67D3\u5C42 "),I(l(ie))],4)):c("v-if",!0)],512)],512)],64)):(w(),S(j,{key:1},[c(" \u76EE\u524D\u6765\u770B\u8D70\u7684\u662F\u6CA1\u6709\u5B9E\u4F53\u533A\u57DF\u7684\u3002\uFF1F "),c(" \u7F29\u653E\u5C42 "),T("div",{ref_key:"previewRef",ref:L,class:"go-preview-scale"},[c(" \u5C55\u793A\u5C42 "),t.value?(w(),S("div",{key:0,style:V(v.value)},[c(" \u6E32\u67D3\u5C42 "),I(l(ie))],4)):c("v-if",!0)],512)],64))],34)],2112))}});let re,le,de,ce;re=q(Je,[["__scopeId","data-v-8b29f902"],["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/preview/suspenseIndex.vue"]]),le=M({__name:"index",setup(e){return(a,g)=>(w(),H(mt,null,{default:U(()=>[I(re)]),_:1}))}}),de=q(le,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/preview/index.vue"]]),ce=M({__name:"wrapper",setup(e){let a=P(Date.now());try{[$e.JSON,$e.CHART_TO_PREVIEW].forEach(g=>{!window.opener||!window.opener.addEventListener||window.opener.addEventListener(g,async t=>{const d=await ee();je(Te.GO_CHART_STORAGE_LIST,[{...t.detail,id:d.id}]),a.value=Date.now()})})}catch(g){console.log(g)}return(g,t)=>(w(),H(de,{key:l(a)}))}}),Oe=q(ce,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/preview/wrapper.vue"]])});export{Lt as __tla,Oe as default};
