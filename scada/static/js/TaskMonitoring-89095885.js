import{d as X,g as ie,S as re,B as Y,u as ee,ae as Z,r as h,aF as se,o as ae,f as c,h as y,D as P,w as u,l,n as s,ap as G,az as U,aA as te,p as g,t as i,i as x,k as p,j as w,an as S,a9 as oe,F as de,_ as le,V as pe,ak as ce,O as H,c9 as ne,af as K,au as ve,at as ye}from"./index-35337fd3.js";import{E as ge,D as me,a7 as _e,a8 as fe,F as he,a9 as $e,aa as be,ab as ke}from"./energy-f0146bb7.js";import{N as ue}from"./RadioButton-47b7c95b.js";import{i as xe}from"./icon-ebc544b2.js";const we={key:0,style:{display:"flex","align-items":"center"}},Te={style:{margin:"0 5px"}},Ee={style:{margin:"0 5px"}},je={key:1},Se={key:2,style:{display:"flex","align-items":"center"}},De={width:"200px"},Ce={width:"200px"},Ne={width:"250px"},Pe={width:"550px"},Ue={key:0},Ie={key:0},ze={key:1},Le={key:2},Re={style:{display:"flex","justify-content":"center"}},Ae=X({__name:"TaskMonitoringPopup",props:{isEdit:String,childList:Object},emits:["closePopup"],setup(Q,{emit:J}){const R=ie(re.GO_LANG_STORE)?.lang||"ZH",T=Y(),D=ee();Z("permission");const I=h([]),A=h([]),C=h([]),b=J,z=h(null),E=Q,q=Array.from({length:24},(a,t)=>({label:t<=9?`0${t}`:t,value:t<=9?`0${t}`:t})),m=Array.from({length:60},(a,t)=>({label:t<=9?`0${t}`:t,value:t<=9?`0${t}`:t})),M=h([{label:$t("energy.Monday"),labelEN:"Monday",value:1},{label:$t("energy.Tuesday"),labelEN:"Tuesday",value:2},{label:$t("energy.Wednesday"),labelEN:"Wednesday",value:3},{label:$t("energy.Thursday"),labelEN:"Thursday",value:4},{label:$t("energy.Friday"),labelEN:"Friday",value:5},{label:$t("energy.Saturday"),labelEN:"Saturday",value:6},{label:$t("energy.Sunday"),labelEN:"Sunday",value:7}]),e=h({jobGroup:"6",deviceCode:null,deviceId:"",jobDesc:"",type:"REPEAT",gw:"",week:[1],weekEn:["Monday"],hour:"00",minute:"00",dateTime:se(new Date,"yyyy-MM-dd HH:mm:ss"),step:"15"}),F={jobDesc:[{required:!0,message:$t("energy.please_enter"),trigger:"blur"}],deviceCode:[{required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}]};let $=h([]);const V=(a,t)=>{e.value.week=a,e.value.weekEn=e.value.week.map(o=>M.value.find(v=>v.value==o)?.labelEN)},k=a=>{a.preventDefault(),z.value?.validate(t=>{if(!t){let o=[],v={};for(let _ of $.value)e.value.type=="INTERVAL"?v.intervalInSeconds=e.value.step:e.value.type=="SINGLE"?v.specificTime=e.value.dateTime:v.weekDayTime=`${e.value.week.join(",")} ${e.value.hour}:${e.value.minute}`,o.push({gw:e.value.gw,deviceCode:e.value.deviceCode,tagCode:_.tagCode,type:_.type,param:_.type=="push"?_.selectSendData.toString():_.sendData});let L={...e.value,tableData:$.value},N={jobGroup:e.value.jobGroup,jobDesc:e.value.jobDesc,type:e.value.type,ids:JSON.stringify(o),...v,projectId:D.projectDetail.id,executorParam:JSON.stringify(L)};if($.value.length==0)return T.error($t("energy.The_task_cannot_be_empty"));E.isEdit=="create"?_e(N).then(_=>{_.code===200&&(T.success($t("project.operationSuccess")),b("closePopup","create"))}):fe({...N,id:E.childList.id}).then(_=>{_.code===200&&(T.success($t("project.operationSuccess")),b("closePopup","edit"))})}})},O=(a,t,o=!1)=>{e.value.deviceCode=t.name,e.value.deviceId=t.id,e.value.gw=t.sn,o||($.value=[]),he({deviceId:t.id}).then(v=>{v.code===200&&(A.value=v.data.list)})},n=a=>{$.value.splice(a,1)},d=()=>{if(e.value.deviceCode==null)return T.error($t("energy.Please_select_a_device"));if($.value.length>=5)return T.error($t("energy.The_maximum_number_of_tasks_is_five"));let a={tagCode:null,type:"push",sendData:"",selectSendData:null};$.value.push(a)};return ae(()=>{let{isEdit:a,childList:t}=E;if(a=="edit"){let o=JSON.parse(JSON.parse(t.executorParam).param);$.value=o.tableData,delete o.tableData,e.value=o,O(null,{sn:e.value.gw,name:e.value.deviceCode,id:e.value.deviceId},!0)}ge({page:1,size:9999,projectId:D.projectDetail.id}).then(o=>{o.code===200&&(I.value=o.data.list)}),me({page:1,size:9999,projectId:D.projectDetail.id}).then(o=>{o.code===200&&(C.value=o.data)})}),(a,t)=>{const o=c("n-form-item"),v=c("n-radio"),L=c("n-space"),N=c("n-date-picker"),_=c("n-form"),W=c("n-table"),B=c("n-card");return y(),P(B,null,{default:u(()=>[l(_,{ref_key:"formRef",ref:z,model:e.value,"label-placement":"left","label-width":"auto",rules:F,size:"small","require-mark-placement":"right-hanging",style:{maxWidth:"640px"}},{default:u(()=>[l(o,{label:a.$t("energy.Task_Name"),path:"jobDesc"},{default:u(()=>[l(s(G),{value:e.value.jobDesc,"onUpdate:value":t[0]||(t[0]=r=>e.value.jobDesc=r),placeholder:a.$t("energy.please_enter")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(o,{label:a.$t("energy.Execution_Device"),path:"deviceCode"},{default:u(()=>[l(s(U),{value:e.value.deviceCode,"onUpdate:value":t[1]||(t[1]=r=>e.value.deviceCode=r),placeholder:a.$t("energy.please_select"),options:I.value,"label-field":"name","value-field":"name","on-update:value":O},null,8,["value","placeholder","options"])]),_:1},8,["label"]),l(o,{label:a.$t("energy.Execution_Method")},{default:u(()=>[l(s(te),{value:e.value.type,"onUpdate:value":t[2]||(t[2]=r=>e.value.type=r),name:"radiogroup1"},{default:u(()=>[l(L,null,{default:u(()=>[l(v,{value:"REPEAT"},{default:u(()=>[g(i(a.$t("energy.Repeat_Execution")),1)]),_:1}),l(v,{value:"SINGLE"},{default:u(()=>[g(i(a.$t("energy.Single_Execution")),1)]),_:1}),l(v,{value:"INTERVAL"},{default:u(()=>[g(i(a.$t("energy.Execute_at_Time_Interval")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),l(o,{label:a.$t("energy.Execution_Time")},{default:u(()=>[e.value.type=="REPEAT"?(y(),x("div",we,[l(s(U),{style:{width:"150px"},value:e.value.week,"onUpdate:value":t[3]||(t[3]=r=>e.value.week=r),"label-field":"label",options:M.value,"value-field":"value",multiple:"",maxTagCount:1,"on-update:value":V},null,8,["value","options"]),l(s(U),{style:{width:"100px","margin-left":"10px"},value:e.value.hour,"onUpdate:value":t[4]||(t[4]=r=>e.value.hour=r),options:s(q),"label-field":"label","value-field":"value"},null,8,["value","options"]),p("span",Te,i(a.$t("project.h")),1),l(s(U),{style:{width:"100px"},value:e.value.minute,"onUpdate:value":t[5]||(t[5]=r=>e.value.minute=r),options:s(m),"label-field":"label","value-field":"value"},null,8,["value","options"]),p("span",Ee,i(a.$t("project.m")),1)])):w("v-if",!0),e.value.type=="SINGLE"?(y(),x("div",je,[l(N,{style:{width:"220px"},type:"datetime","formatted-value":e.value.dateTime,"onUpdate:formattedValue":t[6]||(t[6]=r=>e.value.dateTime=r),"value-format":"yyyy-MM-dd HH:mm:ss"},null,8,["formatted-value"])])):w("v-if",!0),e.value.type=="INTERVAL"?(y(),x("div",Se,[w(` <n-date-picker v-model:value="item.rangeTime" size="small" style="width: 350px;" type="datetimerange"
              clearable /> `),p("span",null,[g(i(a.$t("energy.Execute_once_every"))+" ",1),l(s(G),{value:e.value.step,"onUpdate:value":t[7]||(t[7]=r=>e.value.step=r),style:{width:"100px"}},null,8,["value"]),g(i(a.$t("energy.seconds")),1)])])):w("v-if",!0)]),_:1},8,["label"]),l(o,{label:a.$t("energy.Execution_Content")},{default:u(()=>[l(s(S),{type:"success",secondary:"",onClick:d},{default:u(()=>[g(i(a.$t("energy.add")),1)]),_:1})]),_:1},8,["label"])]),_:1},8,["model"]),l(W,{"single-line":!1},{default:u(()=>[p("thead",null,[p("tr",null,[p("th",De,i(a.$t("energy.Select_Attribute")),1),p("th",Ce,i(a.$t("energy.Execute_Operation")),1),p("th",Ne,i(a.$t("energy.Send_Data")),1),p("th",Pe,i(a.$t("energy.Execution_Time")),1),p("th",null,i(a.$t("energy.Operations")),1)])]),p("tbody",null,[(y(!0),x(de,null,oe(s($),(r,f)=>(y(),x("tr",{key:f},[p("td",null,[l(s(U),{value:r.tagCode,"onUpdate:value":j=>r.tagCode=j,placeholder:a.$t("energy.please_select"),options:A.value,"label-field":"name","value-field":"name"},null,8,["value","onUpdate:value","placeholder","options"])]),p("td",null,[l(s(te),{size:"small",value:r.type,"onUpdate:value":j=>r.type=j},{default:u(()=>[l(s(ue),{value:"push"},{default:u(()=>[g(i(a.$t("energy.Data_Collection_Push")),1)]),_:1}),l(s(ue),{value:"write"},{default:u(()=>[g(i(a.$t("energy.Dispatch_Write")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"])]),p("td",null,[r.type!="push"?(y(),P(s(G),{key:0,style:{width:"240px"},value:r.sendData,"onUpdate:value":j=>r.sendData=j,placeholder:a.$t("energy.Please_enter_a_decimal_number"),size:"small"},null,8,["value","onUpdate:value","placeholder"])):(y(),P(s(U),{key:1,style:{width:"240px"},size:"small",value:r.selectSendData,"onUpdate:value":j=>r.selectSendData=j,placeholder:a.$t("energy.Please_Select_Notification_Group_Push"),"label-field":"name","value-field":"id",options:C.value},null,8,["value","onUpdate:value","placeholder","options"]))]),e.value.type=="REPEAT"?(y(),x("td",Ue,[g(i(a.$t("energy.Execute_once_every"))+" ",1),s(R)=="ZH"?(y(),x("span",Ie,"\u5468")):w("v-if",!0),g(" "+i(s(R)=="ZH"?e.value.week.join(","):e.value.weekEn.join(","))+" "+i(e.value.hour)+":"+i(e.value.minute)+" "+i(a.$t("energy.Execute_once")),1)])):w("v-if",!0),e.value.type=="SINGLE"?(y(),x("td",ze,i(e.value.dateTime)+" "+i(a.$t("energy.Execute_once")),1)):w("v-if",!0),e.value.type=="INTERVAL"?(y(),x("td",Le,[p("span",null,i(a.$t("energy.Execute_once_every"))+" "+i(e.value.step)+i(a.$t("energy.seconds")),1)])):w("v-if",!0),p("td",null,[l(s(S),{quaternary:"",type:"error",onClick:j=>n(f)},{default:u(()=>[g(i(a.$t("energy.del")),1)]),_:2},1032,["onClick"])])]))),128))])]),_:1}),p("div",Re,[l(s(S),{secondary:"",type:"primary",style:{width:"200px","margin-top":"20px"},onClick:k},{default:u(()=>[g(i(a.$t("energy.save")),1)]),_:1})])]),_:1})}}}),Me=le(Ae,[["__scopeId","data-v-d55d0eb9"],["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/warn/TaskMonitoringPopup.vue"]]),Oe=X({__name:"TaskMonitoring",setup(Q){const J=pe(()=>window.innerHeight-210),{SearchIcon:R}=xe.ionicons5,T=Z("permission"),D=Y(),I=ce(),A=ee(),C=h({}),b=h(!1),z=h({}),E=h("create"),q=h([{title:$t("energy.Timed_Task"),key:"jobDesc"},{title:$t("energy.Execution_Device"),key:"cronExpression",render(n){let d=n.executorParam?JSON.parse(n.executorParam):{};return d.ids?JSON.parse(d.ids)[0]?.deviceCode:""}},{title:$t("energy.Execution_Method"),key:"cron"},{title:$t("energy.Task_Status"),key:"addTime",render(n){if(n.triggerStatus===0)return H(ne,{style:{cursor:"pointer"},type:"error",onClick:()=>$(n.id,!0)},()=>"stop");if(n.triggerStatus===1)return H(ne,{style:{cursor:"pointer"},type:"success",onClick:()=>$(n.id,!1)},()=>"running")}},{title:$t("energy.UpdateTime"),key:"updateTime"},{title:$t("energy.Operations"),key:"action",render(n){return[K(H(S,{size:"small",quaternary:!0,type:"success",style:{marginRight:"10px"},onClick:()=>{b.value=!0,E.value="edit",z.value=n}},{default:()=>$t("energy.edit")}),[[T,[$t("energy.Timed_Task"),"change"]]]),K(H(S,{size:"small",quaternary:!0,type:"error",style:{marginRight:"10px"},onClick:()=>{I.error({title:$t("project.confirm"),content:()=>$t("project.deleteConfirmation")+"\uFF1F",showIcon:!1,positiveText:$t("project.sure"),positiveButtonProps:{secondary:!0},negativeText:$t("project.cancel"),onPositiveClick:()=>{$e({id:n.id}).then(d=>{d.code===200&&(D.success($t("project.deleteSuccess")),k())})}})}},{default:()=>$t("energy.del")}),[[T,[$t("energy.Timed_Task"),"delete"]]])]}}]),m=h({jobGroup:"6",projectId:A.projectDetail.id,page:1,size:10,jobDesc:""}),M=n=>{m.page=n,k()},e=n=>{m.size=n,k()},F=()=>{m.value.page=1,k()},$=(n,d)=>{I.error({title:$t("project.confirm"),content:()=>`${$t("project.sure")} ${d?$t("energy.starting"):$t("energy.stopping")}?`,showIcon:!1,positiveText:$t("project.sure"),positiveButtonProps:{secondary:!0},negativeText:$t("project.cancel"),onPositiveClick:()=>{be({id:n,isStart:d}).then(()=>{D.success($t("project.operationSuccess")),k()})}})},V=n=>{b.value=!0,E.value=n},k=()=>{ke(m.value).then(n=>{n.code===200&&(C.value=n.data)})},O=()=>{b.value=!1,k()};return ae(()=>{k()}),(n,d)=>{const a=c("n-icon"),t=c("n-input-group"),o=c("n-form-item"),v=c("n-form"),L=c("n-pagination"),N=c("n-space"),_=c("n-drawer-content"),W=c("n-drawer"),B=c("n-card"),r=Z("permission");return y(),P(B,null,{default:u(()=>[l(v,{ref:"formRef",inline:"","label-width":80,model:m.value,"label-placement":"left"},{default:u(()=>[l(o,null,{default:u(()=>[l(t,null,{default:u(()=>[l(s(G),{value:m.value.jobDesc,"onUpdate:value":d[0]||(d[0]=f=>m.value.jobDesc=f),placeholder:n.$t("energy.search")+n.$t("energy.Task_Name"),class:"tree-input"},null,8,["value","placeholder"]),l(s(S),{onClick:F},{icon:u(()=>[l(a,null,{default:u(()=>[l(s(R))]),_:1})]),_:1})]),_:1})]),_:1}),l(o,null,{default:u(()=>[K((y(),P(s(S),{onClick:d[1]||(d[1]=f=>V("create")),style:{"margin-bottom":"10px"}},{default:u(()=>[g(i(n.$t("energy.add")),1)]),_:1})),[[r,[n.$t("energy.Timed_Task"),"add"]]])]),_:1})]),_:1},8,["model"]),l(s(ye),{columns:q.value,data:C.value.list,style:ve({height:`${J.value}px`}),"flex-height":""},null,8,["columns","data","style"]),l(N,{justify:"end",style:{"margin-top":"15px"}},{default:u(()=>[l(L,{page:m.value.page,"onUpdate:page":[d[2]||(d[2]=f=>m.value.page=f),M],"page-size":m.value.size,"onUpdate:pageSize":[d[3]||(d[3]=f=>m.value.size=f),e],"page-sizes":[10,20,50,100],"item-count":C.value.totalRow,"show-size-picker":"","page-slot":7},{prefix:u(({itemCount:f})=>[g(i(n.$t("project.total"))+" "+i(f)+" "+i(n.$t("project.items")),1)]),_:1},8,["page","page-size","item-count"])]),_:1}),b.value?(y(),P(W,{key:0,width:"75vw",placement:"right",show:b.value,"onUpdate:show":d[4]||(d[4]=f=>b.value=f)},{default:u(()=>[l(_,{title:E.value=="create"?`${n.$t("energy.add")} ${n.$t("energy.Timed_Task")}`:`${n.$t("energy.edit")} ${n.$t("energy.Timed_Task")}`,closable:""},{default:u(()=>[l(Me,{childList:z.value,isEdit:E.value,onClosePopup:O},null,8,["childList","isEdit"])]),_:1},8,["title"])]),_:1},8,["show"])):w("v-if",!0)]),_:1})}}}),Ge=le(Oe,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/warn/TaskMonitoring.vue"]]);export{Ge as default};
