import{d as R,ae as V,u as Z,r as u,B as K,b as O,o as X,f as o,h as c,i as _,l as n,w as s,n as x,an as D,p as $,t as S,k as Y,D as j,F as q,j as G,aF as g,O as m,aM as J,aN as P,_ as Q}from"./index-35337fd3.js";import{Z as W,_ as ee,R as ae}from"./energy-f0146bb7.js";import{d as te}from"./file-a76b285e.js";const le={style:{"margin-top":"15px"}},ne={style:{display:"flex","justify-content":"space-between"}},ie={key:0,id:"chart",style:{height:"100%"}},se=R({__name:"dataShow",setup(de){V("permission");const h=Z(),v=u([]),b=u([]),M=K();u(!1);const a=O({aggType:"last",count:"10",startTime:"",endTime:"",aggDate:u([new Date(new Date().getTime()-24*60*60*1e3).getTime(),new Date().getTime()])}),A=[{label:"FIRST("+$t("energy.First_Value")+")",value:"first"},{label:"LAST("+$t("energy.Last_Value")+")",value:"last"},{label:"MIN("+$t("energy.Minimum")+")",value:"min"},{label:"MAX("+$t("energy.Maximum")+")",value:"max"},{label:"SUM("+$t("energy.SUM")+")",value:"sum"},{label:"MEAN("+$t("energy.Average")+")",value:"mean"},{label:"MEDIAN("+$t("energy.Median")+")",value:"median"}],d=u([]),y=u([]),f=u([]),C={chart:{type:"area",stacked:!1,defaultLocale:"zh",locales:[{name:"zh",options:{months:["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],shortMonths:["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],days:["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],shortDays:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],toolbar:{selectionZoom:"\u7F29\u653E"}}}],zoom:{type:"x",enabled:!0,autoScaleYaxis:!0},toolbar:{show:!0,tools:{download:!0,zoom:!0,zoomin:!1,zoomout:!1,pan:!1,reset:!1}}},legend:{position:"top",horizontalAlign:"center"},dataLabels:{enabled:!1},markers:{size:0},title:{align:"left"},fill:{type:"gradient",gradient:{shadeIntensity:1,inverseColors:!1,opacityFrom:.5,opacityTo:0,stops:[0,90,100]}},yaxis:{labels:{formatter:function(e){return e}},title:{}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},tooltip:{shared:!0,enabled:!0,x:{format:"yyyy-MM-dd HH:mm:ss"},y:{formatter:function(e){return e}}}},H=()=>{if(d.value.length==0){M.warning($t("energy.please_select")+$t("energy.data_points"));return}let e=[];d.value.forEach(i=>{let l=i.split(".");e.push({gw:l[0],deviceCode:l[1],tagCode:l[2]})});let t={projectId:h.projectDetail.id,ids:e,startTime:g(a.aggDate[0],"yyyy-MM-dd HH:mm:ss"),endTime:g(a.aggDate[1],"yyyy-MM-dd HH:mm:ss"),count:a.count,aggType:a.aggType};ee(t).then(i=>{te(i,$t("energy.Aggregating_historical_data"),"xlsx")})},N=e=>{console.log(e),a.startTime=g(e[0],"yyyy-MM-dd hh:mm:ss"),a.endTime=g(e[1],"yyyy-MM-dd hh:mm:ss"),a.aggDate=e},T=()=>{if(d.value.length==0){M.warning($t("energy.please_select")+$t("energy.data_points"));return}let e=[];d.value.forEach(i=>{let l=i.split(".");e.push({gw:l[0],deviceCode:l[1],tagCode:l[2]})});let t={projectId:h.projectDetail.id,ids:e,startTime:g(a.aggDate[0],"yyyy-MM-dd HH:mm:ss"),endTime:g(a.aggDate[1],"yyyy-MM-dd HH:mm:ss"),count:a.count,aggType:a.aggType,edgeDB:1};ae({...t}).then(i=>{if(i.code==200&&i.data.data.length>0){for(let l in i.data.data)i.data.data[l].data=i.data.data[l].data.map(p=>[p[0]*1e3,p[1]]);f.value=i.data.data}})},z=({option:e})=>isNaN(e.id)?m(J,{trigger:"hover",contentClass:"n-popover__content",contentStyle:{"--prefix-text":`"${e.description}"`}},{trigger:()=>m("span",e.name)}):m("span",e.name),U=({option:e})=>{if(isNaN(e.id))return m(P,{checked:y.value.includes(e.id),onClick:()=>{y.value.includes(e.id)?(y.value=y.value.filter(t=>t!==e.id),d.value=d.value.filter(t=>t!==e.id)):(y.value.push(e.id),d.value.push(e.id)),T()}})};return X(()=>{W({projectId:h.projectDetail.id}).then(e=>{v.value=e.data})}),(e,t)=>{const i=o("n-select"),l=o("n-form-item"),p=o("n-input"),I=o("n-date-picker"),E=o("n-form"),F=o("n-space"),L=o("n-tree"),w=o("n-empty"),k=o("n-card"),B=o("apexchart");return c(),_("div",le,[n(F,null,{default:s(()=>[n(E,{inline:"","label-width":110,model:a,"label-placement":"left"},{default:s(()=>[n(l,{label:e.$t("energy.Aggregation_Method")},{default:s(()=>[n(i,{value:a.aggType,"onUpdate:value":t[0]||(t[0]=r=>a.aggType=r),options:A,placeholder:"\u8BF7\u9009\u62E9",style:{width:"180px"}},null,8,["value"])]),_:1},8,["label"]),n(l,{label:e.$t("energy.aggregation_period")},{default:s(()=>[n(p,{value:a.count,"onUpdate:value":t[1]||(t[1]=r=>a.count=r),valueModifiers:{number:!0}},null,8,["value"])]),_:1},8,["label"]),n(l,{label:e.$t("energy.Time_Selection")},{default:s(()=>[n(I,{value:a.aggDate,"onUpdate:value":t[2]||(t[2]=r=>a.aggDate=r),type:"datetimerange","on-update:value":N},null,8,["value"])]),_:1},8,["label"]),n(l,null,{default:s(()=>[n(x(D),{onClick:T},{default:s(()=>[$(S(e.$t("energy.Search")),1)]),_:1})]),_:1}),n(l,null,{default:s(()=>[n(x(D),{onClick:H},{default:s(()=>[$(S(e.$t("energy.export")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),Y("div",ne,[n(k,{size:"small",style:{width:"20%",height:"calc(100vh - 140px)","overflow-y":"auto"}},{default:s(()=>[v.value.length!=0?(c(),j(L,{key:0,"checked-keys":b.value,"onUpdate:checkedKeys":t[3]||(t[3]=r=>b.value=r),"block-line":"",data:v.value,"key-field":"id","label-field":"name","children-field":"children",selectable:"","render-prefix":U,"render-label":z},null,8,["checked-keys","data"])):(c(),j(w,{key:1,description:e.$t("energy.No_Data_Available")},null,8,["description"]))]),_:1}),n(k,{style:{width:"79.5%",height:"calc(100vh - 140px)"}},{default:s(()=>[f.value.length?(c(),_("div",ie,[n(B,{type:"area",height:"98%",options:C,series:f.value},null,8,["series"])])):(c(),_(q,{key:1},[G(' <div  style="height: 100%;width: 100%;" id="tagEch"></div> '),n(w,{description:e.$t("energy.No_Data_Available")},null,8,["description"])],2112))]),_:1})])])}}}),oe=Q(se,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/device/dataShow.vue"]]);export{oe as default};
