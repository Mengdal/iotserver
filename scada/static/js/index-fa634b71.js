import{d as X,u as Y,B as ee,r as s,b as A,o as ae,al as Re,f as g,h as j,i as te,l as t,w as l,p as I,t as m,_ as le,ak as de,g as qe,S as Be,k as D,n,an as k,j as O,a0 as Fe,ae as ue,V as Je,O as v,ap as ce,ar as pe,af as L,aC as ye,D as T,at as Me,au as Ae,aq as He,az as We,aD as Ee,aE as Ke}from"./index-35337fd3.js";import{c as Ze,g as ge,p as Qe,a as Ve,r as Xe,f as Ye,b as ea,d as aa,i as ta,e as la}from"./gatewaydetail-6b78baa7.js";import{N as na,d as sa,O as ra}from"./energy-f0146bb7.js";import{d as oa}from"./file-a76b285e.js";import{i as ia}from"./icon-ebc544b2.js";import{d as da,a as ua}from"./device-c03715b9.js";import{N as ca}from"./TreeSelect-1365bf1b.js";import"./RadioButton-47b7c95b.js";import"./FileSaver.min-6eb19673.js";const pa=X({__name:"gatewayPop",props:{projectParams:Object},emits:["closePopup"],setup(E,{emit:b}){const N=Y(),F=ee(),r=s({name:"",sn:"",secret:"",model:"IoT Gateway",projectId:N.projectDetail.id}),R=s(),q=s([{label:"IoT Gateway",value:"IoT Gateway"},{label:"IoT Lite Gateway",value:"IoT Lite Gateway"},{label:"IO Server",value:"IO Server"},{label:"IoT Mini Gateway",value:"IoT Mini Gateway"}]),P=A({name:{required:!0,message:$t("energy.please_enter"),trigger:"blur"},sn:{required:!0,message:$t("energy.please_enter"),trigger:"blur"},secret:{required:!0,message:$t("energy.please_enter"),trigger:"blur"}}),x=b,B=()=>{R.value.validate(async u=>{u||Ze(r.value).then(f=>{f.code===200?(window.$message.success($t("energy.add")+$t("energy.successfully")),x("closePopup","creat")):(F.error(f.message),x("closePopup",""))})})},S=()=>{x("closePopup","")};return ae(()=>{}),Re(()=>{}),(u,f)=>{const G=g("n-text"),i=g("n-space"),h=g("n-input"),c=g("n-form-item"),p=g("n-select"),y=g("n-button"),w=g("n-form"),H=g("n-card");return j(),te("div",null,[t(H,null,{header:l(()=>[t(i,null,{default:l(()=>[t(G,null,{default:l(()=>[I(m(u.$t("energy.add"))+m(u.$t("energy.gateway")),1)]),_:1})]),_:1})]),default:l(()=>[t(w,{model:r.value,"label-placement":"left","label-width":"auto",ref_key:"formRef",ref:R,rules:P},{default:l(()=>[t(c,{path:"name",label:u.$t("energy.Gateway_Name")},{default:l(()=>[t(h,{value:r.value.name,"onUpdate:value":f[0]||(f[0]=U=>r.value.name=U),placeholder:u.$t("energy.please_enter")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{path:"sn",label:u.$t("energy.Gateway_SN")},{default:l(()=>[t(h,{value:r.value.sn,"onUpdate:value":f[1]||(f[1]=U=>r.value.sn=U),placeholder:u.$t("energy.please_enter")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{path:"secret",label:u.$t("energy.Gateway_Secret_Key")},{default:l(()=>[t(h,{value:r.value.secret,"onUpdate:value":f[2]||(f[2]=U=>r.value.secret=U),placeholder:u.$t("energy.please_enter")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(c,{label:u.$t("energy.Gateway_Type")},{default:l(()=>[t(p,{value:r.value.model,"onUpdate:value":f[3]||(f[3]=U=>r.value.model=U),placeholder:u.$t("energy.please_select"),options:q.value,"label-field":"label","value-field":"value"},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(i,{justify:"flex-end"},{default:l(()=>[t(i,null,{default:l(()=>[t(y,{size:"medium",onClick:S},{default:l(()=>[I(m(u.$t("energy.close")),1)]),_:1}),t(y,{size:"medium",type:"primary",onClick:B,secondary:""},{default:l(()=>[I(m(u.$t("energy.save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}}),ya=le(pa,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/gateway/gatewayPop.vue"]]),ga={style:{display:"flex","justify-content":"space-between"}},va={style:{display:"flex","justify-content":"flex-end",position:"absolute",top:"1%",right:"5%"}},ma={style:{position:"relative",border:"1px solid #dcdfe6"}},wa=["src"],fa=X({__name:"config",props:{childList:Object},setup(E){Y();const b=ee(),N=de(),F=s(!1);let r=A({}),R=s(),q=s(),P=s(),x=s("");const B=(qe(Be.GO_LANG_STORE)?.lang||"ZH")=="ZH"?"zh-CN":"en-US",S=E,u=i=>{const h=i.file.name;if(h.substring(h.lastIndexOf("."))!==".db")b.warning($t("project.invalidFileFormat"));else{let c=new FormData;c.append("file",i.file.file),c.append("id",r.sandboxId),c.append("userid",r.userId),da(c).then(p=>{if(p.code==200){b.success($t("project.uploadSuccessful")+"\uFF01");const y=document.querySelector("#GCPage"),w=y.src;y.src=w}})}},f=async()=>{const i=await ge({gatewayId:r.id,type:"pub"});var h=new WebSocket(i.data);h.onmessage=c=>{let p=JSON.parse(c.data).pubStatus,y=JSON.parse(c.data).message,w=JSON.parse(c.data).type;F.value=p,w!="tips"?(y=y.replace("\\n",`
`),x.value=y,N.success({title:$t("project.confirm"),content:y,showIcon:!1})):b.success(y),p||h.close()},(await Qe({gatewayId:r.id,projectId:r.projectId,sandBoxId:r.sandBoxId,sandboxName:r.sandboxName})).code===200||h.close()},G=()=>{ua({id:S.childList.sandboxId,userid:S.childList.userId}).then(i=>{const h=new Blob([i],{type:"application/x-sqlite3"}),c=S.childList.name+".db",p=document.createElement("a");p.download=c,p.style.display="none",p.href=URL.createObjectURL(h),document.body.appendChild(p),p.click(),URL.revokeObjectURL(p.href),document.body.removeChild(p)})};return ae(()=>{S.childList&&(r=S.childList,R.value=sessionStorage.getItem("gatewayId"),q.value=sessionStorage.getItem("gatewayName"),P.value=sessionStorage.getItem("gwType"))}),(i,h)=>{const c=g("n-upload");return j(),te("div",null,[D("div",ga,[D("div",va,[t(n(k),{secondary:"",style:{"margin-right":"10px"},type:"primary",onClick:f,loading:F.value},{default:l(()=>[I(m(i.$t("energy.publish")),1)]),_:1},8,["loading"]),O(' <n-button type="primary" size="mini" @click="realData">\u5BFC\u5165</n-button> '),t(c,{class:"upload-demo",action:"",accept:".db","default-upload":!1,"on-change":u,"show-file-list":!1,style:{"margin-right":"10px"}},{default:l(()=>[t(n(k),{type:"primary",secondary:"",class:"margin-lr-10"},{default:l(()=>[I(m(i.$t("energy.import")),1)]),_:1})]),_:1}),t(n(k),{secondary:"",style:{"margin-right":"10px"},type:"primary",onClick:G},{default:l(()=>[I(m(i.$t("energy.export")),1)]),_:1})])]),D("div",ma,[D("iframe",{id:"GCPage",style:{width:"100%",height:"90vh"},src:n(Fe).gatewayConfigUrl+"/GCPage/index.html?gatewayid="+n(R)+"&gatewayName="+encodeURIComponent(n(q))+"&gwType="+encodeURIComponent(n(P))+"&itemid="+n(r).projectId+"&userid="+n(r).userId+"&language="+n(B),frameborder:"0"},null,8,wa)])])}}}),ha=le(fa,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/gateway/config.vue"]]),_a={style:{width:"100%"}},ba=X({__name:"index",setup(E){const b=Y(),N=ue("permission"),F=Je(()=>window.innerHeight-210),{SearchIcon:r,EllipseIcon:R,ChevronDownIcon:q}=ia.ionicons5,P=s({newProjectId:"",gatewayId:Ke});let x=s(!1),B=s({});const S=s(!1),u=s([]),f=s(),G=s(!1),i=s(!1),h=s("add"),c=A({});let p=A({});const y=s([]),w=ee(),H=de(),U=s("\u7F51\u5173\u540D\u79F0"),W=s([]);let ne=s(0);const se=s(null),K=s(!1);s("right");const ve=s(),Z=s(null),_=A({page:1,size:10,projectId:b.projectDetail.id,type:"name",value:"",gwType:"",status:""});let re=s("gateWay");ae(()=>{ve.value=b.projectDetail.id,C()});const me=()=>{if(y.value.length===0){w.warning($t("energy.Select_gateway_move"));return}S.value=!0,sa({page:1,size:9999}).then(e=>{e.code===200&&(u.value=e.data.tableData)})},we=()=>{let e=W.value.findIndex(a=>a.id===y.value[0]);if(W.value[e].projectId===P.value.newProjectId){w.warning($t("energy.cannot_move_to_project"));return}P.value.gatewayId=y.value[0],ra(P.value).then(a=>{a.code===200&&(w.success($t("energy.successfully")),C())})},fe=e=>{_.page=e,C()},he=e=>{_.size=e,C()},C=()=>{Ve({..._}).then(e=>{ne=e.data.totalRow;let a=e.data.list;a.map(d=>{d.key=d.id}),W.value=a})},_e=()=>{C()},be=s([{label:$t("energy.Gateway_Name"),key:"\u7F51\u5173\u540D\u79F0"},{label:$t("energy.Gateway_SN"),key:"\u7F51\u5173SN"}]),$e=[{type:"selection",multiple:!1},{title:$t("energy.Gateway_Name"),key:"name",render(e){return Z.value===e.key?v(ce,{value:e.name,onUpdateValue:a=>{e.name=a},onBlur:()=>{Z.value=null,e.name&&na({projectId:b.projectDetail.id,gatewayId:e.id,name:e.name}).then(a=>{a.code===200&&(w.success($t("energy.edit")+$t("energy.successfully")),C())})}}):v("span",{onDblclick:()=>Z.value=e.key},e.name)}},{title:$t("energy.Gateway_SN"),key:"sn",width:105},{key:"type",title(){return v(pe,{options:[{label:"101",value:"101"},{label:"103",value:"103"},{label:"201",value:"201"},{label:"202",value:"202"},{label:"203",value:"203"},{label:"403",value:"403"},{label:"414",value:"414"},{label:"IOServer",value:"IOServer"},{label:$t("energy.All"),value:""}],onSelect:(e,a)=>{_.gwType=a.value,C()}},{default:()=>v("div",[v("span",{},$t("energy.Gateway_Type")),v(q,{style:{height:"10px",width:"10px"}})])})},render(e){return e.type?e.type+" - "+e.model:e.model}},{key:"status",width:100,title(e){return v(pe,{options:[{label:$t("energy.online"),value:!0},{label:$t("energy.offline"),value:!1},{label:$t("energy.All"),value:""}],onSelect:(a,d)=>{_.status=d.value,C()}},{default:()=>v("div",[v("span",{},$t("energy.Gateway_Status")),v(q,{style:{height:"10px",width:"10px"}})])})},render:e=>v("div",{class:"icon-span-container"},[v(R,{style:{color:e.status?"#0ABF5F":"red",width:"10px",height:"10px",marginRight:"5px"}}),v("span",{},e.status?$t("energy.online"):$t("energy.offline"))])},{title:$t("energy.IP_Address"),width:180,align:"center",key:"ip",render:e=>{const a=e.ip;return v("span",{innerHTML:a})}},{title:$t("energy.Last_Connection_Time"),key:"lastTime"},{title:$t("energy.Operations"),key:"actions",width:260,align:"center",render(e){return[L(v(k,{size:"small",strong:!0,type:"success",quaternary:!0,onClick:()=>ke(e)},{default:()=>$t("energy.detail")}),[[N,[$t("energy.gateway_List"),"look"]]]),L(v(k,{size:"small",strong:!0,type:"success",quaternary:!0,onClick:()=>Ie(e)},{default:()=>$t("project.configuration")}),[[N,[$t("energy.gateway_List"),"change"]]]),L(v(k,{size:"small",strong:!0,type:"success",quaternary:!0,onClick:()=>je(e)},{default:()=>$t("energy.firmware_upgrade")}),[[N,[$t("energy.gateway_List"),"change"]]]),L(v(k,{size:"small",strong:!0,type:"success",quaternary:!0,onClick:()=>Te(e)},{default:()=>$t("energy.restart")}),[[N,[$t("energy.gateway_List"),"change"]]])]}}],Ie=e=>{e.sandboxId?(x.value=!0,B.value=e,B.value.userId=b.userInfo.userId,window.sessionStorage.setItem("gatewayId",e.sandboxId),window.sessionStorage.setItem("gatewayName",e.name),window.sessionStorage.setItem("gwType",e.model)):w.warning($t("energy.not_been_configured"))},ke=(e,a)=>{p=e,K.value=!0},je=e=>{p=e,i.value=!0},xe=(e,a)=>{U.value=String(e),e=="\u7F51\u5173\u540D\u79F0"?_.type="name":_.type="sn"},Se=e=>{h.value=e,G.value=!0},Ce=()=>{if(y.value.length==0){w.warning($("energy.Select_gateway_delete"));return}let e={projectId:b.projectDetail.id,gatewayId:y.value[0]};H.error({title:$t("project.confirm"),content:()=>$t("project.deleteConfirmation"),showIcon:!1,positiveText:$t("project.sure"),positiveButtonProps:{secondary:!0},negativeText:$t("project.cancel"),onPositiveClick:()=>{aa(e).then(a=>{a.code==200&&C()})}})},Ue=()=>{se.value.click()},Le=e=>{const a=e.target.files[0];if(!a){w.error($t("energy.No_file_selected"));return}const d=new FormData;d.append("file",a),d.append("projectId",b.projectDetail.id),ta(d).then(z=>{z.code==200?C():w.error(z.message)})},Pe=()=>{la(_).then(e=>{oa(e,$t("energy.Gateway_list"),"xlsx")})},Te=e=>{H.success({title:$t("project.confirm"),content:$t("energy.Whether_to_restart_gateway"),positiveText:$t("project.sure"),showIcon:!1,positiveButtonProps:{secondary:!0},negativeText:$t("project.cancel"),onPositiveClick:()=>{Ge(e)}})},Ge=async e=>{const a=await ge({gatewayId:e.id,type:"restart"});var d=new WebSocket(a.data);d.onmessage=z=>{let Q=JSON.parse(z.data).restartStatus,J=JSON.parse(z.data).message;JSON.parse(z.data).type!="tips"?(J=J.replace("\\n",`
`),w.error(J)):w.success(J),Q||d.close()},(await Xe({gatewayId:e.id,projectId:b.projectDetail.id})).code==200||d.close()},Ne=e=>{e&&C(),G.value=!1},ze=()=>{i.value=!1,C()};return(e,a)=>{const d=g("n-form-item"),z=g("n-icon"),Q=g("n-input-group"),J=g("n-form"),De=g("n-space"),Oe=g("n-card"),V=g("n-modal"),oe=g("n-drawer-content"),ie=g("n-drawer"),M=ue("permission");return j(),te("div",null,[L(t(Oe,null,{default:l(()=>[t(J,{ref_key:"formRef",ref:f,inline:"","label-width":80,model:_,"label-placement":"left",style:{width:"90%"}},{default:l(()=>[t(d,null,{default:l(()=>[L((j(),T(n(k),{onClick:a[0]||(a[0]=o=>Se("add"))},{default:l(()=>[I(m(e.$t("energy.add")),1)]),_:1})),[[M,[e.$t("energy.gateway_List"),"add"]]])]),_:1}),t(d,null,{default:l(()=>[L((j(),T(n(k),{onClick:Ce},{default:l(()=>[I(m(e.$t("energy.del")),1)]),_:1})),[[M,[e.$t("energy.gateway_List"),"del"]]])]),_:1}),n(b).userInfo.roleId==1?(j(),T(d,{key:0},{default:l(()=>[L((j(),T(n(k),{onClick:me},{default:l(()=>[I(m(e.$t("energy.mobile_gateway")),1)]),_:1})),[[M,[e.$t("energy.gateway_List"),"change"]]])]),_:1})):O("v-if",!0),t(d,null,{default:l(()=>[L((j(),T(n(k),{onClick:Ue},{default:l(()=>[I(m(e.$t("energy.bulk_import")),1)]),_:1})),[[M,[e.$t("energy.gateway_List"),"change"]]]),D("input",{type:"file",style:{display:"none"},ref_key:"fileInput",ref:se,onChange:Le},null,544)]),_:1}),t(d,null,{default:l(()=>[L((j(),T(n(k),{onClick:Pe},{default:l(()=>[I(m(e.$t("energy.bulk_export")),1)]),_:1})),[[M,[e.$t("energy.gateway_List"),"change"]]])]),_:1}),t(d,null,{default:l(()=>[t(Q,null,{default:l(()=>[t(n(ca),{class:"tree-select",options:be.value,"default-value":U.value,"onUpdate:value":xe},{default:l(()=>[I(m(U.value),1)]),_:1},8,["options","default-value"]),t(n(ce),{value:_.value,"onUpdate:value":a[1]||(a[1]=o=>_.value=o),placeholder:e.$t("energy.search")+e.$t("energy.gateway"),class:"tree-input"},null,8,["value","placeholder"]),t(n(k),{onClick:_e},{icon:l(()=>[t(z,null,{default:l(()=>[t(n(r))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),O(` <n-button style="float: right;" @click="changeTab" v-permission="[$t('energy.gateway_List'), 'change']">{{$t('energy.switch_map')}}</n-button> `),t(n(Me),{"checked-row-keys":y.value,"onUpdate:checkedRowKeys":a[2]||(a[2]=o=>y.value=o),columns:$e,data:W.value,style:Ae({height:`${F.value}px`}),"flex-height":""},null,8,["checked-row-keys","data","style"]),t(De,{justify:"end",style:{"margin-top":"15px"}},{default:l(()=>[t(n(He),{class:"pagination-top",page:_.page,"onUpdate:page":a[3]||(a[3]=o=>_.page=o),"page-size":_.size,"onUpdate:pageSize":a[4]||(a[4]=o=>_.size=o),"item-count":n(ne),"page-sizes":[10,20,50,100],"show-size-picker":"","on-update:page":fe,"on-update:page-size":he},{prefix:l(({itemCount:o})=>[I(m(e.$t("project.total"))+" "+m(o)+" "+m(e.$t("project.items")),1)]),_:1},8,["page","page-size","item-count"])]),_:1})]),_:1},512),[[ye,n(re)=="gateWay"]]),L(D("div",_a,[O(` <n-button @click="changeTab"
        style="margin-bottom: 10px; float: right;">{{$t('energy.return_list')}}</n-button> `),a[11]||(a[11]=D("div",null,[D("div",{id:"container"})],-1))],512),[[ye,n(re)=="Map"]]),S.value?(j(),T(V,{key:0,show:S.value,"onUpdate:show":a[6]||(a[6]=o=>S.value=o),style:{width:"20%"},preset:"card",title:e.$t("energy.switch")+e.$t("energy.project")},{footer:l(()=>[t(n(k),{style:{float:"right"},onClick:we},{default:l(()=>[I(m(e.$t("project.sure")),1)]),_:1})]),default:l(()=>[t(d,{label:e.$t("energy.project_list"),"label-placement":"left"},{default:l(()=>[t(n(We),{value:P.value.newProjectId,"onUpdate:value":a[5]||(a[5]=o=>P.value.newProjectId=o),options:u.value,filterable:"","label-field":"name","value-field":"id"},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["show","title"])):O("v-if",!0),G.value?(j(),T(V,{key:1,show:G.value,"onUpdate:show":a[7]||(a[7]=o=>G.value=o),style:{width:"40%"}},{default:l(()=>[t(ya,{projectParams:c,onClosePopup:Ne},null,8,["projectParams"])]),_:1},8,["show"])):O("v-if",!0),i.value?(j(),T(V,{key:2,show:i.value,"onUpdate:show":a[8]||(a[8]=o=>i.value=o),style:{width:"60%"}},{default:l(()=>[t(Ye,{projectParams:n(p),onCloseFirmware:ze},null,8,["projectParams"])]),_:1},8,["show"])):O("v-if",!0),n(x)?(j(),T(ie,{key:3,show:n(x),"onUpdate:show":a[9]||(a[9]=o=>Ee(x)?x.value=o:x=o),width:"85vw",placement:"right"},{default:l(()=>[t(oe,{title:e.$t("energy.Engineering_configuration"),closable:""},{default:l(()=>[t(ha,{childList:n(B)},null,8,["childList"])]),_:1},8,["title"])]),_:1},8,["show"])):O("v-if",!0),t(ie,{show:K.value,"onUpdate:show":a[10]||(a[10]=o=>K.value=o),width:"70vw",placement:"right"},{default:l(()=>[t(oe,{title:e.$t("energy.gateway")+e.$t("energy.detail"),closable:""},{default:l(()=>[t(ea,{projectParams:n(p)},null,8,["projectParams"])]),_:1},8,["title"])]),_:1},8,["show"])])}}}),$a=le(ba,[["__scopeId","data-v-882bf3b9"],["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/gateway/index.vue"]]);export{$a as default};
