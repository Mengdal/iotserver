import{d as L,u as G,r as g,al as Y,o as W,f as b,h,i as U,l,w as t,n as r,av as P,aw as ee,p,t as u,ax as ae,ay as y,ap as D,az as F,D as I,j as T,aA as M,k as w,an as E,aB as le,_ as Z,ae as K,V as te,ak as re,af as J,O as Q,b as se,au as ie}from"./index-35337fd3.js";import{C as de,D as ue,E as ne,F as oe,T as pe,G as ve,H as ce,I as ye,J as ge}from"./energy-f0146bb7.js";import{i as me}from"./icon-ebc544b2.js";import{N as H}from"./RadioButton-47b7c95b.js";const he={style:{"font-size":"12px"}},fe={style:{"font-size":"12px"}},_e={key:1},$e={style:{"font-size":"12px"}},be={key:2},ke={style:{"margin-right":"5px"}},je={style:{"margin-left":"5px"}},Ie=L({__name:"popup",props:{isEdit:String,taskParams:Object},emits:["closePopup"],setup(v,{emit:q}){const x=G(),k=v,{HelpIcon:f}=me.carbon,z=g(null),e=g({taskName:"",type:"",level:"",status:"ACTIVE",min:"",max:"",within:!1,property:"",deviceArray:[],deviceId:"",projectCategoryId:"",alertOptionIds:[],modeType:"Balanced",frequency:5,alertType:"alert"}),B=g(""),C={taskName:[{required:!0,message:$t("energy.please_enter"),trigger:"blur"}],projectCategoryId:[{type:"number",required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],level:[{required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],deviceId:[{type:"number",required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],deviceArray:[{type:"array",required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],property:[{type:"number",required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],type:[{required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}],alertOptionIds:[{type:"array",required:!0,message:$t("energy.please_select"),trigger:["change","blur"]}]},N=g([]),m=g([]),A=g([]),S=g([]),_=q,R=a=>{e.value.deviceId=a,m.value.findIndex(s=>s.deviceId===a),i(a)},O=a=>{let s={page:1,size:9999,projectId:x.projectDetail.id};ne(s).then(n=>{n.code===200&&(m.value=n.data.list)})},i=a=>{oe({page:1,size:9999,deviceId:a}).then(s=>{s.code===200&&(A.value=s.data.list)})},c=a=>{console.log(e.value),a.preventDefault(),z.value?.validate(s=>{if(!s){let n=e.value.projectCategoryId?e.value.deviceArray.join(","):e.value.deviceId,j=e.value.projectCategoryId?e.value.projectCategoryId:B.value,$=e.value.alertOptionIds?e.value.alertOptionIds.join(","):"";if(k.isEdit==="add"){let o={taskName:e.value.taskName,status:e.value.status,type:e.value.type,level:e.value.level,min:e.value.min,max:e.value.max,within:e.value.within,property:e.value.property,frequency:e.value.frequency,deviceIds:n,projectCategoryId:j,alertOptionIds:$};if(e.value.alertType=="alert")pe(o).then(d=>{d.code===200&&(window.$message.success($t("project.operationSuccess")),_("closePopup","creat"))});else{let d={reportZero:!1,deviceIds:n,alertOptionIds:$,taskName:e.value.taskName,status:e.value.status,property:e.value.property,level:e.value.level,modeType:e.value.modeType,frequency:e.value.frequency};ve(d).then(X=>{X.code===200&&(window.$message.success($t("project.operationSuccess")),_("closePopup","creat"))})}}else{let o={taskName:e.value.taskName,status:e.value.status,modeType:e.value.modeType,frequency:e.value.frequency,id:k.taskParams.id,deviceIds:n,alertOptionIds:$};e.value.alertType=="alert"&&delete o.modeType,ce(o).then(d=>{d.code===200&&(window.$message.success($t("project.operationSuccess")),_("closePopup","edit"))})}}})},V=()=>{_("closePopup","")};return Y(()=>{de({projectId:x.projectDetail.id,page:1,size:9999}).then(a=>{a.code==200&&(N.value=a.data.tableData,N.value.unshift({id:"",displayName:""}))})}),W(()=>{if(O(),ue({page:1,size:9999,projectId:x.projectDetail.id}).then(a=>{a.code===200&&(S.value=a.data)}),k.isEdit==="edit"){console.log(k.taskParams,k.isEdit);let a=k.taskParams;a.type==="deadman"?(e.value.modeType=a.thresholds[0].value,e.value.alertType=a.type=="deadman"?"deadMan":"alert"):(e.value.type=a.thresholds[0].type,a.thresholds[0].type==="range"?(e.value.min=""+a.thresholds[0].min,e.value.max=""+a.thresholds[0].max):e.value.min=""+a.thresholds[0].value,e.value.within=a.thresholds[0].within),e.value.taskName=a.name,e.value.frequency=a.every.split("m")[0],e.value.level=a.thresholds[0].level,e.value.status=a.status==="active"?"ACTIVE":"inactive";let s=a.description.split("_");O(),i(JSON.parse(s[3])[0]),e.value.deviceId=JSON.parse(s[3])[0],e.value.alertOptionIds=JSON.parse(s[6]),e.value.property=Number(s[4])}}),(a,s)=>{const n=b("n-radio"),j=b("n-icon"),$=b("n-popover"),o=b("n-switch");return h(),U("div",null,[l(r(le),null,{header:t(()=>[l(r(P),null,{default:t(()=>[l(r(ee),null,{default:t(()=>[p(u(v.isEdit=="add"?a.$t("energy.add"):a.$t("energy.edit"))+" "+u(a.$t("energy.warn")),1)]),_:1})]),_:1})]),default:t(()=>[l(r(ae),{model:e.value,"label-placement":"left","label-width":"120",rules:C,ref_key:"formRef",ref:z},{default:t(()=>[l(r(y),{label:a.$t("energy.Alert_Name"),path:"taskName"},{default:t(()=>[l(r(D),{value:e.value.taskName,"onUpdate:value":s[0]||(s[0]=d=>e.value.taskName=d),placeholder:a.$t("energy.please_enter")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(r(y),{label:a.$t("energy.device"),path:"deviceId"},{default:t(()=>[l(r(F),{value:e.value.deviceId,"onUpdate:value":s[1]||(s[1]=d=>e.value.deviceId=d),placeholder:a.$t("energy.please_select"),options:m.value,"on-update:value":R,"label-field":"name","value-field":"id",disabled:v.isEdit=="edit"},null,8,["value","placeholder","options","disabled"])]),_:1},8,["label"]),A.value.length?(h(),I(r(y),{key:0,label:a.$t("project.property"),path:"property"},{default:t(()=>[l(r(F),{value:e.value.property,"onUpdate:value":s[2]||(s[2]=d=>e.value.property=d),placeholder:a.$t("energy.please_select"),options:A.value,"label-field":"name","value-field":"id",disabled:v.isEdit=="edit"},null,8,["value","placeholder","options","disabled"])]),_:1},8,["label"])):T("v-if",!0),l(r(y),{label:a.$t("energy.Alarm_Type")},{default:t(()=>[l(r(M),{value:e.value.alertType,"onUpdate:value":s[3]||(s[3]=d=>e.value.alertType=d),disabled:v.isEdit=="edit"},{default:t(()=>[l(n,{value:"alert"},{default:t(()=>[p(u(a.$t("energy.Device_Attribute_Change")),1)]),_:1}),l(n,{value:"deadMan"},{default:t(()=>[p(u(a.$t("energy.Attribute_Activity_Monitoring")),1)]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"]),l(r(y),{label:e.value.alertType=="deadMan"?a.$t("energy.Collection_Cycle")+"("+a.$t("project.m")+")":a.$t("energy.Device_Silence_Time")+"("+a.$t("project.m")+")",path:"frequency"},{default:t(()=>[e.value.alertType=="alert"?(h(),I($,{key:0,trigger:"hover"},{trigger:t(()=>[l(j,{style:{"margin-left":"-10px","margin-right":"5px"},depth:"3"},{default:t(()=>[l(r(f))]),_:1})]),default:t(()=>[w("div",he,[w("div",null," \u2460"+u(a.$t("energy.Device_Silence_Time_Tips1")),1),w("div",null," \u2461 "+u(a.$t("energy.Device_Silence_Time_Tips2")),1)])]),_:1})):(h(),I($,{key:1,trigger:"hover"},{trigger:t(()=>[l(j,{style:{"margin-left":"-10px","margin-right":"5px"},depth:"3"},{default:t(()=>[l(r(f))]),_:1})]),default:t(()=>[w("div",fe,u(a.$t("energy.Collection_Cycle_tips")),1)]),_:1})),l(r(D),{disabled:v.isEdit=="edit",value:e.value.frequency,"onUpdate:value":s[4]||(s[4]=d=>e.value.frequency=d),placeholder:a.$t("energy.please_enter")},null,8,["disabled","value","placeholder"])]),_:1},8,["label"]),e.value.alertType=="deadMan"?(h(),U("div",_e,[l(r(y),{label:a.$t("energy.Monitoring_Strategy"),path:""},{default:t(()=>[l($,{trigger:"hover"},{trigger:t(()=>[l(j,{style:{"margin-left":"-10px","margin-right":"5px"},depth:"3"},{default:t(()=>[l(r(f))]),_:1})]),default:t(()=>[w("div",$e,u(a.$t("energy.Monitoring_Strategy_tips")),1)]),_:1}),l(r(M),{value:e.value.modeType,"onUpdate:value":s[5]||(s[5]=d=>e.value.modeType=d),disabled:v.isEdit=="edit"},{default:t(()=>[l(n,{value:"Conservative"},{default:t(()=>[p(u(a.$t("energy.Conservative")),1)]),_:1}),l(n,{value:"Balanced"},{default:t(()=>[p(u(a.$t("energy.Balanced")),1)]),_:1}),l(n,{value:"Aggressive"},{default:t(()=>[p(u(a.$t("energy.Aggressive")),1)]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])])):T("v-if",!0),e.value.alertType=="alert"?(h(),U("div",be,[l(r(y),{label:a.$t("energy.Filter_type"),span:12,path:"type"},{default:t(()=>[l(r(M),{name:"radiogroup2",value:e.value.type,"onUpdate:value":s[6]||(s[6]=d=>e.value.type=d),disabled:v.isEdit=="edit"},{default:t(()=>[l(r(H),{value:"greater"},{default:t(()=>[p(u(a.$t("energy.greater")),1)]),_:1}),l(r(H),{value:"lesser"},{default:t(()=>[p(u(a.$t("energy.less")),1)]),_:1}),l(r(H),{value:"range"},{default:t(()=>[p(u(a.$t("energy.range")),1)]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"]),e.value.type=="range"?(h(),I(r(y),{key:0,label:a.$t("project.max_value")},{default:t(()=>[l(r(D),{value:e.value.max,"onUpdate:value":s[7]||(s[7]=d=>e.value.max=d),placeholder:a.$t("energy.please_enter"),disabled:v.isEdit=="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])):T("v-if",!0),l(r(y),{label:e.value.type=="range"?a.$t("project.min_value"):a.$t("energy.value")},{default:t(()=>[l(r(D),{value:e.value.min,"onUpdate:value":s[8]||(s[8]=d=>e.value.min=d),placeholder:a.$t("energy.please_enter"),disabled:v.isEdit=="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),e.value.type=="range"?(h(),I(r(y),{key:1,label:a.$t("energy.range")},{default:t(()=>[w("span",ke,u(a.$t("energy.outer")),1),l(o,{value:e.value.within,"onUpdate:value":s[9]||(s[9]=d=>e.value.within=d),"unchecked-value":!1,"checked-value":!0,disabled:v.isEdit=="edit"},null,8,["value","disabled"]),w("span",je,u(a.$t("energy.within")),1)]),_:1},8,["label"])):T("v-if",!0)])):T("v-if",!0),l(r(y),{label:a.$t("energy.Alert_Level"),path:"level"},{default:t(()=>[l(r(M),{name:"radiogroup1",value:e.value.level,"onUpdate:value":s[10]||(s[10]=d=>e.value.level=d),disabled:v.isEdit=="edit"},{default:t(()=>[l(r(P),null,{default:t(()=>[l(n,{value:"CRIT"},{default:t(()=>[p(u(a.$t("energy.crit")),1)]),_:1}),l(n,{value:"WARN"},{default:t(()=>[p(u(a.$t("energy.urgency")),1)]),_:1}),l(n,{value:"INFO"},{default:t(()=>[p(u(a.$t("energy.general")),1)]),_:1})]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"]),l(r(y),{label:a.$t("energy.Notification_Group")},{default:t(()=>[l(r(F),{value:e.value.alertOptionIds,"onUpdate:value":s[11]||(s[11]=d=>e.value.alertOptionIds=d),placeholder:a.$t("energy.please_select"),options:S.value,"label-field":"name","value-field":"id",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),l(r(y),{label:a.$t("energy.activate")},{default:t(()=>[l(o,{value:e.value.status,"onUpdate:value":s[12]||(s[12]=d=>e.value.status=d),"unchecked-value":"inactive","checked-value":"ACTIVE"},null,8,["value"])]),_:1},8,["label"]),l(r(P),{justify:"flex-end"},{default:t(()=>[l(r(P),null,{default:t(()=>[l(r(E),{size:"medium",onClick:V},{default:t(()=>[p(u(a.$t("project.cancel")),1)]),_:1}),l(r(E),{size:"medium",type:"primary",onClick:c,secondary:""},{default:t(()=>[p(u(a.$t("project.save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),we=Z(Ie,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/warn/popup.vue"]]),Te=L({__name:"addPopup",setup(v){const q=K("permission"),x=te(()=>window.innerHeight-210),k=G(),f=g(!1),z=re();let e=g({});const B=g([{title:$t("energy.Alert_Name"),key:"name"},{title:$t("energy.Alert_Level"),key:"thresholds",render(i){return i.thresholds[0].level=="CRIT"?$t("energy.crit"):i.thresholds[0].level=="INFO"?$t("energy.general"):$t("energy.urgency")}},{title:$t("energy.Alert_Threshold"),key:"thresholds",render(i){if(i.type=="threshold"){if(i.thresholds[0].type=="range")return $t("energy.range")+"\uFF1A"+i.thresholds[0].max+"~"+i.thresholds[0].min;if(i.thresholds[0].type=="greater")return $t("energy.greater")+"\uFF1A"+i.thresholds[0].value;if(i.thresholds[0].type=="lesser")return $t("energy.less")+"\uFF1A"+i.thresholds[0].value}else return`${$t("energy.Attribute_Activity_Monitoring")}: ${i.thresholds[0].value=="Balanced"?$t("energy.Balanced"):i.thresholds[0].value=="Conservative"?$t("energy.Conservative"):$t("energy.Aggressive")}`}},{title:$t("energy.Activation_Status"),key:"status",render(i){return i.status=="active"?$t("energy.activate"):$t("energy.not_activated")}},{title:$t("energy.Operations"),key:"actions",render(i){return[J(Q(E,{type:"primary",size:"small",quaternary:!0,onClick:c=>{f.value=!0,C.value="edit",N.value=i}},{default:()=>$t("energy.edit")}),[[q,[$t("energy.warn_rule"),"change"]]]),J(Q(E,{type:"error",size:"small",quaternary:!0,style:{marginLeft:"10px"},onClick:()=>{z.error({title:$t("project.confirm"),content:()=>$t("project.deleteConfirmation"),showIcon:!1,positiveText:$t("project.sure"),positiveButtonProps:{secondary:!0},negativeText:$t("project.cancel"),onPositiveClick:()=>{ye({id:i.id}).then(c=>{c.code==200&&(window.$message.success($t("project.deleteSuccess")),_())})}})}},{default:()=>$t("project.delete")}),[[q,[$t("energy.warn_rule"),"del"]]])]}}]),C=g("add");let N=g({});const m=se({page:1,size:10,projectId:k.projectDetail.id,checkType:"",deviceName:"",handler:""}),A=i=>{m.page=i,_()},S=i=>{m.size=i,_()};W(()=>{_()});const _=()=>{ge({...m}).then(i=>{i.code==200&&(e.value=i.data)})},R=i=>{C.value=i,f.value=!0},O=i=>{i&&_(),f.value=!1};return(i,c)=>{const V=b("n-data-table"),a=b("n-pagination"),s=b("n-space"),n=b("n-card"),j=b("n-modal"),$=K("permission");return h(),U("div",null,[l(n,null,{default:t(()=>[J((h(),I(r(E),{onClick:c[0]||(c[0]=o=>R("add")),style:{"margin-bottom":"10px"}},{default:t(()=>[p(u(i.$t("energy.add")),1)]),_:1})),[[$,[i.$t("energy.warn_rule"),"add"]]]),l(V,{columns:B.value,data:r(e).tableData,style:ie({height:`${x.value}px`}),"flex-height":""},null,8,["columns","data","style"]),l(s,{justify:"end",style:{"margin-top":"15px"}},{default:t(()=>[l(a,{page:m.page,"onUpdate:page":[c[1]||(c[1]=o=>m.page=o),A],"page-size":m.size,"onUpdate:pageSize":[c[2]||(c[2]=o=>m.size=o),S],"page-sizes":[10,20,50,100],"item-count":r(e).totalElements,"show-size-picker":"","page-slot":7},{prefix:t(({itemCount:o})=>[p(u(i.$t("project.total"))+" "+u(o)+" "+u(i.$t("project.items")),1)]),_:1},8,["page","page-size","item-count"])]),_:1})]),_:1}),f.value?(h(),I(j,{key:0,show:f.value,"onUpdate:show":c[3]||(c[3]=o=>f.value=o),style:{width:"40%"}},{default:t(()=>[l(we,{taskParams:r(N),isEdit:C.value,onClosePopup:O},null,8,["taskParams","isEdit"])]),_:1},8,["show"])):T("v-if",!0)])}}}),xe=Z(Te,[["__file","/Users/cyj/Desktop/work project/Scada-4.21/newScada/src/views/energy/warn/addPopup.vue"]]);export{xe as default};
