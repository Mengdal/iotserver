import{x as K,r as v,y as R,z as H,P as o,H as a,B as F,M as d,E as J,u as n,I as X,Q as Y,A as f,D as Q,c as z,j as Z,ag as I,L as h,V as D,O as ee}from"./vue-chunks-C1K3ngR7.js";import{f as te,y as A,z as U,A as q}from"./index-BTXJkdku.js";import{u as oe}from"./useForm-CD85wrwf.js";import{u as ne}from"./useValidator-Barz9SCp.js";import{w as ae,p as se,am as le,ar as ie,b as C,i as M}from"./element-plus--V1NSjC4.js";import{_ as ce}from"./ResizeDialog.vue_vue_type_script_setup_true_lang-BMzjBTUt.js";import{F as re}from"./Form-CzZbC4Aj.js";import{_ as G,c as de,g as ue}from"./index-CAdyeJt3.js";/* empty css                *//* empty css                */import{_ as me}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import"./index-DfycOL0q.js";import"./Dialog.vue_vue_type_style_index_0_lang-aEWcq84Q.js";/* empty css                  *//* empty css               *//* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                       *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";import"./wang-editor-Bckixh16.js";/* empty css                */const pe={key:1},fe="300px",ve="400px",_e=K({__name:"Tree",props:{data:{},treeProps:{},width:{},height:{}},emits:["node-click","node-expand","node-collapse"],setup(O,{emit:e}){const k=O,x=e,u=v(null),w=v(!1),_=v(null),c=v({}),m=()=>{w.value=!1,document.removeEventListener("click",m),document.removeEventListener("contextmenu",m)},y=(l,g,b,W)=>{if(_.value=g,!u.value)return;const P=u.value.getBoundingClientRect(),S=l.target.getBoundingClientRect(),j=S.top-P.top+u.value.scrollTop,t=S.left-P.left+u.value.scrollLeft;c.value={position:"absolute",top:`${j+20}px`,left:`${t+20}px`},w.value=!0,document.addEventListener("click",m),document.addEventListener("contextmenu",m)},L=l=>{x("node-click",l),m()},B=l=>{x("node-expand",l),m()},V=l=>{x("node-collapse",l),m()},p={position:"relative",overflow:"auto",width:k.width??fe,height:k.height??ve};return(l,g)=>(R(),H("div",{class:"tree-container",ref_key:"treeContainer",ref:u,style:p},[o(n(ae),J(l.treeProps,{data:l.data,onNodeClick:L,onNodeExpand:B,onNodeCollapse:V,onNodeContextmenu:y}),{default:a(({node:b})=>[l.$slots["render-node"]?F(l.$slots,"render-node",{key:0,node:b},void 0,!0):(R(),H("span",pe,d(b.label),1))]),_:3},16,["data"]),X(f("div",{class:"treeMenu",style:Q(c.value)},[F(l.$slots,"context-menu",{node:_.value,data:_.value},()=>[g[0]||(g[0]=f("div",{style:{padding:"8px"}},"No menu defined",-1))],!0)],4),[[Y,w.value]]),F(l.$slots,"default",{},void 0,!0)],512))}}),ge=G(_e,[["__scopeId","data-v-7d0f448c"]]),he=["onClick"],ye=["onClick"],Ce=["onClick"],ke={class:"custom-tree-node"},xe=K({__name:"PositionManage",setup(O){const{t:e}=de(),k=ue();let x=k.getProject;const u=v(x.enable?k.getProjectId:void 0),{formRegister:w,formMethods:_}=oe();v(!1);const c=v(!1),{required:m}=ne();let y=v("add");const L=z(()=>window.innerHeight-130),B=v([]),V=z(()=>[{field:"name",label:e("device.locationName"),component:"Input",formItemProps:{rules:[m()]},componentProps:{}}]);Z(async()=>{p()});const p=async()=>{const t=await te();t.code===200&&(B.value[0]=t.data)},l=async()=>{try{const{getFormData:t,getElFormExpose:i}=_,s=await t();(await i())?.validate(async N=>{N&&(y.value=="add"?(await A(s)).code===200&&(C.success(e("device.operationSuccess")),c.value=!1,p()):(await U(s)).code===200&&(C.success(e("device.operationSuccess")),c.value=!1,p()))})}finally{}},g=async(t,i)=>{if(t.data,i=="delete")M.confirm(`${e("common.delMessage")}:${t.label}`,e("common.delWarning"),{confirmButtonText:e("formDemo.delete"),cancelButtonText:e("common.delCancel"),type:"warning"}).then(()=>{q({id:t.data.id,projectId:u.value}).then(s=>{s.code===200&&(C({type:"success",message:e("common.delSuccess")}),p())}).catch(s=>{console.error("删除失败",s)})}).catch(()=>{C({type:"info",message:e("common.delCancel")})});else if(i=="add")try{y.value="add",c.value=!0,_.setValues({parentId:t.data.id})}finally{}else if(i=="edit")try{y.value="edit",c.value=!0,_.setValues({name:t.data.name,id:t.data.id})}finally{}},b=async()=>{_.setValues({}),y.value="add",c.value=!0},W=t=>{},P=t=>{M.prompt("",e("device.addLocation"),{confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),inputPattern:/\S/,inputErrorMessage:e("device.locationNameCannotBeEmpty"),inputPlaceholder:e("device.pleaseEnterLocationName")}).then(async({value:i})=>{(await A({projectId:u.value,name:i,parentId:t.id})).code===200&&(C.success(e("device.operationSuccess")),c.value=!1,p())})},S=t=>{M.prompt("",e("base.modify_location_name"),{confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),inputValue:t.name,inputPattern:/\S/,inputErrorMessage:e("base.location_name_cannot_be_empty"),inputPlaceholder:e("device.pleaseEnterNewLocationName")}).then(async({value:i})=>{(await U({projectId:u.value,id:t.id,name:i})).code===200&&(C.success(e("base.success")),c.value=!1,p())})},j=t=>{M.confirm(`${e("base.delete_location_and_sub_locations")}[${t.name}] ?`,e("common.delWarning"),{dangerouslyUseHTMLString:!0,confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),type:"warning",center:!0}).then(()=>{const i=t.id;q({id:i,projectId:u.value}).then(s=>{s.code===200&&(C({type:"success",message:e("common.delSuccess")}),p())}).catch(s=>{console.error("删除失败",s)})})};return(t,i)=>{const s=I("el-button"),E=I("Permission"),N=I("el-icon"),T=I("BaseButton");return R(),H(ee,null,[o(n(me),null,{default:a(()=>[o(E,{permission:"Create"},{default:a(()=>[o(s,{type:"primary",onClick:b},{default:a(()=>[h("+ "+d(n(e)("device.create")),1)]),_:1})]),_:1}),o(n(ge),{data:B.value,"tree-props":{"default-expand-all":!0,highlightCurrent:!0,nodeKey:"id",props:{children:"children",label:"name"}},style:Q({height:L.value+"px",overflow:"auto"}),width:"100%",onNodeClick:W},{"context-menu":a(({node:r})=>[f("div",{class:"menuItem",onClick:$=>P(r)},[o(N,{color:"#688fe4"},{default:a(()=>[o(n(se))]),_:1}),f("span",null,d(n(e)("device.addSubLocation")),1)],8,he),f("div",{class:"menuItem",onClick:$=>S(r)},[o(N,{color:"#688fe4"},{default:a(()=>[o(n(le))]),_:1}),h(" "+d(n(e)("device.modifyLocationName")),1)],8,ye),f("div",{class:"menuItem",onClick:$=>j(r)},[o(N,{color:"#688fe4"},{default:a(()=>[o(n(ie))]),_:1}),h(" "+d(n(e)("device.deleteLocationAndSubLocations")),1)],8,Ce)]),"render-node":a(({node:r})=>[f("div",ke,[f("span",null,d(r.label),1),f("div",null,[o(E,{permission:"Create"},{default:a(()=>[o(s,{type:"warning",link:"",onClick:D($=>g(r,"add"),["stop"])},{default:a(()=>[h(d(n(e)("device.create")),1)]),_:2},1032,["onClick"])]),_:2},1024),o(E,{permission:"Edit"},{default:a(()=>[o(s,{type:"primary",link:"",onClick:D($=>g(r,"edit"),["stop"])},{default:a(()=>[h(d(n(e)("device.edit")),1)]),_:2},1032,["onClick"])]),_:2},1024),o(E,{permission:"Delete"},{default:a(()=>[o(s,{type:"danger",link:"",onClick:D($=>g(r,"delete"),["stop"])},{default:a(()=>[h(d(n(e)("device.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["data","style"])]),_:1}),o(ce,{modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=r=>c.value=r),title:n(y)=="add"?n(e)("base.add_location"):n(e)("base.edit_location"),initHeight:50,initWidth:450,fullscreen:!1},{footer:a(()=>[o(T,{type:"primary",onClick:l},{default:a(()=>[h(d(n(e)("common.ok")),1)]),_:1}),o(T,{onClick:i[0]||(i[0]=r=>c.value=!1)},{default:a(()=>[h(d(n(e)("common.cancel")),1)]),_:1})]),default:a(()=>[o(n(re),{schema:V.value,onRegister:n(w),isCol:!1},null,8,["schema","onRegister"])]),_:1},8,["modelValue","title"])],64)}}}),qe=G(xe,[["__scopeId","data-v-cc422a57"]]);export{qe as default};
