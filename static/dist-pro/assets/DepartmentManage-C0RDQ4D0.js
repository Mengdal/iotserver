import{x as Te,aA as ke,r as i,X as q,j as Ve,ag as f,aq as Ie,y as g,z as F,P as t,H as s,u as e,A as I,L as c,M as u,I as Ce,G as x,K as R,a6 as Ne,V as M,O as J,a4 as te}from"./vue-chunks-C1K3ngR7.js";import{_ as we}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{_ as $e}from"./Search.vue_vue_type_script_setup_true_lang-BCCD0GAn.js";import{c as Ee,e as U,i as H,f as ze,_ as Pe}from"./index-CAdyeJt3.js";/* empty css               */import{g as Ae,d as Re,b as oe,c as Me,u as Ue}from"./index-DHVFwXOq.js";import{m as Se,d as h,i as Le,b as G}from"./element-plus--V1NSjC4.js";/* empty css                *//* empty css                  */import"./Form-CzZbC4Aj.js";/* empty css               *//* empty css                */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                       *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";import"./useForm-CD85wrwf.js";import"./index-DfycOL0q.js";const Be={class:"mb-10px"},Oe={style:{display:"flex",width:"100%",gap:"19px"}},je={style:{"line-height":"20px","font-size":"16px"}},qe={style:{display:"flex",width:"100%",gap:"19px"}},Fe={style:{"line-height":"20px","font-size":"16px"}},Je=Te({__name:"DepartmentManage",setup(He){const{t:l}=Ee(),{addRoute:Ge,push:se}=ke(),C=i([]),d=i({email:"",leader:"",level_type:"",name:"",parentId:"",phone:"",remark:"",sort:"",status:"1",deviceIds:[]}),N=i([]),W=i([{value:14,label:`14${l("device.per")}/${l("device.page")}`},{value:30,label:`30${l("device.per")}/${l("device.page")}`},{value:50,label:`50${l("device.per")}/${l("device.page")}`},{value:100,label:`100${l("device.per")}/${l("device.page")}`},{value:1e3,label:`1000${l("device.per")}/${l("device.page")}`}]);let p=i({page:1,size:14,departmentId:null,total:0}),m=i({page:1,size:14,departmentId:null,total:0});const w=i([]),X=i(),$=i([]),S=i(""),y=i(!1),L=i(""),_=i([]),ne=i(null),T=i(""),B=i(!1),de=i(!1),K=i(null),re=q([{field:"field1",label:l("userDemo.departmentName"),component:"Input"}]),Q=async n=>{K.value=n.field1,E()},E=async()=>{B.value=!0;try{const n=await Ae({keyword:K.value});n.code===200&&(w.value=z(n.data)?n.data:[])}finally{B.value=!1}},ue=q({checkStrictly:!1}),O=async(n,a)=>{if(ee(),n=="detail")se(`/system/departmentManage/detail/${JSON.stringify({departmentId:a.id})}`);else if(n=="edit")S.value=a.id,L.value=l("exampleDemo.edit"),j(),$.value=z(w.value),d.value={email:a.email||"",leader:a.leader||"",level_type:a.level_type||"",name:a.name||"",parentId:a.parentId||"",phone:a.phone||"",remark:a.remark||"",sort:a.sort||"",status:a.status||"1",deviceIds:a.deviceIds},d.value,T.value="edit",y.value=!0;else if(n=="del"){await Le.confirm(l("common.delMessage"),l("common.delWarning"),{confirmButtonText:l("common.ok"),cancelButtonText:l("common.cancel"),type:"warning"});let r={id:a.id};(await Re(r)).code===200&&G.success(l("device.operationSuccess"))}},z=n=>!n||!Array.isArray(n)?[]:n.map(a=>{const r={value:a.id,label:a.name};return a.children&&Array.isArray(a.children)&&a.children.length>0?r.children=z(a.children):r.children=null,r}),P=async()=>{let n={page:p.value.page,size:p.value.size},a=await oe(n);a.code===200&&(_.value=a.data.list.map(r=>({key:r.id,label:r.name})),p.value.total=a.data.totalPage),_.value},j=async()=>{await P();let n={page:m.value.page,size:m.value.size,departmentId:S.value},a=await oe(n);if(a.code===200){let r=a.data.list.map(v=>({key:v.id,label:v.name}));_.value.push(...r),d.value.deviceIds=a.data.list.map(v=>v.id),m.value.total=a.data.totalPage}_.value,d.value.deviceIds},Y=async n=>{n==="prev"&&p.value.page>1?p.value.page-=1:n==="next"&&p.value.page<p.value.total&&(p.value.page+=1),await P(),_.value.push(...N.value),_.value},Z=async n=>{n==="prev"&&m.value.page>1?m.value.page-=1:n==="next"&&m.value.page<m.value.total&&(m.value.page+=1),await j()},ie=async()=>{ee(),await P(),$.value=z(w.value),$.value,L.value=l("exampleDemo.add"),ne.value=null,y.value=!0,T.value="add"},pe=n=>{switch(n){case"PROJECT":return l("device.project");case"DEPARTMENT":return l("device.DEPARTMENT");case"TENANT":return l("device.TENANT")}},me=async n=>{n&&await n.validate(async(a,r)=>{if(a){if(T.value==="add"){let v={...d.value,sort:Number(d.value.sort)||0,parentId:Number(d.value.parentId)||0},V=await Me(v);V.code==200&&(y.value=!1,G.success(l("base.success")),await E())}else if(T.value==="edit"){let v={...d.value,sort:Number(d.value.sort)||0,id:S.value,parentId:Number(d.value.parentId)||0};(await Ue(v)).code==200&&(y.value=!1,G.success(l("base.success")),await E())}}})},ee=()=>{d.value={email:"",leader:"",level_type:"",name:"",parentId:"",phone:"",remark:"",sort:"",status:"1",deviceIds:[]},p.value={page:1,size:14,departmentId:null,total:0},m.value={page:1,size:14,departmentId:null,total:0},N.value=[]},ce=q({parentId:[{required:!0,message:l("base.Pleaseselecttheparentdepartment")}],level_type:[{required:!0,message:l("base.Selectthenodetype")}],name:[{required:!0,message:l("base.Enterthenodename")}],status:[{required:!0,message:l("base.Pleaseselectastatus")}]});Ve(()=>{E()});const ve=(n,a,r)=>{fe(n),d.value.deviceIds=n,a==="right"?C.value=[...C.value,...r]:a==="left"&&(C.value=C.value.filter(v=>!r.includes(v)))},fe=n=>{N.value=_.value.filter(a=>n.includes(a.key)),N.value,_.value},be=n=>{p.value.page=1,P()},ge=n=>{m.value.page=1,j()};return(n,a)=>{const r=f("el-table-column"),v=f("el-text"),V=f("el-table"),le=f("el-divider"),_e=f("el-tree-select"),b=f("el-form-item"),D=f("el-option"),A=f("el-select"),k=f("el-input"),ye=f("el-transfer"),De=f("el-form"),xe=f("el-drawer"),he=Ie("loading");return g(),F(J,null,[t(e(we),null,{default:s(()=>[t(e($e),{schema:re,onSearch:Q,onReset:Q},null,8,["schema"]),I("div",Be,[t(e(U),{permission:"Create"},{default:s(()=>[t(e(H),{type:"primary",onClick:ie},{default:s(()=>[c("+ "+u(e(l)("exampleDemo.add")),1)]),_:1})]),_:1})]),Ce((g(),x(V,{ref:"tableRef",data:w.value,"default-expand-all":"","row-key":"id","tree-props":ue},{default:s(()=>[t(r,{prop:"name",label:e(l)("device.name"),width:"190"},null,8,["label"]),t(r,{prop:"level_type",label:e(l)("device.type")},{default:s(({row:o})=>[t(v,null,{default:s(()=>[c(u(pe(o.level_type)),1)]),_:2},1024)]),_:1},8,["label"]),t(r,{prop:"leader",label:e(l)("device.leader")},null,8,["label"]),t(r,{prop:"phone",label:e(l)("device.Contactinformation")},null,8,["label"]),t(r,{prop:"email",label:e(l)("descriptionsDemo.email")},null,8,["label"]),t(r,{prop:"remark",label:e(l)("userDemo.remark")},null,8,["label"]),t(r,{prop:"status",label:e(l)("userDemo.status"),width:"90"},{default:s(({row:o})=>[t(e(Se),{type:o.status==1?"success":"danger"},{default:s(()=>[c(u(o.status==1?e(l)("userDemo.enable"):e(l)("userDemo.disable")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(r,{prop:"created",label:e(l)("userDemo.createTime")},{default:s(({row:o})=>[c(u(e(ze)(o.created*1e3,"yyyy-MM-dd HH:mm:ss")),1)]),_:1},8,["label"]),t(r,{prop:"action",label:e(l)("userDemo.action"),width:"280",fixed:"right"},{default:s(({row:o})=>[t(e(U),{permission:"Create"},{default:s(()=>[t(e(h),{type:"success",text:"",onClick:ae=>O("detail",o)},{default:s(()=>[c(u(e(l)("exampleDemo.detail")),1)]),_:2},1032,["onClick"])]),_:2},1024),t(e(U),{permission:"Details"},{default:s(()=>[t(e(h),{type:"primary",text:"",onClick:ae=>O("edit",o)},{default:s(()=>[c(u(e(l)("exampleDemo.edit")),1)]),_:2},1032,["onClick"])]),_:2},1024),t(e(U),{permission:"Delete"},{default:s(()=>[t(e(h),{type:"danger",text:"",onClick:ae=>O("del",o)},{default:s(()=>[c(u(e(l)("exampleDemo.del")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","tree-props"])),[[he,B.value]])]),_:1}),t(xe,{modelValue:y.value,"onUpdate:modelValue":a[18]||(a[18]=o=>y.value=o),title:L.value,size:"80%",direction:"rtl"},{footer:s(()=>[T.value!=="detail"?(g(),x(e(H),{key:0,type:"primary",loading:de.value,onClick:a[16]||(a[16]=o=>me(X.value))},{default:s(()=>[c(u(e(l)("exampleDemo.save")),1)]),_:1},8,["loading"])):R("",!0),t(e(H),{onClick:a[17]||(a[17]=o=>y.value=!1)},{default:s(()=>[c(u(e(l)("dialogDemo.close")),1)]),_:1})]),default:s(()=>[t(De,{model:d.value,"label-width":"120px",rules:ce,ref_key:"ruleFormRef",ref:X},{default:s(()=>[t(le,{"content-position":"left"},{default:s(()=>[c(u(e(l)("device.basicInfo")),1)]),_:1}),d.value.level_type!="TENANT"?(g(),x(b,{key:0,label:e(l)("userDemo.superiorDepartment"),prop:"parentId"},{default:s(()=>[t(_e,{modelValue:d.value.parentId,"onUpdate:modelValue":a[0]||(a[0]=o=>d.value.parentId=o),data:$.value,"render-after-expand":!1,"default-expand-all":"",placeholder:e(l)("common.selectText"),"check-strictly":"",clearable:""},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])):R("",!0),t(b,{label:e(l)("userDemo.NodeType"),prop:"level_type"},{default:s(()=>[t(A,{modelValue:d.value.level_type,"onUpdate:modelValue":a[1]||(a[1]=o=>d.value.level_type=o),clearable:"",placeholder:e(l)("common.selectText"),disabled:d.value.level_type=="TENANT"},{default:s(()=>[t(D,{label:e(l)("device.TENANT"),value:"TENANT",disabled:""},null,8,["label"]),t(D,{label:e(l)("device.DEPARTMENT"),value:"DEPARTMENT"},null,8,["label"]),t(D,{label:e(l)("device.project"),value:"PROJECT"},null,8,["label"])]),_:1},8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.NodeName"),prop:"name"},{default:s(()=>[t(k,{modelValue:d.value.name,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value.name=o),clearable:"",placeholder:e(l)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.ContactEmail")},{default:s(()=>[t(k,{modelValue:d.value.email,"onUpdate:modelValue":a[3]||(a[3]=o=>d.value.email=o),clearable:"",placeholder:e(l)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.ContactPhone")},{default:s(()=>[t(k,{modelValue:d.value.phone,"onUpdate:modelValue":a[4]||(a[4]=o=>d.value.phone=o),clearable:"",placeholder:e(l)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.NodeSorting")},{default:s(()=>[t(k,{modelValue:d.value.sort,"onUpdate:modelValue":a[5]||(a[5]=o=>d.value.sort=o),clearable:"",placeholder:e(l)("common.inputText"),type:"number"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.Enabled"),prop:"status"},{default:s(()=>[t(A,{modelValue:d.value.status,"onUpdate:modelValue":a[6]||(a[6]=o=>d.value.status=o),clearable:"",placeholder:e(l)("common.selectText")},{default:s(()=>[t(D,{label:e(l)("device.enable"),value:"1"},null,8,["label"]),t(D,{label:e(l)("device.disable"),value:"0"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("device.leader")},{default:s(()=>[t(k,{modelValue:d.value.leader,"onUpdate:modelValue":a[7]||(a[7]=o=>d.value.leader=o),clearable:"",placeholder:e(l)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(b,{label:e(l)("userDemo.remark")},{default:s(()=>[t(k,{modelValue:d.value.remark,"onUpdate:modelValue":a[8]||(a[8]=o=>d.value.remark=o),type:"textarea",placeholder:e(l)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d.value.level_type==="PROJECT"?(g(),x(le,{key:1,"content-position":"left"},{default:s(()=>[c(u(e(l)("common.Deviceallocation")),1)]),_:1})):R("",!0),d.value.level_type==="PROJECT"?(g(),x(b,{key:2},{default:s(()=>[t(ye,{modelValue:d.value.deviceIds,"onUpdate:modelValue":a[15]||(a[15]=o=>d.value.deviceIds=o),style:{"text-align":"left",display:"inline-block"},filterable:"",titles:[e(l)("formDemo.unallocatedDevice"),e(l)("device.project")+e(l)("device.device")],"button-texts":[e(l)("formDemo.Unassign"),e(l)("device.Assigntoaproject")],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:_.value,onChange:ve},Ne({"left-footer":s(()=>[I("div",Oe,[t(e(h),{size:"small",disabled:e(p).page<=1,onClick:a[9]||(a[9]=M(o=>Y("prev"),["stop"]))},{default:s(()=>[c(u(e(l)("device.Previous")),1)]),_:1},8,["disabled"]),t(e(h),{size:"small",disabled:e(p).page>=e(p).total,onClick:a[10]||(a[10]=M(o=>Y("next"),["stop"]))},{default:s(()=>[c(u(e(l)("device.Next")),1)]),_:1},8,["disabled"]),t(A,{modelValue:e(p).size,"onUpdate:modelValue":a[11]||(a[11]=o=>e(p).size=o),style:{width:"80px"},size:"small",onChange:be},{default:s(()=>[(g(!0),F(J,null,te(W.value,o=>(g(),x(D,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I("span",je,u(e(p).page)+"/"+u(e(p).total),1)])]),_:2},[T.value=="edit"?{name:"right-footer",fn:s(()=>[I("div",qe,[t(e(h),{size:"small",disabled:e(m).page<=1,onClick:a[12]||(a[12]=M(o=>Z("prev"),["stop"]))},{default:s(()=>[c(u(e(l)("device.Previous")),1)]),_:1},8,["disabled"]),t(e(h),{size:"small",disabled:e(m).page>=e(m).total,onClick:a[13]||(a[13]=M(o=>Z("next"),["stop"]))},{default:s(()=>[c(u(e(l)("device.Next")),1)]),_:1},8,["disabled"]),t(A,{modelValue:e(m).size,"onUpdate:modelValue":a[14]||(a[14]=o=>e(m).size=o),style:{width:"80px"},size:"small",onChange:ge},{default:s(()=>[(g(!0),F(J,null,te(W.value,o=>(g(),x(D,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I("span",Fe,u(e(m).page)+"/"+u(e(m).total),1)])]),key:"0"}:void 0]),1032,["modelValue","titles","button-texts","data"])]),_:1})):R("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}}),vl=Pe(Je,[["__scopeId","data-v-50d3e507"]]);export{vl as default};
