import{c as a,f as y}from"./index-CAdyeJt3.js";import{e as u}from"./data-Cu4NlBkL.js";const{t:o}=a(),g=async(e,t)=>{try{x(e);const r=w(e),n=await u(r);if(o("export.apiResponseLog"),!n||!n.data)throw console.error(o("export.downloadFailedEmptyResponse")),new Error(o("export.downloadFailedEmptyResponse"));h(n,e.reportType,e.type,e.resourceType,t)}catch(r){throw console.error(o("export.exportFailed"),r),r}},x=e=>{if(!e.start)throw new Error(o("export.startTimeRequired"));if(!e.end)throw new Error(o("export.endTimeRequired"));if(!e.productId)throw new Error(o("export.productIdRequired"));if(!e.type)throw new Error(o("export.reportTypeRequired"));if(!e.reportType)throw new Error(o("export.reportFormatTypeRequired"))},w=e=>{const t={start:e.start,end:e.end,productId:e.productId,type:e.type,reportType:e.reportType};return e.projectId&&(t.projectId=e.projectId),e.search&&(t.search=e.search),e.propertyIds&&(t.propertyIds=Array.isArray(e.propertyIds)?e.propertyIds.join(","):e.propertyIds),e.resourceType&&(t.resourceType=e.resourceType),e.resourceIds&&(t.resourceIds=Array.isArray(e.resourceIds)?e.resourceIds.join(","):e.resourceIds),t},h=(e,t,r,n,s)=>{try{const p=e.data,i=e.headers;if(!p||!(p instanceof Blob))throw console.error(o("export.downloadFailedInvalidBlob")),new Error(o("export.downloadFailedInvalidBlob"));o("export.blobInfoLog"),p.size,p.type;let d="";d=f(t,r,n,s),I(p,d)}catch(p){throw console.error(o("export.fileHandleFailed"),p),p}},f=(e,t,r,n)=>{o("export.generateFilenameLog");const p=n?o("export.timeGranularity.week"):o({interval:"export.timeGranularity.interval",day:"export.timeGranularity.day",month:"export.timeGranularity.month",year:"export.timeGranularity.year"}[t.toLowerCase()]||"export.timeGranularity.unknown",{type:t}),i={2:o("export.reportTypeMap.device"),3:o("export.reportTypeMap.tag"),5:o("export.reportTypeMap.area")},d={Product:o("export.resourceTypeMap.deviceReport"),Group:o("export.resourceTypeMap.tagReport"),Position:o("export.resourceTypeMap.areaReport")},c=`${p}-${d[r]||i[e]}`,l=y(new Date,"yyyyMMdd_HHmmss");return`${c}_${l}.xlsx`},I=(e,t)=>{try{const r=document.createElement("a"),n=URL.createObjectURL(e);r.href=n,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),o("export.startDownloadLog"),e.size,e.type,setTimeout(()=>{document.body.removeChild(r),URL.revokeObjectURL(n),o("export.downloadCompleteCleanedLog")},100)}catch(r){throw console.error(o("export.downloadFailed"),r),new Error(o("export.fileDownloadFailedWithReason",{reason:r?.message||String(r)}))}};export{g as e};
