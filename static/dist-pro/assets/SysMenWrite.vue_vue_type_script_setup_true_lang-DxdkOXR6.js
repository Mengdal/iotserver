import{F as G}from"./Form-CzZbC4Aj.js";import{u as K}from"./useForm-CD85wrwf.js";import{u as W}from"./useValidator-Barz9SCp.js";import{c as X,i as H}from"./index-CAdyeJt3.js";import{b as J,g as Q}from"./index-5XhoBoFQ.js";/* empty css                  *//* empty css                        *//* empty css                *//* empty css               */import{_ as Y}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-ClaqqdUG.js";import{c as Z,n as ee,q as w,s as x,m as ae,d as P,t as te}from"./element-plus--V1NSjC4.js";import{x as le,r as d,j as oe,c as ne,u as D,X as ie,w as se,y as ce,z as re,P as o,O as L,aa as pe}from"./vue-chunks-C1K3ngR7.js";function g(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!pe(f)}const Pe=le({__name:"SysMenWrite",props:{currentRow:{type:Object,default:()=>null}},setup(f,{expose:F}){const I=d([]),v=d([]),p=d(3),{t:e}=X(),{required:b}=W(),V=f,E=async()=>{try{const t=await Q(),a=l=>l?l.map(c=>({id:c.id,title:c.meta?.title||e("device.unnamed"),children:c.children?a(c.children):[]})):[];I.value=a(t.data||[])}catch(t){console.error("加载菜单树失败:",t)}};oe(()=>{E()});const M=async t=>{const a=await h();u({permissionList:a?.permissionList?.filter(l=>l.value!==t.value)})},N=async t=>{i.value={...t}},O=async()=>{const t=await h(),a=t?.permissionList?.findIndex(l=>l.id===i.value.id);a!==-1&&(t.permissionList[a]={...i.value},i.value=null)},S=d(!1),i=d(null),R=ne(()=>{const t=[{field:"type",label:e("device.menuType"),component:"RadioButton",value:3,colProps:{span:24},componentProps:{options:[{label:e("device.systemDirectory"),value:0,disabled:p.value===3||p.value===2},{label:"系统菜单",value:1,disabled:p.value===3||p.value===2},{label:e("device.scadaDirectory"),value:3},{label:e("device.scadaMenu"),value:2}],onChange:async n=>{p.value=n}}},{field:"parentId",label:e("device.parentMenu"),component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},data:I.value,highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:async n=>{const m=await h();n&&m.type===0?u({component:"##"}):!n&&m.type===0?u({component:"#"}):m.type===1&&u({component:D(T)??""})}}}},{field:"meta.title",label:e("menu.menuName"),component:"Input"}],a=()=>[{field:"name",label:e("menu.name"),component:"Input"},{field:"meta.icon",label:e("menu.icon"),component:"Input"},{field:"path",label:e("menu.path"),component:"Input"},{field:"meta.classifyName",label:e("device.classifyName"),component:"Input"}],l=()=>({field:"permissionList",label:e("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:n=>{let m;return o(L,null,[o(H,{class:"m-t-5px",type:"primary",size:"small",onClick:()=>S.value=!0},g(m=e("exampleDemo.add"))?m:{default:()=>[m]}),o(ee,{data:n?.permissionList},{default:()=>[o(w,{type:"index",prop:"id"},null),o(w,{prop:"value",label:"Value"},{default:({row:s})=>i.value&&i.value.id===s.id?o(x,{modelValue:i.value.value,"onUpdate:modelValue":r=>i.value.value=r,size:"small"},null):o("span",null,[s.value])}),o(w,{prop:"label",label:"Label"},{default:({row:s})=>{let r;return i.value&&i.value.id===s.id?o(x,{modelValue:i.value.label,"onUpdate:modelValue":y=>i.value.label=y,size:"small"},null):o(ae,{class:"mr-1",key:s.value},g(r=e(s.label))?r:{default:()=>[r]})}}),o(w,{label:"Operations",width:"180"},{default:({row:s})=>{let r,y;return i.value&&i.value.id===s.id?o(P,{size:"small",type:"primary",onClick:O},g(r=e("device.confirm"))?r:{default:()=>[r]}):o(L,null,[o(P,{size:"small",type:"primary",onClick:()=>N(s)},g(y=e("device.edit"))?y:{default:()=>[y]}),o(te,{title:"Are you sure to delete this?",onConfirm:()=>M(s)},{reference:()=>{let C;return o(P,{size:"small",type:"danger"},g(C=e("device.delete"))?C:{default:()=>[C]})}})])}})]})])}}}}),c={field:"status",label:e("menu.status"),component:"Select",componentProps:{options:[{label:e("userDemo.disable"),value:0},{label:e("userDemo.enable"),value:1}]}},$={field:"meta.isUseScada",label:e("device.useScadaMenu"),component:"Select",value:!0,componentProps:{options:[{label:e("device.no"),value:!1},{label:e("device.yes"),value:!0}]}};switch(p.value){case 0:t.push({field:"component",label:e("device.component"),component:"Input",value:"#",componentProps:{disabled:!0,placeholder:e("device.directoryLevelTip")}},{field:"priority",label:e("device.sortField"),component:"Input",value:0,componentProps:{disabled:!1,placeholder:e("device.sortDefaultTip")}},...a(),{field:"redirect",label:e("device.redirect"),component:"Input"},c,l(),..._());break;case 1:t.push({field:"component",label:e("device.component"),component:"Input",value:"#",componentProps:{disabled:!1,placeholder:e("device.enterComponentPathTip")}},$,...a(),{field:"redirect",label:e("device.redirect"),component:"Input"},c,l(),..._());break;case 2:t.push({field:"page",label:e("device.drawing"),component:"Select",value:"",componentProps:{options:v.value.map(n=>({label:n.name,value:n.id})),onChange:n=>{},filterable:!0,remote:!0},optionApi:async()=>{if(v.value.length,v.value.length===0){const n=await J();v.value=n.data?.data?.pagesName||[]}return v.value.map(n=>({label:n.name,value:n.id}))}},{field:"meta.hidden",label:e("menu.hidden"),component:"Switch"},c);break;case 3:t.push({field:"priority",label:e("device.sortField"),component:"Input",value:0,componentProps:{disabled:!1,placeholder:e("device.sortDefaultTip")}},c,{field:"meta.hidden",label:e("menu.hidden"),component:"Switch"});break}return t});function _(){return[{field:"meta.hidden",label:e("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:e("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:e("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:e("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:e("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:e("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:e("menu.canTo"),component:"Switch"}]}const j=ie({component:[b()],"meta.title":[b()],status:[b()],name:[b()],page:[b()]}),{formRegister:z,formMethods:A}=K(),{setValues:u,getFormData:h,getElFormExpose:U,setSchema:k}=A,B=async()=>{if(await(await U())?.validate().catch(l=>{}))return await h()},T=d("");se(()=>V.currentRow,async t=>{if(!t)return;const a=Z(t);if(a.type===2&&a.path){const l=a.path.match(/preview\/(\d+)/);l&&l[1]&&(a.page=parseInt(l[1]))}a.permissionList&&typeof a.permissionList=="object"&&!Array.isArray(a.permissionList)?a.permissionList=Object.values(a.permissionList):a.permissionList||(a.permissionList=[]),p.value=a.type,T.value=a.type===1?a.component:"",a.parentId===0?k([{field:"component",path:"componentProps.disabled",value:!0}]):k([{field:"component",path:"componentProps.disabled",value:!1}]),u(a)},{deep:!0,immediate:!0}),F({submit:B});const q=async t=>{const a=await h();u({permissionList:[...a?.permissionList||[],t]})};return(t,a)=>(ce(),re(L,null,[o(D(G),{rules:j,onRegister:D(z),schema:R.value},null,8,["rules","onRegister","schema"]),o(Y,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=l=>S.value=l),onConfirm:q},null,8,["modelValue"])],64))}});export{Pe as _};
