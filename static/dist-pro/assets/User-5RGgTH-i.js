import{_ as J}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{c as Q,g as X,e as b,_ as Y}from"./index-CAdyeJt3.js";import{F as Z}from"./Form-CzZbC4Aj.js";import{_ as ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{_ as te}from"./ResizeDialog.vue_vue_type_script_setup_true_lang-BMzjBTUt.js";import{u as ae}from"./useValidator-Barz9SCp.js";import{u as R}from"./useForm-CD85wrwf.js";import{f as oe,h as se,b as re,i as le,u as ne}from"./index-BST0YArI.js";import{g as ie}from"./index-DHVFwXOq.js";import{d as I,i as ce,b as u,v as B}from"./element-plus--V1NSjC4.js";import{x as ue,c as F,r,af as g,n as V,j as de,ag as me,y as L,z as pe,P as d,H as m,u as s,L as C,M as D,G as fe,K as ge,O as ve}from"./vue-chunks-C1K3ngR7.js";/* empty css                        *//* empty css                *//* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                *//* empty css                         *//* empty css                  *//* empty css                       *//* empty css               *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";import"./Dialog.vue_vue_type_style_index_0_lang-aEWcq84Q.js";/* empty css                  */import"./index-DfycOL0q.js";const ye=ue({__name:"User",setup(_e){const{t:a}=Q(),S=X(),T=F(()=>window.innerHeight-204),{formRegister:M,formMethods:v}=R();R();const y=r({}),A=r(!1),n=r(!1),{required:_}=ae(),i=r("create"),$=r(null),H=F(()=>({create:a("device.create"),edit:a("device.edit")})[i.value]),c=r({page:1,size:10}),U=r({}),O=[{field:"username",label:a("login.username")},{field:"role_name",label:a("userDemo.role")},{field:"description",label:a("device.description")},{field:"action",label:a("device.operation"),slots:{default:e=>g("div",[g(b,{permission:"Edit"},{default:()=>g(I,{type:"primary",text:!0,onClick:()=>z(e.row,"edit")},{default:()=>a("device.edit")})}),g(b,{permission:"Delete"},{default:()=>g(I,{type:"danger",text:!0,onClick:()=>z(e.row,"delete")},{default:()=>a("device.delete")})})])}}],E=r([]),f=r(!1),w=r([]),P=e=>!e||!Array.isArray(e)?[]:e.map(t=>{const o={value:t.id,label:t.name};return t.children&&Array.isArray(t.children)&&t.children.length>0?o.children=P(t.children):o.children=null,o}),k=async()=>{f.value=!0;try{const[e,t]=await Promise.all([re({page:1,size:200}),ie()]);e.code==200&&(E.value=e.data.list.map(o=>({label:o.name,value:o.id}))),t.code==200&&(w.value=P(t.data),w.value)}finally{f.value=!1}},q=F(()=>[{field:"role_id",label:a("userDemo.role"),component:"Select",formItemProps:{rules:[_()]},componentProps:{options:E.value,loading:f.value}},{field:"username",label:a("userDemo.username"),component:"Input",formItemProps:{rules:[_()]}},{field:"department_id",label:"所属部门",component:"TreeSelect",componentProps:{data:w.value,loading:f.value,"default-expand-all":!0,"check-strictly":!0}},{field:"password",label:a("userDemo.password"),component:"InputPassword",formItemProps:{rules:i.value==="create"?[_()]:[]}}]),z=async(e,t)=>{if($.value=e,i.value=t,t==="delete"){ce.confirm(a("common.delMessage"),a("common.delWarning"),{confirmButtonText:a("common.ok"),cancelButtonText:a("common.cancel"),type:"warning"}).then(()=>{oe({id:e.id}).then(o=>{o.code===200&&(u({type:"success",message:a("device.operationSuccess")}),p())}).catch(o=>{console.error("删除失败",o),u({type:"error",message:a("device.operationFailed")})})}).catch(()=>{u({type:"info",message:a("device.operationCancelled")})});return}if(t==="edit"){U.value=e,await k(),n.value=!0,await V(),v.setValues({role_id:e.role_id,username:e.username,password:"",department_id:e.department_id});return}},N=async()=>{i.value="create",await k(),n.value=!0,await V(),v.setValues({})},j=async()=>{try{if(i.value==="create"){const{getFormData:e,getElFormExpose:t}=v,o=await e();(await t()).validate(async h=>{if(h){let x={...o,user_id:S.getUserInfo.userId};(await le(x)).code===200&&(u({type:"success",message:a("device.operationSuccess")}),n.value=!1,p())}else{u({type:"error",message:a("device.pleaseFillInCompleteInformation")});return}})}else if(i.value==="edit"){const{getFormData:e,getElFormExpose:t}=v,o=await e();(await t()).validate(async h=>{if(h){let x={...o,id:U.value.id};(await ne(x)).code===200&&(u({type:"success",message:a("device.operationSuccess")}),n.value=!1,p())}else{u({type:"error",message:a("device.pleaseFillInCompleteInformation")});return}})}}finally{}},W=B(async e=>{c.value.size=e,p()},300),G=B(async e=>{c.value.page=e,p()},300);de(async()=>{p()});const p=async()=>{const e=await se(c.value);e.code===200&&(y.value=e.data),S.getUserInfo.userId};return(e,t)=>{const o=me("BaseButton");return L(),pe(ve,null,[d(s(ee),null,{default:m(()=>[d(s(b),{permission:"Create"},{default:m(()=>[d(s(I),{type:"primary",onClick:N,loading:f.value},{default:m(()=>[C("+ "+D(s(a)("device.create")),1)]),_:1},8,["loading"])]),_:1}),d(s(J),{height:T.value,pageSize:c.value.size,"onUpdate:pageSize":[t[0]||(t[0]=l=>c.value.size=l),s(W)],currentPage:c.value.page,"onUpdate:currentPage":[t[1]||(t[1]=l=>c.value.page=l),s(G)],columns:O,data:y.value.list,loading:A.value,showAction:"",pagination:{total:y.value.totalRow?y.value.totalRow:0,pageSizes:[10,20,50],layout:"total, sizes, prev, pager, next, jumper"}},null,8,["height","pageSize","currentPage","data","loading","pagination","onUpdate:currentPage","onUpdate:pageSize"])]),_:1}),d(te,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=l=>n.value=l),title:H.value,initHeight:230,initWidth:600,fullscreen:!1},{footer:m(()=>[d(o,{type:"primary",onClick:j},{default:m(()=>[C(D(s(a)("dialogDemo.submit")),1)]),_:1}),d(o,{onClick:t[2]||(t[2]=l=>n.value=!1)},{default:m(()=>[C(D(s(a)("common.cancel")),1)]),_:1})]),default:m(()=>[i.value!=="bandInstance"?(L(),fe(s(Z),{key:0,schema:q.value,onRegister:s(M),isCol:!1},null,8,["schema","onRegister"])):ge("",!0)]),_:1},8,["modelValue","title"])],64)}}}),Ge=Y(ye,[["__scopeId","data-v-a621f13f"]]);export{Ge as default};
