import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{g as re,c as oe,f as s,_ as le}from"./index-CAdyeJt3.js";import{_ as se}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{u as de}from"./useTable-Cg8mTZpf.js";import{g as ne,b as pe}from"./index-BTXJkdku.js";import{F as ie,M as ue}from"./element-plus--V1NSjC4.js";import{g as ce}from"./data-Cu4NlBkL.js";import{e as me}from"./export-BUcENNsn.js";import{x as ye,r as u,X as N,c as ge,j as fe,ag as c,y,G as _,H as d,P as l,u as o,z as k,O as V,a4 as x,L as D,M as U,l as A,n as ve}from"./vue-chunks-C1K3ngR7.js";/* empty css                *//* empty css                  *//* empty css                        *//* empty css                *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";const be=ye({__name:"EnergyReport",setup(Ie){const m=re(),{t:p}=oe(),L=u(0),H=u(!1),M=u(!1),f=u("1"),E=u(!1),S=u([]),e=N({reportType:"report",type:"interval",search:"",productId:"",propertyIds:[],startTime:s(new Date(new Date().setHours(0,0,0,0)),"yyyy-MM-dd HH:mm:ss"),endTime:s(new Date(new Date),"yyyy-MM-dd HH:mm:ss")}),B=ge(()=>window.innerHeight-290),T=u([]),b=u([]),G=u([{categoryId:"1",displayName:p("device.deviceReport")},{categoryId:"2",displayName:p("device.tagReport")},{categoryId:"3",displayName:p("device.areaReport")}]),F=()=>{H.value=!0,j().finally(()=>{H.value=!1})},$=async()=>{try{M.value=!0;let a={},t=m.getProject;switch(f.value){case"1":a={start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:t.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":a={start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:t.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":a={start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:t.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}await me(a)}catch(a){console.error("导出失败:",a)}finally{M.value=!1}},q=a=>{h.value=1,f.value=a.props.name,j()},K=a=>{C(a)},{tableRegister:O,tableState:z,tableMethods:X}=de({fetchDataApi:async()=>{const{currentPage:a,pageSize:t}=z;if(!e.productId||e.propertyIds.length===0)return{list:[],total:0};let i={},v=m.getProject;switch(f.value){case"1":i={page:o(a),size:o(t),start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:v.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":i={page:o(a),size:o(t),start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:v.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":i={page:o(a),size:o(t),start:s(e.startTime,"yyyy-MM-dd HH:mm:ss"),end:s(e.endTime,"yyyy-MM-dd HH:mm:ss"),projectId:v.enable?m.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}let n=N({});try{switch(f.value){case"1":case"2":case"3":n=(await ce(i)).data;break}const I=n.tableLabel?.map(g=>({label:g.label,field:g.prop,fixed:g.fixed}));return S.value=I,{list:n.tableData,total:n.totalRow}}catch(I){return console.error("获取报表数据失败:",I),{list:[],total:0}}}}),{dataList:J,total:Q,currentPage:h,pageSize:w}=z,{getList:j}=X,W=async()=>{let a=await ne({page:1,size:999999});a.code===200&&(b.value=a.data?.list?.map(t=>({label:t.name,value:t.id})),b.value.length>0&&(e.productId=b.value[0].value,await C(b.value[0].value)))},C=async a=>{let t=await pe({productId:a,valueType:"L"});t.code===200&&(T.value=[...t.data?.properties?.map(i=>({label:i.name,value:i.id}))],L.value++,await ve(),T.value.length>0?(e.propertyIds=[T.value[0].value],j()):e.propertyIds=[])};fe(()=>{W()});const Y=({row:a,rowIndex:t})=>a.dn==="小计"?"warning-row":a.position==="合计"||a.categorySub==="合计"||a.group==="合计"?"even-row":"";return(a,t)=>{const i=c("el-option"),v=c("el-select"),n=c("el-form-item"),I=c("el-input"),g=c("el-date-picker"),R=c("el-button"),Z=c("el-form"),ee=c("el-tab-pane"),te=c("el-tabs");return y(),_(o(ae),null,{default:d(()=>[l(Z,{model:e,class:"search-form",inline:!0},{default:d(()=>[l(n,{label:o(p)("device.productName")},{default:d(()=>[l(v,{modelValue:e.productId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.productId=r),clearable:"",onChange:K,style:{width:"120px"}},{default:d(()=>[(y(!0),k(V,null,x(b.value,r=>(y(),_(i,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(n,{label:o(p)("device.attributeName")},{default:d(()=>[(y(),_(v,{modelValue:e.propertyIds,"onUpdate:modelValue":t[1]||(t[1]=r=>e.propertyIds=r),multiple:"",clearable:"",key:L.value,style:{"min-width":"150px"}},{default:d(()=>[(y(!0),k(V,null,x(T.value,r=>(y(),_(i,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"]),l(n,{label:o(p)("device.deviceName")},{default:d(()=>[l(I,{modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=r=>e.search=r),placeholder:o(p)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:o(p)("device.startTime")},{default:d(()=>[l(g,{modelValue:e.startTime,"onUpdate:modelValue":t[3]||(t[3]=r=>e.startTime=r),type:"datetime"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:o(p)("device.endTime")},{default:d(()=>[l(g,{modelValue:e.endTime,"onUpdate:modelValue":t[4]||(t[4]=r=>e.endTime=r),type:"datetime"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,null,{default:d(()=>[l(R,{type:"primary",onClick:F,loading:H.value,icon:o(ie)},{default:d(()=>[D(U(o(p)("device.query")),1)]),_:1},8,["loading","icon"]),l(R,{onClick:$,loading:M.value,icon:o(ue)},{default:d(()=>[D(U(o(p)("device.exportData")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"]),l(te,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=r=>f.value=r),class:"demo-tabs",onTabClick:q},{default:d(()=>[(y(!0),k(V,null,x(G.value,r=>(y(),_(ee,{key:r.categoryId,label:r.displayName,name:r.categoryId},{default:d(()=>[l(o(se),{border:!1,pageSize:o(w),"onUpdate:pageSize":t[5]||(t[5]=P=>A(w)?w.value=P:null),size:"small",currentPage:o(h),"onUpdate:currentPage":t[6]||(t[6]=P=>A(h)?h.value=P:null),columns:S.value,data:o(J),loading:E.value,height:B.value,pagination:{total:o(Q),pageSizes:[20,40,50,100,1e3]},onRegister:o(O),showAction:"",rowClassName:Y},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})}}}),Ae=le(be,[["__scopeId","data-v-0512782b"]]);export{Ae as default};
