import{c as L}from"./index-CAdyeJt3.js";import{i as C,b as T}from"./element-plus--V1NSjC4.js";import{r as o,w as h,u as t,j as x,n as M}from"./vue-chunks-C1K3ngR7.js";const{t:c}=L(),E=i=>{const{immediate:p=!0}=i,u=o(!1),a=o(1),r=o(20),m=o(0),g=o([]);let f=!1;h(()=>a.value,()=>{f||n.getList(),f=!1}),h(()=>r.value,()=>{t(a)===1||(a.value=1,f=!0),n.getList()}),x(()=>{p&&n.getList()});const d=o(),b=o(),w=(e,s)=>{d.value=e,b.value=t(s)},l=async()=>{await M();const e=t(d);return e||console.error("The table is not registered. Please use the register method to register"),e},n={getList:async()=>{u.value=!0;try{const e=await i?.fetchDataApi();e&&(g.value=e.list,m.value=e.total||0)}catch{}finally{u.value=!1}},setProps:async(e={})=>{(await l())?.setProps(e)},setColumn:async e=>{(await l())?.setColumn(e)},addColumn:async(e,s)=>{(await l())?.addColumn(e,s)},delColumn:async e=>{(await l())?.delColumn(e)},getElTableExpose:async()=>(await l(),t(b)),refresh:()=>{n.getList()},delList:async e=>{const{fetchDelApi:s}=i;if(!s){console.warn("fetchDelApi is undefined");return}C.confirm(c("common.delMessage"),c("common.delWarning"),{confirmButtonText:c("common.delOk"),cancelButtonText:c("common.delCancel"),type:"warning"}).then(async()=>{if(await s()){T.success(c("common.delSuccess"));const v=t(m)%t(r)===e||t(r)===1?t(a)>1?t(a)-1:t(a):t(a);a.value=v,n.getList()}})}};return{tableRegister:w,tableMethods:n,tableState:{currentPage:a,pageSize:r,total:m,dataList:g,loading:u}}};export{E as u};
