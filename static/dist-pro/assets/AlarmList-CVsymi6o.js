import{_ as L}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{d as x,a as U,g as R}from"./index-CIdFgJMS.js";import{_ as S}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{u as F}from"./useTable-Cg8mTZpf.js";import{c as N,f as g,e as b,_ as j}from"./index-CAdyeJt3.js";import{d as h}from"./dateUtil-HUUeH7cc.js";import{d as v,i as M,b as d}from"./element-plus--V1NSjC4.js";import{x as O,c as W,r as w,X as q,P as a,ag as c,O as k,y as X,z as G,H as m,u as l,L as J,M as K,l as Q,aa as Z}from"./vue-chunks-C1K3ngR7.js";/* empty css                        *//* empty css                *//* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                *//* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";function Y(p){return typeof p=="function"||Object.prototype.toString.call(p)==="[object Object]"&&!Z(p)}const ee=O({__name:"AlarmList",setup(p){const{t:e}=N(),V=W(()=>window.innerHeight-260),s=w({startTime:g(new Date(new Date().setDate(new Date().getDate()-31)).setHours(0,0,0,0),"yyyy-MM-dd HH:mm:ss"),endTime:g(new Date,"yyyy-MM-dd HH:mm:ss"),status:e("device.all"),page:1,size:20,isSystem:"true"}),D=w({}),{tableRegister:z,tableState:T,tableMethods:A}=F({fetchDataApi:async()=>{const{currentPage:o,pageSize:t}=T,n=await R({page:l(o),size:l(t),starttime:g(l(s).startTime,"yyyy-MM-dd HH:mm:ss"),endtime:g(l(s).endTime,"yyyy-MM-dd HH:mm:ss"),isSystem:s.value.isSystem,...l(D)});return{list:n.data.list,total:n.data.totalRow}}}),{loading:$,dataList:P,total:B,currentPage:_,pageSize:te}=T,{getList:f}=A,C=q([{field:"rule_name",label:e("device.alarmRuleName")},{field:"dn",label:e("device.deviceName")},{field:"trigger",label:e("device.triggerCondition")},{field:"alert_level",label:e("device.alarmLevel")},{field:"handler",label:e("device.processingStatus"),filterMultiple:!1,slots:{default:o=>{let t="";return o.row.handler=="处理"?t="success":o.row.handler=="未处理"?t="danger":t="warning",a(c("el-tag"),{type:t},{default:()=>[o.row.handler]})}}},{field:"start_at",label:e("device.triggerTime"),formatter:o=>h(o.start_at*1e3).format("YYYY-MM-DD HH:mm:ss")},{field:"end_at",label:e("device.processingTime"),formatter:o=>h(o.end_at*1e3).format("YYYY-MM-DD HH:mm:ss")==="Invalid Date"?"-":h(o.end_at*1e3).format("YYYY-MM-DD HH:mm:ss")},{field:"action",label:e("device.operation"),width:"240px",formatter:o=>{let t,n,r;return a(k,null,[a(b,{permission:"Process"},{default:()=>[a(v,{text:!0,type:"success",onClick:()=>y(o,"treatment"),disabled:o.handler=="处理"},Y(t=e("device.process"))?t:{default:()=>[t]})]}),a(b,{permission:"Ignore"},{default:()=>[a(v,{text:!0,type:"primary",onClick:()=>y(o,"Ignored"),disabled:o.handler=="忽略"},Y(n=e("device.ignore"))?n:{default:()=>[n]})]}),a(b,{permission:"delete"},{default:()=>[a(v,{text:!0,type:"danger",onClick:()=>y(o,"delete")},Y(r=e("exampleDemo.del"))?r:{default:()=>[r]})]})])}}]),y=async(o,t)=>{t==="treatment"?M.confirm(`${e("device.confirmProcessThisAlarm")}？`,e("common.delWarning"),{confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),type:"warning"}).then(()=>{x({id:o.id,status:"处理"}).then(()=>{d.success(e("device.operationSuccess")),f()}).catch(r=>{d.error(`${e("device.operationFailed")}: ${r.message||e("device.unknownError")}`)})}):t==="Ignored"?M.confirm(`${e("device.confirmIgnoreThisAlarm")}？`,e("common.delWarning"),{confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),type:"warning"}).then(()=>{x({id:o.id,status:"忽略"}).then(()=>{d.success(e("device.operationSuccess")),f()}).catch(r=>{d.error(`${e("device.operationFailed")}: ${r.message||e("device.unknownError")}`)})}):t==="delete"&&M.confirm(`${e("device.confirmIgnoreThisAlarm")}？`,e("common.delWarning"),{confirmButtonText:e("common.ok"),cancelButtonText:e("common.cancel"),type:"warning"}).then(()=>{U({id:o.id,status:"忽略"}).then(()=>{d.success(e("device.operationSuccess")),f()}).catch(r=>{d.error(`${e("device.operationFailed")}: ${r.message||e("device.unknownError")}`)})})},I=async()=>{try{s.value.page=1,D.value={status:s.value.status===e("device.all")?"":s.value.status},await f(),d.success(e("device.operationSuccess"))}catch(o){console.error("查询失败:",o),d.error(e("device.operationFailed"))}};return(o,t)=>{const n=c("el-date-picker"),r=c("el-form-item"),u=c("el-option"),H=c("el-select"),E=c("el-form");return X(),G(k,null,[a(l(S),null,{default:m(()=>[a(E,{model:s.value,inline:!0},{default:m(()=>[a(r,{label:l(e)("device.startTime")},{default:m(()=>[a(n,{modelValue:s.value.startTime,"onUpdate:modelValue":t[0]||(t[0]=i=>s.value.startTime=i),type:"datetime",placeholder:"Pick a Date",format:"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1},8,["label"]),a(r,{label:l(e)("device.endTime")},{default:m(()=>[a(n,{modelValue:s.value.endTime,"onUpdate:modelValue":t[1]||(t[1]=i=>s.value.endTime=i),type:"datetime",placeholder:"Pick a Date",format:"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1},8,["label"]),a(r,{label:l(e)("device.alarmType")},{default:m(()=>[a(H,{modelValue:s.value.isSystem,"onUpdate:modelValue":t[2]||(t[2]=i=>s.value.isSystem=i),placeholder:l(e)("common.inputText"),style:{width:"240px"}},{default:m(()=>[a(u,{label:l(e)("device.systemAlarm"),value:"true"},null,8,["label"]),a(u,{label:l(e)("device.gatewayAlarm"),value:"false"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:l(e)("device.processingStatus")},{default:m(()=>[a(H,{modelValue:s.value.status,"onUpdate:modelValue":t[3]||(t[3]=i=>s.value.status=i),placeholder:l(e)("common.inputText"),style:{width:"240px"}},{default:m(()=>[a(u,{label:l(e)("device.all"),value:"全部"},null,8,["label"]),a(u,{label:l(e)("device.unprocessed"),value:"未处理"},null,8,["label"]),a(u,{label:l(e)("device.processed"),value:"处理"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,null,{default:m(()=>[a(l(v),{type:"primary",onClick:I},{default:m(()=>[J(K(l(e)("device.query")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(l(S),null,{default:m(()=>[a(l(L),{border:!1,pageSize:s.value.size,"onUpdate:pageSize":t[4]||(t[4]=i=>s.value.size=i),size:"small",currentPage:l(_),"onUpdate:currentPage":t[5]||(t[5]=i=>Q(_)?_.value=i:null),columns:C,data:l(P),loading:l($),height:V.value,pagination:{total:l(B),pageSizes:[20,40,50,100,1e3]},onRegister:l(z),showAction:""},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:1})],64)}}}),he=j(ee,[["__scopeId","data-v-c47bd82f"]]);export{he as default};
