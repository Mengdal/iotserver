import{_ as ae}from"./Dialog.vue_vue_type_style_index_0_lang-aEWcq84Q.js";import{u as le}from"./useTable-Cg8mTZpf.js";import{r as f,n as oe,u as o,x as j,az as se,c as k,ag as y,y as E,G as re,H as m,A as M,M as _,P as n,aA as ne,aH as ie,af as q,X as de,O as $,z as ce,l as L,L as F,aa as ue}from"./vue-chunks-C1K3ngR7.js";import{_ as I}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{b as me,i as pe}from"./index-BTXJkdku.js";import{_ as fe}from"./Search.vue_vue_type_script_setup_true_lang-BCCD0GAn.js";import{m as he}from"./vue3-apexcharts-Bmjr8cT9.js";import{an as ye,d as A,i as ve,b as ge}from"./element-plus--V1NSjC4.js";import{c as J,_ as Y,f as p}from"./index-CAdyeJt3.js";import{d as be}from"./dateUtil-HUUeH7cc.js";import{d as Se}from"./data-Cu4NlBkL.js";/* empty css                  *//* empty css                        *//* empty css                *//* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                *//* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";import"./Form-CzZbC4Aj.js";/* empty css               *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";import"./useForm-CD85wrwf.js";const we=()=>{const s=f(),b=l=>{s.value=l},c=async()=>{await oe();const l=o(s);return l||console.error("The Search is not registered. Please use the register method to register"),l};return{searchRegister:b,searchMethods:{setProps:async(l={})=>{const e=await c();e?.setProps(l),l.model&&e?.setValues(l.model)},setValues:async l=>{(await c())?.setValues(l)},setSchema:async l=>{(await c())?.setSchema(l)},addSchema:async(l,e)=>{(await c())?.addSchema(l,e)},delSchema:async l=>{(await c())?.delSchema(l)},getFormData:async()=>(await c())?.getFormData()}}},De={class:"header"},He={class:"table-container"},xe=j({__name:"index",props:{modelValue:Boolean,requiredListSize:{type:Number,default:10},requiredListPage:{type:Number,default:1},title:{type:String,default:void 0},searchSchema:{type:Array,required:!0},chartOptions:{type:Object,required:!0},chartSeries:{type:Array,required:!0},tableColumns:{type:Array,required:!0},tableData:{type:Array,required:!0,default:[]},pagination:{type:Object,required:!0},pageSizes:{type:Array,default:()=>[10,20,50,100,500,1e3]},size:{type:String,default:"80%"},appendToBody:{type:Boolean,default:!0},loading:Boolean,chartHeight:{type:String,default:"100%"},tableMaxHeight:{type:[Number,String],default:300},isSupplement:{type:Boolean,default:!1}},emits:["update:modelValue","search","showSupplement","current-page-change","page-size-change","update:requiredListSize","update:requiredListPage"],setup(s,{emit:b}){se(g=>({"270c26be":s.chartHeight,"450efe78":s.tableMaxHeight}));const{t:c}=J(),S=s,l=k(()=>S.title||c("device.historicalData")),e=b,{searchRegister:w,searchMethods:x}=we(),{getFormData:d}=x,r=k({get:()=>S.modelValue,set:g=>e("update:modelValue",g)}),v=async g=>{const h=await d();e("search",{formData:h,searchData:g})},z=()=>{e("showSupplement")};return(g,h)=>{const D=y("el-button"),N=y("el-drawer");return E(),re(N,{modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=T=>r.value=T),title:l.value,"append-to-body":s.appendToBody,size:s.size,direction:"rtl","with-header":!1},{default:m(()=>[M("div",De,[M("span",null,_(l.value),1),n(D,{text:"",icon:o(ye),onClick:h[0]||(h[0]=T=>r.value=!1),style:{"font-size":"20px",color:"#72767b"}},null,8,["icon"])]),n(o(fe),{schema:s.searchSchema,onSearch:v,onRegister:o(w),onSupplementData:z,showSupplement:s.isSupplement},null,8,["schema","onRegister","showSupplement"]),n(o(he),{type:"area",height:"42%",options:s.chartOptions,series:s.chartSeries,style:{"overflow-x":"hidden","overflow-y":"hidden"}},null,8,["options","series"]),M("div",He,[n(o(I),{columns:s.tableColumns,data:s.tableData,"max-height":s.tableMaxHeight,loading:s.loading,headerAlign:"center"},null,8,["columns","data","max-height","loading"])])]),_:1},8,["modelValue","title","append-to-body","size"])}}}),Te=Y(xe,[["__scopeId","data-v-f963e5f7"]]);function Ve(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!ue(s)}const Me=j({__name:"DeviceDetail",setup(s){const b=f([]),c=ne(),S=f({}),l=ie(),{t:e}=J(),w=f(""),x=f(""),d=f({time:p(new Date(new Date),"yyyy-MM-dd HH:mm:ss"),value:""}),r=f({page:1,size:10,startTime:p(new Date(new Date().setHours(0,0,0,0)),"yyyy-MM-dd HH:mm:ss"),period:1800,endTime:p(new Date(new Date),"yyyy-MM-dd HH:mm:ss"),aggType:"last",id:"",type_spec:"",count:100}),v=f(!1);let z={chart:{type:"line",stacked:!1,zoom:{type:"x",enabled:!0,autoScaleYaxis:!0},toolbar:{show:!0,tools:{download:!0,zoom:!0,zoomin:!1,zoomout:!1,pan:!1,reset:!1}}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},markers:{size:4},xaxis:{type:"datetime",labels:{datetimeUTC:!1,format:"HH:mm"}},yaxis:{labels:{formatter:function(a){return a.toFixed(2)}}},tooltip:{shared:!0,x:{format:"yyyy-MM-dd HH:mm:ss"}}};const g=[{field:"val",label:e("device.value"),align:"center",width:300},{field:"status",label:e("device.status"),align:"center",width:300,slots:{default:a=>{let t=a.row.status;return t==="Unknown"&&(t="Error"),q("div",{class:"status-cell"},[q("div",{class:"status-dot",style:{background:t==="Good"?"#67C23A":"#F56C6C"}}),q("span",t)])}}},{field:"timestamp",label:e("device.time"),align:"center",formatter:a=>be(a.timestamp).format("YYYY-MM-DD HH:mm:ss")}],h=k(()=>`${window.innerHeight-231}px`),D=f(!1),N=k(()=>[{field:"startTime",label:e("device.startTime"),component:"DatePicker",value:r.value.startTime,componentProps:{type:"datetime",showTime:!0}},{field:"endTime",label:e("device.endTime"),component:"DatePicker",value:r.value.endTime,componentProps:{type:"datetime",showTime:!0}},{field:"count",label:e("device.Queryquantity"),component:"Input",value:r.value.count}]),T=de([{field:"code",label:"code"},{field:"name",label:e("device.attributePointName")},{field:"tag",label:e("device.tag")},{field:"timestamp",label:e("device.time"),formatter:a=>p(a.timestamp,"yyyy-MM-dd HH:mm:ss")},{field:"val",label:e("device.realTimeValue")},{field:"status",label:e("device.status"),formatter:a=>{const u=(a.status||"").toLowerCase()==="good";return n(y("el-tag"),{type:u?"success":"danger"},{default:()=>[e(u?"device.Normal":"device.Unusual")]})}},{field:"description",label:e("device.description")},{field:"action",label:e("device.operation"),slots:{default:a=>{let t;return n($,null,[n(A,{text:!0,type:"success",onClick:()=>W(a.row)},Ve(t=e("device.details"))?t:{default:()=>[t]})])}}}]),{tableRegister:_e,tableState:G,tableMethods:ke}=le({fetchDataApi:async()=>{let a=await me({productId:JSON.parse(l.params.params).product_id,deviceName:JSON.parse(l.params.params).name});return{list:a.data.properties,total:a.data.properties.length}}}),W=a=>{r.value.id=`${JSON.parse(l.params.params).name}.${a.code}`,r.value.type_spec=JSON.parse(a.type_spec).type,x.value=a.name,w.value=a.code,d.value.value="",C(),D.value=!0},C=async()=>{let a={startTime:p(r.value.startTime,"yyyy-MM-dd HH:mm:ss"),endTime:p(r.value.endTime,"yyyy-MM-dd HH:mm:ss"),aggType:r.value.aggType,period:r.value.period,ids:[r.value.id],count:Number(r.value.count)},t=await Se(a);if(t.code===200){t.data;const u=t.data?.[r.value.id]||[];S.value={list:u,totalRow:u.length},b.value=R(t.data),R(t.data)}},R=a=>{const t=[];for(const[u,P]of Object.entries(a)){const H={name:x.value,data:[]};P.forEach(V=>{const U=parseFloat(V.val);H.data.push({x:V.timestamp,y:U})}),t.push(H)}return t},{dataList:Q,total:X,currentPage:B,pageSize:O}=G,K=()=>{c.push("/device/deviceManage")},Z=a=>{r.value.endTime=p(a.formData.endTime,"yyyy-MM-dd HH:mm:ss"),r.value.startTime=p(a.formData.startTime,"yyyy-MM-dd HH:mm:ss"),r.value.count=a.formData.count,r.value,C()},ee=()=>{v.value=!0},te=()=>{ve.confirm(e("device.confirmStartDataBackfill"),e("common.delWarning"),{confirmButtonText:e("common.delOk"),cancelButtonText:e("common.cancel"),type:"warning"}).then(()=>{let a={deviceName:JSON.parse(l.params.params).name,tagCode:w.value,timestamp:d.value.time,value:d.value.value};pe(a).then(t=>{t.code===200&&(v.value=!1,d.value={time:p(new Date(new Date),"yyyy-MM-dd HH:mm:ss"),value:""},ge({type:"success",message:e("base.success")}),C())})})};return(a,t)=>{const u=y("el-card"),P=y("el-date-picker"),H=y("el-form-item"),V=y("el-input"),U=y("el-form");return E(),ce($,null,[n(u,null,{header:m(()=>[M("span",{class:"el-card__header_title",onClick:t[0]||(t[0]=i=>K())},"â†© "+_(o(e)("device.return")),1)]),default:m(()=>[n(o(I),{"row-key":"name",border:!1,pageSize:o(O),"onUpdate:pageSize":t[1]||(t[1]=i=>L(O)?O.value=i:null),size:"small",currentPage:o(B),"onUpdate:currentPage":t[2]||(t[2]=i=>L(B)?B.value=i:null),columns:T,data:o(Q),height:h.value,pagination:{total:o(X),pageSizes:[20,40,50,100,1e3]},"node-key":"dn",showAction:"",stripe:""},null,8,["pageSize","currentPage","columns","data","height","pagination"])]),_:1}),n(Te,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=i=>D.value=i),"search-schema":N.value,"chart-options":o(z),"chart-series":b.value,"table-columns":g,tableData:S.value.list,isSupplement:!0,onSearch:Z,onShowSupplement:ee,pagination:{}},null,8,["modelValue","search-schema","chart-options","chart-series","tableData"]),n(o(ae),{modelValue:v.value,"onUpdate:modelValue":t[8]||(t[8]=i=>v.value=i),title:o(e)("device.dataBackfill"),maxHeight:100,width:430},{footer:m(()=>[n(o(A),{size:"small",onClick:t[7]||(t[7]=i=>v.value=!1)},{default:m(()=>[F(_(o(e)("common.cancel")),1)]),_:1}),n(o(A),{size:"small",type:"primary",onClick:te},{default:m(()=>[F(_(o(e)("common.ok")),1)]),_:1})]),default:m(()=>[n(U,{modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=i=>d.value=i),"label-width":"80px",style:{"max-width":"300px"}},{default:m(()=>[n(H,{label:o(e)("device.backfillTime")},{default:m(()=>[n(P,{modelValue:d.value.time,"onUpdate:modelValue":t[4]||(t[4]=i=>d.value.time=i),type:"datetime",placeholder:o(e)("common.selectText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(H,{label:o(e)("device.backfillValue")},{default:m(()=>[n(V,{modelValue:d.value.value,"onUpdate:modelValue":t[5]||(t[5]=i=>d.value.value=i),placeholder:o(e)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),st=Y(Me,[["__scopeId","data-v-935d6bb8"]]);export{st as default};
