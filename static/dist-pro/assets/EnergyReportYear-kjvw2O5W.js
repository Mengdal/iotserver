import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{g as re,c as oe,f as l,_ as le}from"./index-CAdyeJt3.js";import{_ as ne}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{u as se}from"./useTable-Cg8mTZpf.js";import{g as pe,b as de}from"./index-BTXJkdku.js";import{F as ce,M as ie}from"./element-plus--V1NSjC4.js";import{g as ue}from"./data-Cu4NlBkL.js";import{e as ye}from"./export-BUcENNsn.js";import{x as me,r as i,X as U,c as ge,j as fe,ag as u,y as m,G as _,H as n,P as s,u as o,z as x,O as L,a4 as S,L as H,M,l as A,n as ve}from"./vue-chunks-C1K3ngR7.js";/* empty css                *//* empty css                  *//* empty css                        *//* empty css                *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";const be=me({__name:"EnergyReportYear",setup(Ie){const y=re(),{t:d}=oe(),z=i(0),w=i(!1),j=i(!1),f=i("1"),E=i(!1),C=i([]),e=U({reportType:"report",type:"year",search:"",productId:"",propertyIds:[],startTime:l(new Date(new Date().setHours(0,0,0,0)),"yyyy"),endTime:l(new Date(new Date),"yyyy-MM-dd HH:mm:ss")}),B=ge(()=>window.innerHeight-290),T=i([]),b=i([]),G=i([{categoryId:"1",displayName:d("device.deviceReport")},{categoryId:"2",displayName:d("device.tagReport")},{categoryId:"3",displayName:d("device.areaReport")}]),F=()=>{w.value=!0,k().finally(()=>{w.value=!1})},Y=async()=>{try{j.value=!0;let a={},t=y.getProject;switch(f.value){case"1":a={start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":a={start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":a={start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}await ye(a)}catch(a){console.error("导出失败:",a)}finally{j.value=!1}},$=a=>{h.value=1,f.value=a.props.name,k()},q=a=>{N(a)},{tableRegister:K,tableState:R,tableMethods:O}=se({fetchDataApi:async()=>{const{currentPage:a,pageSize:t}=R;if(!e.productId||e.propertyIds.length===0)return{list:[],total:0};let c=y.getProject,g={};switch(f.value){case"1":g={page:o(a),size:o(t),start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:c.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":g={page:o(a),size:o(t),start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:c.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":g={page:o(a),size:o(t),start:l(e.startTime,"yyyy"),end:l(e.endTime,"yyyy"),projectId:c.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}let p=U({});try{switch(f.value){case"1":case"2":case"3":p=(await ue(g)).data;break}const I=p.tableLabel.map(v=>({label:v.label,field:v.prop,fixed:v.fixed}));return C.value=I,{list:p.tableData,total:p.totalRow}}catch(I){return console.error("获取报表数据失败:",I),{list:[],total:0}}}}),{dataList:X,total:J,currentPage:h,pageSize:P}=R,{getList:k}=O,Q=async()=>{let a=await pe({page:1,size:999999});a.code===200&&(b.value=a.data?.list?.map(t=>({label:t.name,value:t.id})),b.value.length>0&&(e.productId=b.value[0].value,await N(b.value[0].value)))},N=async a=>{let t=await de({productId:a,valueType:"L"});t.code===200&&(T.value=[...t.data?.properties?.map(c=>({label:c.name,value:c.id}))],z.value++,await ve(),T.value.length>0?(e.propertyIds=[T.value[0].value],k()):e.propertyIds=[])};fe(()=>{Q()});const W=({row:a,rowIndex:t})=>a.dn==="小计"?"warning-row":a.position==="合计"||a.categorySub==="合计"||a.group==="合计"?"even-row":"";return(a,t)=>{const c=u("el-option"),g=u("el-select"),p=u("el-form-item"),I=u("el-input"),v=u("el-date-picker"),D=u("el-button"),Z=u("el-form"),ee=u("el-tab-pane"),te=u("el-tabs");return m(),_(o(ae),null,{default:n(()=>[s(Z,{model:e,class:"search-form",inline:!0},{default:n(()=>[s(p,{label:o(d)("device.productName")},{default:n(()=>[s(g,{modelValue:e.productId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.productId=r),clearable:"",onChange:q,style:{width:"120px"}},{default:n(()=>[(m(!0),x(L,null,S(b.value,r=>(m(),_(c,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(p,{label:o(d)("device.attributeName")},{default:n(()=>[(m(),_(g,{modelValue:e.propertyIds,"onUpdate:modelValue":t[1]||(t[1]=r=>e.propertyIds=r),multiple:"",clearable:"",key:z.value,style:{"min-width":"150px"}},{default:n(()=>[(m(!0),x(L,null,S(T.value,r=>(m(),_(c,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"]),s(p,{label:o(d)("device.deviceName")},{default:n(()=>[s(I,{modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=r=>e.search=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1},8,["label"]),s(p,{label:o(d)("device.startTime")},{default:n(()=>[s(v,{modelValue:e.startTime,"onUpdate:modelValue":t[3]||(t[3]=r=>e.startTime=r),type:"year"},null,8,["modelValue"])]),_:1},8,["label"]),s(p,null,{default:n(()=>[s(D,{type:"primary",onClick:F,loading:w.value,icon:o(ce)},{default:n(()=>[H(M(o(d)("device.query")),1)]),_:1},8,["loading","icon"]),s(D,{onClick:Y,loading:j.value,icon:o(ie)},{default:n(()=>[H(M(o(d)("device.exportData")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"]),s(te,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=r=>f.value=r),class:"demo-tabs",onTabClick:$},{default:n(()=>[(m(!0),x(L,null,S(G.value,r=>(m(),_(ee,{key:r.categoryId,label:r.displayName,name:r.categoryId},{default:n(()=>[s(o(ne),{border:!1,pageSize:o(P),"onUpdate:pageSize":t[4]||(t[4]=V=>A(P)?P.value=V:null),size:"small",currentPage:o(h),"onUpdate:currentPage":t[5]||(t[5]=V=>A(h)?h.value=V:null),columns:C.value,data:o(X),loading:E.value,height:B.value,pagination:{total:o(J),pageSizes:[20,40,50,100,1e3]},onRegister:o(K),showAction:"",rowClassName:W},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})}}}),Ae=le(be,[["__scopeId","data-v-e0ab5c08"]]);export{Ae as default};
