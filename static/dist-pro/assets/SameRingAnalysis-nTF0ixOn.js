import{g as _e,b as ke,f as we,h as xe}from"./index-BTXJkdku.js";import{g as Ie,c as Te,f as w,_ as De}from"./index-CAdyeJt3.js";/* empty css                *//* empty css                *//* empty css                */import{m as Le}from"./vue3-apexcharts-Bmjr8cT9.js";import{_ as Ve}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{_ as Ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{H as Q,w as Pe,F as Me,G as Ne,b as Ue}from"./element-plus--V1NSjC4.js";import{g as je,a as Ae}from"./data-Cu4NlBkL.js";import{x as ze,r as d,c as X,j as Fe,ag as p,y as c,G as g,H as i,P as n,z as V,O as A,a4 as z,A as x,u,K as Se,M as C,L as $,n as Be}from"./vue-chunks-C1K3ngR7.js";import"./index-DfycOL0q.js";/* empty css                        *//* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                         *//* empty css                  *//* empty css                       */const Ee={class:"flex flex-1 min-h-0"},Oe={class:"shrink-0"},$e={class:"flex-1 min-h-0 overflow-hidden"},Re={class:"flex items-center"},Ye={class:"ml-2 whitespace-nowrap truncate max-w-180px"},Ge={key:1,class:"el-tree__empty-block"},He={class:"el-tree__empty-text"},Ke={class:"table-container"},qe=ze({__name:"SameRingAnalysis",setup(We){const I=Ie(),{t:r}=Te(),P=d(!1),f=d("1"),R=d(0),D=d([]),h=d([]),M=d([]),Y=X(()=>`${window.innerHeight-152}px`),N=d([]),Z=d([]);d("");const ee=d({chart:{type:"line",stacked:!0,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},zoom:{enabled:!0}},colors:["#008FFB","#00E396","#fea443"],plotOptions:{bar:{grouped:!0,columnWidth:"80%",horizontal:!1,endingShape:"flat",distributed:!1}},stroke:{width:[0,0,3],curve:"smooth",dashArray:[0,0,0]},markers:{size:4,colors:"#ffc94f",hover:{size:7}},dataLabels:{enabled:!1},legend:{show:!0,position:"top",horizontalAlign:"center",offsetY:-1,itemMargin:{horizontal:15,vertical:5},markers:{radius:3}},xaxis:{type:"category",labels:{formatter:e=>e}},yaxis:[{seriesName:r("device.currentUsage"),axisTicks:{show:!0},axisBorder:{show:!0,color:"#008FFB"},labels:{style:{colors:"#008FFB"}}},{seriesName:r("device.yearOnYearUsage"),opposite:!0,axisTicks:{show:!0},axisBorder:{show:!0,color:"#00E396"},labels:{style:{colors:"#00E396"}}},{seriesName:r("device.increaseDecreasePercentage"),opposite:!0,axisTicks:{show:!0},axisBorder:{show:!0,color:"#fea443"},labels:{style:{colors:"#fea443"}}}],tooltip:{x:{show:!0},y:{formatter:e=>e??"-"}}}),a=d({productId:"",propertyIds:"",energyType:"S",period:"date",startTime:w(new Date().setDate(new Date().getDate()-5),"yyyy-MM-dd"),checkList:null,endTime:w(new Date,"yyyy-MM-dd")});d([]);const F=d([]),G=d([]),U=d([{name:r("device.currentUsage"),type:"column",data:[]},{name:r("device.yearOnYearUsage"),type:"column",data:[]},{name:r("device.increaseDecreasePercentage"),type:"line",data:[]}]),_=d(!1),ae=d([{categoryId:"1",displayName:r("device.deviceUsage")},{categoryId:"2",displayName:r("device.tagUsage")},{categoryId:"3",displayName:r("device.areaUsage")}]),te=(e,t)=>{let l=d("");a.value.period==="date"?l.value="yyyy-MM-dd":a.value.period==="month"?l.value="yyyy-MM":a.value.period==="year"&&(l.value="yyyy"),a.value.startTime=w(e,l.value),a.value.endTime=w(t,l.value)},le=e=>{f.value=e.props.name,U.value=[],a.value.checkList=null,a.value.propertyIds="",D.value=[],M.value=[],h.value,h.value.length>0?(a.value.productId=h.value[0].value,B(h.value[0].value)):K()},oe=d({label:"name",children:"children",isLeaf:e=>e.isTag}),re=e=>{switch(f.value){case"1":return e.type==="Device";case"3":return e.type==="Position";default:return!1}},se=e=>{const t=l=>{l.forEach(s=>{s.checked=!1,s.children&&t(s.children)})};e.checked?(t(D.value),e.checked=!0,a.value.checkList={type:e.type||"",nodeId:e.id}):(a.value.checkList=null,e.checked=!1),_.value=!0,k(),a.value.checkList},ne=async e=>{_.value=!0;let t=d("");e.period==="date"?t.value="yyyy-MM-dd":e.period==="month"?t.value="yyyy-MM":e.period==="year"&&(t.value="yyyy"),a.value={startTime:w(new Date().setDate(new Date().getDate()-5),t.value),endTime:w(new Date,t.value),energyType:e.energyType,period:e.period,checkList:e.checkList,productId:e.productId,propertyIds:e.propertyIds},k()},de=()=>{let e=d("");a.value.period==="date"?e.value="yyyy-MM-dd":a.value.period==="month"?e.value="yyyy-MM":a.value.period==="year"&&(e.value="yyyy"),a.value.startTime=w(new Date,e.value)},ie=async e=>{P.value=!0;let t=d("");e.period==="date"?t.value="yyyy-MM-dd":e.period==="month"?t.value="yyyy-MM":e.period==="year"&&(t.value="yyyy"),k()},k=()=>{switch(f.value){case"1":case"2":case"3":ye();break}},H=async()=>{switch(f.value){case"1":await ve();break;case"2":await pe();break;case"3":await ue();break}},ue=async()=>{try{const e=await we();if(e.code===200){let t=ce(e.data);const l=S(t);D.value=t,l&&(_.value=!0,k())}}catch(e){console.error("获取位置树失败:",e),Ue.error(r("device.failedToGetLocationData"))}},ce=e=>{if(!e)return[];const t=l=>({id:l.id.toString(),label:l.name,name:l.name,type:"Position",children:l.children?.map(t)||[],isLeaf:!l.children||l.children.length===0});return[t(e)]},pe=async()=>{let e=await xe({page:1,size:9999999999999});if(e.code===200){_.value=!1;let t=e.data.list.map(l=>({label:l.name,value:l.id}));t.length>0&&(F.value=t,a.value.checkList=t[0].value,k())}},S=e=>{for(const t of e){if(t.type==="Device"||t.type==="Position"){t.checked=!0;const l={type:t.type,nodeId:t.id};return a.value.checkList=l,t}if(t.children&&t.children.length>0){const l=S(t.children);if(l)return l}}return null},ve=async()=>{try{let e={};e={projectId:I.getProject.enable?I.getProjectId:void 0};const l=await Ae(e);if(l.code===200){let s=l.data.filter(y=>y.id===a.value.productId);const b=S(s);D.value=s,b&&(_.value=!0,k())}}catch(e){console.error("获取树形数据失败:",e)}},ye=async()=>{te(a.value.startTime,a.value.endTime);let e={},t="";a.value.checkList&&(t=a.value.checkList.nodeId);let l=I.getProject;switch(f.value){case"1":e={type:a.value.period==="date"?"day":a.value.period,start:a.value.startTime,end:a.value.endTime,projectId:l.enable?I.getProjectId:void 0,productId:a.value.productId,resourceType:"Raw",propertyIds:a.value.propertyIds,resourceIds:t,reportType:"compareAnalysis",page:1,size:99999999999999};break;case"2":e={type:a.value.period==="date"?"day":a.value.period,start:a.value.startTime,end:a.value.endTime,projectId:l.enable?I.getProjectId:void 0,productId:a.value.productId,resourceType:"Group",propertyIds:a.value.propertyIds,resourceIds:a.value.checkList,reportType:"compareAnalysis",page:1,size:99999999999999};break;case"3":e={type:a.value.period==="date"?"day":a.value.period,start:a.value.startTime,end:a.value.endTime,projectId:l.enable?I.getProjectId:void 0,productId:a.value.productId,resourceType:"Position",propertyIds:a.value.propertyIds,resourceIds:t,reportType:"compareAnalysis",page:1,size:99999999999999};break}let s=await je(e);if(s.code===200&&s.data&&Object.keys(s.data.detail).length>0){_.value=!1,P.value=!1,me(s);const b=X(()=>{const m={current:s.data.detail[a.value.startTime]||[],yoy:s.data.detail[a.value.endTime]||[],trend:s.data.detail.changePercent||[]};return[{name:r("device.yearOnYearUsage"),type:"column",yAxisIndex:0,data:m.current.map(v=>({x:v.first,y:Number(v.second)||null}))},{name:r("device.currentPeriodUsage"),type:"column",yAxisIndex:0,data:m.yoy.map(v=>({x:v.first,y:Number(v.second)||null}))},{name:r("device.increaseDecreasePercentage"),type:"line",yAxisIndex:1,data:m.trend.map(v=>({x:v.first,y:Number(v.second)||null}))}]});b.value,U.value=b.value;const y=[];Object.entries(s.data.detail).forEach(([m,v])=>{const T={},E=m==="changePercent"?r("device.increaseDecreasePercentage"):m;T.deviceName=E,v.forEach(L=>{T[L.first]=L.second}),T.total=s.data.summary[m],y.push(T)}),M.value=y}else P.value=!1,_.value=!1,M.value=[],U.value=[]},me=e=>{const t=Array.from(new Set(Object.values(e.data.detail).flat().map(l=>l.first))).sort((l,s)=>parseInt(l)-parseInt(s));G.value=[{field:"deviceName",label:r("formDemo.dates"),width:150,fixed:"left"},...t.map(l=>({field:l,label:`${l}`,width:100,formatter:s=>s[l]??"-"})),{field:"total",label:r("device.total"),width:120,fixed:"right",formatter:l=>{try{return l.total}catch{return"-"}}}]},fe=e=>{a.value.checkList=e,k()},K=async()=>{let e=await _e({page:1,size:999999});e.code===200&&(h.value=e.data?.list?.map(t=>({label:t.name,value:t.id})),h.value.length>0&&(a.value.productId=h.value[0].value,B(h.value[0].value)))},he=e=>{N.value=[],a.value.propertyIds="",B(e)},B=async e=>{let t=await ke({productId:e});t.code===200&&(N.value=[...t.data?.properties?.map(l=>({label:l.name,value:l.id}))],a.value.propertyIds=N.value[0].value,R.value++,H(),await Be())},ge=e=>{a.value,H()};return Fe(()=>{K()}),(e,t)=>{const l=p("el-tab-pane"),s=p("el-option"),b=p("el-select"),y=p("el-form-item"),m=p("el-form"),v=p("el-checkbox"),T=p("el-tooltip"),E=p("el-radio"),L=p("el-radio-group"),O=p("el-radio-button"),q=p("el-date-picker"),W=p("el-button"),be=p("el-tabs");return c(),g(u(Ce),{style:{"margin-bottom":"2px"}},{default:i(()=>[n(be,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=o=>f.value=o),class:"demo-tabs h-full",onTabClick:le},{default:i(()=>[(c(!0),V(A,null,z(ae.value,o=>(c(),g(l,{key:o.categoryId,label:o.displayName,name:o.categoryId},null,8,["label","name"]))),128)),x("div",Ee,[n(u(Q),{class:"w-300px flex flex-col overflow-x-auto","body-style":{height:Y.value,overflow:"auto"}},{default:i(()=>[x("div",Oe,[n(m,null,{default:i(()=>[n(y,null,{default:i(()=>[n(b,{placeholder:u(r)("common.selectText"),modelValue:a.value.productId,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.productId=o),clearable:"",onChange:he,style:{width:"110px"}},{default:i(()=>[(c(!0),V(A,null,z(h.value,o=>(c(),g(s,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"])]),_:1}),n(y,null,{default:i(()=>[(c(),g(b,{placeholder:u(r)("common.selectText"),modelValue:a.value.propertyIds,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.propertyIds=o),clearable:"",key:R.value,style:{"min-width":"110px"},onChange:ge},{default:i(()=>[(c(!0),V(A,null,z(N.value,o=>(c(),g(s,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]))]),_:1})]),_:1})]),x("div",$e,[f.value==="1"||f.value==="3"?(c(),g(u(Pe),{key:0,"default-expand-all":"",ref:"treeRef",data:D.value,props:oe.value,"expand-on-click-node":!1,"check-strictly":!0,"expanded-keys":Z.value,class:"h-full w-full min-w-full w-300px tree-container","node-key":"id"},{default:i(({node:o,data:j})=>[x("div",Re,[re(j)?(c(),g(v,{key:0,modelValue:j.checked,"onUpdate:modelValue":J=>j.checked=J,onChange:J=>se(j)},null,8,["modelValue","onUpdate:modelValue","onChange"])):Se("",!0),n(T,{effect:"light",content:o.label,placement:"right"},{default:i(()=>[x("span",Ye,C(o.label),1)]),_:2},1032,["content"])])]),_:1},8,["data","props","expanded-keys"])):(c(),g(L,{key:1,modelValue:a.value.checkList,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.checkList=o),class:"vertical-radio",onChange:fe},{default:i(()=>[F.value.length>0?(c(!0),V(A,{key:0},z(F.value,o=>(c(),g(E,{key:o.value,value:o.value},{default:i(()=>[$(C(o.label),1)]),_:2},1032,["value"]))),128)):(c(),V("div",Ge,[x("span",He,C(u(r)("device.noDataAvailable")),1)]))]),_:1},8,["modelValue"]))])]),_:1},8,["body-style"]),n(u(Q),{class:"flex-1 ml-5px h-full","body-style":{height:Y.value,overflow:"auto"}},{default:i(()=>[n(m,{model:a.value,"label-width":"auto","label-position":"left",inline:!0},{default:i(()=>[n(y,{label:u(r)("device.timeCycle")},{default:i(()=>[n(L,{modelValue:a.value.period,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.period=o),onChange:t[4]||(t[4]=o=>ne(a.value))},{default:i(()=>[n(O,{label:u(r)("device.day"),value:"date"},null,8,["label"]),n(O,{label:u(r)("formDemo.month"),value:"month"},null,8,["label"]),n(O,{label:u(r)("formDemo.year"),value:"year"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),n(y,{label:u(r)("device.yearOnYearUsage")},{default:i(()=>[n(q,{modelValue:a.value.startTime,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.startTime=o),type:a.value.period,style:{"max-width":"120px"}},null,8,["modelValue","type"])]),_:1},8,["label"]),n(y,{label:u(r)("device.currentUsage")},{default:i(()=>[n(q,{modelValue:a.value.endTime,"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.endTime=o),type:a.value.period,style:{"max-width":"120px"}},null,8,["modelValue","type"])]),_:1},8,["label"]),n(y,null,{default:i(()=>[n(W,{type:"primary",onClick:t[7]||(t[7]=o=>ie(a.value)),icon:u(Me),loading:P.value},{default:i(()=>[$(C(u(r)("device.query")),1)]),_:1},8,["icon","loading"]),n(W,{icon:u(Ne),onClick:de},{default:i(()=>[$(C(u(r)("common.reset")),1)]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),n(u(Le),{type:"area",height:"55%",options:ee.value,series:U.value,style:{"overflow-x":"hidden","overflow-y":"hidden"}},null,8,["options","series"]),x("div",Ke,[n(u(Ve),{columns:G.value,data:M.value,showAction:"","max-height":"200"},null,8,["columns","data"])])]),_:1},8,["body-style"])])]),_:1},8,["modelValue"])]),_:1})}}}),ma=De(qe,[["__scopeId","data-v-b6423981"]]);export{ma as default};
