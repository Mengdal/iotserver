import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{g as re,c as oe,f as l,_ as le}from"./index-CAdyeJt3.js";import{_ as ne}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{u as se}from"./useTable-Cg8mTZpf.js";import{g as pe,b as de}from"./index-BTXJkdku.js";import{F as ce,M as ie}from"./element-plus--V1NSjC4.js";import{g as ue}from"./data-Cu4NlBkL.js";import{e as ye}from"./export-BUcENNsn.js";import{x as me,r as i,X as D,c as ge,j as fe,ag as u,y as m,G as _,H as n,P as s,u as o,z as V,O as x,a4 as L,L as U,M as H,l as A,n as ve}from"./vue-chunks-C1K3ngR7.js";/* empty css                *//* empty css                  *//* empty css                        *//* empty css                *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";const be=me({__name:"EnergyReportMonth",setup(Ie){const y=re(),{t:c}=oe(),S=i(0),M=i(!1),w=i(!1),g=i("1"),E=i(!1),z=i([]),e=D({reportType:"report",type:"month",search:"",productId:"",propertyIds:[],startTime:l(new Date(new Date().setHours(0,0,0,0)),"yyyy-MM"),endTime:l(new Date(new Date),"yyyy-MM-dd HH:mm:ss")}),B=ge(()=>window.innerHeight-290),T=i([]),b=i([]),G=i([{categoryId:"1",displayName:c("device.deviceReport")},{categoryId:"2",displayName:c("device.tagReport")},{categoryId:"3",displayName:c("device.areaReport")}]),F=()=>{M.value=!0,P().finally(()=>{M.value=!1})},$=async()=>{try{w.value=!0;let a={},t=y.getProject;switch(g.value){case"1":a={start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":a={start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":a={start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}await ye(a)}catch(a){console.error("导出失败:",a)}finally{w.value=!1}},q=a=>{h.value=1,g.value=a.props.name,P()},K=a=>{R(a)},{tableRegister:O,tableState:C,tableMethods:X}=se({fetchDataApi:async()=>{const{currentPage:a,pageSize:t}=C;if(!e.productId||e.propertyIds.length===0)return{list:[],total:0};let d={},f=y.getProject;switch(g.value){case"1":d={page:o(a),size:o(t),start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":d={page:o(a),size:o(t),start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":d={page:o(a),size:o(t),start:l(e.startTime,"yyyy-MM"),end:l(e.endTime,"yyyy-MM"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}let p=D({});try{switch(g.value){case"1":case"2":case"3":p=(await ue(d)).data;break}const I=p.tableLabel.map(v=>({label:v.label,field:v.prop,fixed:v.fixed}));return z.value=I,{list:p.tableData,total:p.totalRow}}catch(I){return console.error("获取报表数据失败:",I),{list:[],total:0}}}}),{dataList:J,total:Q,currentPage:h,pageSize:j}=C,{getList:P}=X,W=async()=>{let a=await pe({page:1,size:999999});a.code===200&&(b.value=a.data?.list?.map(t=>({label:t.name,value:t.id})),b.value.length>0&&(e.productId=b.value[0].value,await R(b.value[0].value)))},R=async a=>{let t=await de({productId:a,valueType:"L"});t.code===200&&(T.value=[...t.data?.properties?.map(d=>({label:d.name,value:d.id}))],S.value++,await ve(),T.value.length>0?(e.propertyIds=[T.value[0].value],P()):e.propertyIds=[])};fe(()=>{W()});const Y=({row:a,rowIndex:t})=>a.dn==="小计"?"warning-row":a.position==="合计"||a.categorySub==="合计"||a.group==="合计"?"even-row":"";return(a,t)=>{const d=u("el-option"),f=u("el-select"),p=u("el-form-item"),I=u("el-input"),v=u("el-date-picker"),N=u("el-button"),Z=u("el-form"),ee=u("el-tab-pane"),te=u("el-tabs");return m(),_(o(ae),null,{default:n(()=>[s(Z,{model:e,class:"search-form",inline:!0},{default:n(()=>[s(p,{label:o(c)("device.productName")},{default:n(()=>[s(f,{modelValue:e.productId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.productId=r),clearable:"",onChange:K,style:{width:"120px"}},{default:n(()=>[(m(!0),V(x,null,L(b.value,r=>(m(),_(d,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(p,{label:o(c)("device.attributeName")},{default:n(()=>[(m(),_(f,{modelValue:e.propertyIds,"onUpdate:modelValue":t[1]||(t[1]=r=>e.propertyIds=r),multiple:"",clearable:"",key:S.value,style:{"min-width":"150px"}},{default:n(()=>[(m(!0),V(x,null,L(T.value,r=>(m(),_(d,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"]),s(p,{label:o(c)("device.deviceName")},{default:n(()=>[s(I,{modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=r=>e.search=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1},8,["label"]),s(p,{label:o(c)("device.startTime")},{default:n(()=>[s(v,{modelValue:e.startTime,"onUpdate:modelValue":t[3]||(t[3]=r=>e.startTime=r),type:"month"},null,8,["modelValue"])]),_:1},8,["label"]),s(p,null,{default:n(()=>[s(N,{type:"primary",onClick:F,loading:M.value,icon:o(ce)},{default:n(()=>[U(H(o(c)("device.query")),1)]),_:1},8,["loading","icon"]),s(N,{onClick:$,loading:w.value,icon:o(ie)},{default:n(()=>[U(H(o(c)("device.exportData")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"]),s(te,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=r=>g.value=r),class:"demo-tabs",onTabClick:q},{default:n(()=>[(m(!0),V(x,null,L(G.value,r=>(m(),_(ee,{key:r.categoryId,label:r.displayName,name:r.categoryId},{default:n(()=>[s(o(ne),{border:!1,pageSize:o(j),"onUpdate:pageSize":t[4]||(t[4]=k=>A(j)?j.value=k:null),size:"small",currentPage:o(h),"onUpdate:currentPage":t[5]||(t[5]=k=>A(h)?h.value=k:null),columns:z.value,data:o(J),loading:E.value,height:B.value,pagination:{total:o(Q),pageSizes:[20,40,50,100,1e3]},onRegister:o(O),showAction:"",rowClassName:Y},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})}}}),Ae=le(be,[["__scopeId","data-v-13c6884a"]]);export{Ae as default};
