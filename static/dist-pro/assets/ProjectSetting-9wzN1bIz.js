import{_ as M}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{F as D}from"./Form-CzZbC4Aj.js";import{u as T}from"./useForm-CD85wrwf.js";import{g as x,c as C,u as v,f as y,e as F}from"./index-CAdyeJt3.js";import{a as P,e as R,s as k}from"./index-DHVFwXOq.js";import{x as V,aH as N,r as h,c as z,P as r,O as $,j as B,ag as O,y as q,G as A,H as m,A as b,u as s,L as E,M as H,aa as G}from"./vue-chunks-C1K3ngR7.js";import{b as i,a as J}from"./element-plus--V1NSjC4.js";/* empty css                *//* empty css                  *//* empty css               *//* empty css               *//* empty css                */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                       *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";import"./index-DfycOL0q.js";const K={class:"form-container"},Q={class:"mt-10"};function W(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!G(n)}const ve=V({__name:"ProjectSetting",setup(n){const p=x(),{t}=C(),S=v();N();const c=h(""),{formRegister:U,formMethods:j}=T(),{setValues:d,getFormData:u}=j,f=h([]),w=async e=>{const a=new FormData;a.append("logo",e.file);try{const o=await R(a,p.getUserInfo.departmentId);o.code===200&&(c.value=o.data.url,d({...u(),logo:o.data.url}),i.success(t("prepaid.success")),g())}catch{i.error(t("prepaid.failed"))}},I=z(()=>[{field:"name",label:t("device.projectName"),component:"Input"},{field:"description",label:t("device.projectDescription"),component:"Input"},{field:"created",label:t("device.activationTime"),component:"DatePicker",componentProps:{type:"date"}},{field:"logo",component:"Upload",label:t("device.projectLogo"),componentProps:{showFileList:!1,fileList:f.value,httpRequest:w,beforeUpload:e=>{const a=["image/jpeg","image/png","image/gif"].includes(e.type),o=e.size/1024/1024<2;return a?o?!0:(i.error(t("device.imageSizeLimit")),!1):(i.error(t("device.imageFormatRequired")),!1)},slots:{default:()=>{let e;return r($,null,[c.value?r("img",{src:c.value,class:"avatar",style:"width: 178px; height: 178px"},null):r(J,{class:"avatar-uploader-icon",size:"large"},W(e=t("device.clickToUploadLogo"))?e:{default:()=>[e]})])}}}}]);B(()=>{g()});const g=async()=>{const e=await P({departmentId:p.getUserInfo.departmentId});if(e.code===200){e.data;let a={name:e.data.name,description:e.data.remark,created:y(e.data.created*1e3,"yyyy-MM-dd"),logo:e.data.logo};if(d(a),e.data.logo){let o="production",l="";l=new URL(window.location.href).origin,c.value=`${l}/${e.data.logo}`,f.value=[{name:"logo",url:e.data.logo}];const _=v();_.initTheme(),_.setImgUrl(e.data.logo)}}},L=async()=>{let e=await u(),a={name:e.name,description:e.description,time:y(e.activeTime,"yyyy-MM-dd")};(await k(a)).code===200&&(i.success(t("device.operationSuccess")),S.initTheme(e.name))};return(e,a)=>{const o=O("el-button");return q(),A(s(M),{title:s(t)("router.departmentSettings")},{default:m(()=>[b("div",K,[r(s(D),{schema:I.value,onRegister:s(U),isCol:!1},null,8,["schema","onRegister"]),b("div",Q,[r(s(F),{permission:"SubmitChanges"},{default:m(()=>[r(o,{type:"primary",size:"large",onClick:L},{default:m(()=>[E(H(s(t)("role.SubmitChanges")),1)]),_:1})]),_:1})])])]),_:1},8,["title"])}}});export{ve as default};
