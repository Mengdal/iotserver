import{_ as Z}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{_ as ee}from"./Search.vue_vue_type_script_setup_true_lang-BCCD0GAn.js";import{c as ke,e as M,i as ze,_ as Ie}from"./index-CAdyeJt3.js";/* empty css                  *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                  */import"./Form-CzZbC4Aj.js";/* empty css                  *//* empty css                       */import{_ as $}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{q as P,r as Ue,s as De,t as Ee,g as Ne}from"./index-BTXJkdku.js";import{u as Re}from"./useTable-Cg8mTZpf.js";import{m as ae,d as v,i as Me,b as j,p as Be,ad as Fe,ae as y,s as k,V as te,aa as B,ao as Ae,u as le,T as Oe,al as Le}from"./element-plus--V1NSjC4.js";import{W as $e,x as je,r as u,aA as He,X as w,c as oe,P as i,O as F,y as H,z as qe,H as n,u as e,A as z,L as b,M as h,l as q,G as ie,K as se,aa as Ye,n as We}from"./vue-chunks-C1K3ngR7.js";import{u as Ge}from"./useCrudSchemas-CWNcgDVA.js";import{d as Je}from"./dateUtil-HUUeH7cc.js";/* empty css                */import"./useForm-CD85wrwf.js";/* empty css               *//* empty css                *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";/* empty css                        *//* empty css                         */import"./index-DfycOL0q.js";import"./tree-R6XTZANN.js";function Ke(d){return{all:d=d||new Map,on:function(r,m){var c=d.get(r);c?c.push(m):d.set(r,[m])},off:function(r,m){var c=d.get(r);c&&(m?c.splice(c.indexOf(m)>>>0,1):d.set(r,[]))},emit:function(r,m){var c=d.get(r);c&&c.slice().map(function(a){a(m)}),(c=d.get("*"))&&c.slice().map(function(a){a(r,m)})}}}const _=Ke(),Xe=d=>(_.on(d.name,d.callback),$e(()=>{_.off(d.name)}),{on:_.on,off:_.off,emit:_.emit,all:_.all}),Qe={class:"mb-10px"},Ze={class:"demo-drawer__content"},ea={style:{width:"100%"}},aa={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}};function x(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!Ye(d)}const V="80px",ta=je({name:"ExamplePage",__name:"Product",setup(d){const r=u("1"),{addRoute:m,push:c}=He(),{t:a}=ke(),s=w({name:"",status:"0",description:"",nodeType:a("device.gatewaySubDevice"),factory:"",id:"",category:{id:"",name:""}}),ne=oe(()=>window.innerHeight-304),I=u("create"),de=oe(()=>I.value==="create"?a("device.createProduct"):a("device.editProduct"));let U=u(0),T=u(!1);const Y=u({}),W=u({}),re=l=>{Y.value=l,S()},G=async l=>{W.value=l,f.value=1;const t=await P({page:f.value,size:C.value,name:W.value.name});R.value=t.data.list,U.value=t.data.totalRow},f=u(1),C=u(10),ce=async()=>{const l=await P({page:f.value,size:C.value});R.value=l.data.list,U.value=l.data.totalRow,D.value=!0},ue=async l=>{f.value=l;const t=await P({page:f.value,size:C.value});R.value=t.data.list,U.value=t.data.totalRow},J=u(),p=u(!1),D=u(!1),me=async l=>{if(l)switch(I.value){case"create":await l.validate(async(t,o)=>{if(t){let g={name:s.name,status:s.status,description:s.description,nodeType:s.nodeType,factory:s.factory,categoryId:r.value==="1"?s.category.id:void 0};const L=await Ee(g);L.code==200&&(j.success(a("base.success")),p.value=!1,S())}});break;case"edit":await l.validate(async(t,o)=>{if(t){let g={name:s.name,status:s.status,description:s.description,nodeType:s.nodeType,factory:s.factory,categoryId:r.value==="1"?s.category.id:void 0,id:s.id};(await De(g)).code==200&&(j.success(a("base.success")),p.value=!1,S())}})}},pe=()=>{E.value=!1,p.value=!1},fe=w({name:[{required:!0,message:a("common.inputText"),trigger:"blur"}],status:[{required:!0,message:a("device.thisItemIsMandatory"),trigger:"change"}],"category.name":[{required:!0,message:a("common.selectText"),trigger:"change"}]}),{tableRegister:ge,tableState:K,tableMethods:ve}=Re({fetchDataApi:async()=>{const{currentPage:l,pageSize:t}=K,o=await Ne({page:e(l),size:e(t),name:e(Y)});return{list:o.data.list,total:o.data.totalRow}}}),{loading:E,dataList:ye,total:be,currentPage:N,pageSize:A}=K,{getList:S}=ve;Xe({name:"getList",callback:l=>{l==="add"&&(N.value=1),S()}});const he=w([{field:"id",label:a("device.productId"),search:{component:"Input"},form:{component:"Input",colProps:{span:24}},detail:{span:24}},{field:"name",label:a("device.productName"),search:{hidden:!0}},{field:"nodeType",label:a("device.type"),search:{hidden:!0}},{field:"dataFormat",label:a("device.model"),search:{hidden:!0}},{field:"factory",label:a("device.factoryName"),search:{hidden:!0}},{field:"description",label:a("device.description"),search:{hidden:!0}},{field:"created",label:a("device.createTime"),search:{hidden:!0},table:{slots:{default:l=>Je(l.row.created*1e3).format("YYYY-MM-DD HH:mm:ss")}}},{field:"status",width:"90px",label:a("device.status"),search:{hidden:!0},table:{slots:{default:l=>i(ae,{type:l.row.status===1?"success":"danger"},{default:()=>[l.row.status===1?a("device.published"):a("device.unpublished")]})}}},{field:"action",align:"center",width:"240px",label:a("device.operation"),search:{hidden:!0},form:{hidden:!0},detail:{hidden:!0},table:{slots:{default:l=>{let t,o,g;return i(F,null,[i(M,{permission:"Details"},{default:()=>[i(v,{text:!0,type:"success",onClick:()=>O(l.row,"view")},x(t=a("device.details"))?t:{default:()=>[t]})]}),i(M,{permission:"Edit"},{default:()=>[i(v,{text:!0,type:"primary",onClick:()=>O(l.row,"edit")},x(o=a("device.edit"))?o:{default:()=>[o]})]}),i(M,{permission:"Delete"},{default:()=>[i(v,{text:!0,type:"danger",onClick:()=>O(l.row,"del")},x(g=a("device.delete"))?g:{default:()=>[g]})]})])}}}}]),{allSchemas:X}=Ge(he),we=w([{field:"name",component:"Input"}]),_e=w([{field:"categoryName",label:a("device.categoryName")},{field:"scene",label:a("device.belongingScenario")},{field:"action",width:"200px",label:a("tableDemo.action"),slots:{default:l=>{let t,o;return i(F,null,[i(v,{type:"primary",text:!0,onClick:()=>Ce(l)},x(t=a("device.select"))?t:{default:()=>[t]}),i(v,{type:"primary",text:!0,onClick:()=>Se(l)},x(o=a("device.viewThingModel"))?o:{default:()=>[o]})])}}}]),xe=w([{field:"action",label:a("device.functionName"),slots:{default:l=>{let t;return i(F,null,[i("span",{style:"margin-right:10px"},[a("device.attribute")]),i(ae,{size:"small"},x(t=a("device.system"))?t:{default:()=>[t]})])}}},{field:"name",label:a("device.functionName")},{field:"identifier",label:a("device.identifier")},{field:"dataType",label:a("device.dataType")}]),Q=u([]),R=u([]),Ve=()=>{Object.assign(s,{name:"",status:"0",description:"",nodeType:a("device.gatewaySubDevice"),factory:"",id:"",category:{id:"",name:""}})},Te=()=>{I.value="create",Ve(),r.value="1",We(),p.value=!0},Ce=l=>{s.category.name=l.row.categoryName,s.category.id=l.row.id,D.value=!1},Se=async l=>{const t=await P({id:l.row.id});Q.value=t.data.properties,T.value=!0},O=async(l,t)=>{if(t==="edit"){I.value="edit";let o="";l.categoryId===0?(s.category.name=a("device.customThingModel"),s.category.id=l.categoryId,r.value="2"):(r.value="1",o=await Pe(l.categoryId),s.category.name=o.category_name,s.category.id=l.categoryId),s.name=l.name,s.status=l.status.toString(),s.description=l.description,s.nodeType=l.nodeType,s.factory=l.factory,s.id=l.id,p.value=!0}else t==="del"?Me.confirm(a("common.delMessage"),a("common.delWarning"),{confirmButtonText:a("common.delOk"),cancelButtonText:a("common.delCancel"),type:"warning"}).then(()=>{Ue({id:l.id}).then(o=>{o.code===200&&(j.success(a("common.delSuccess")),S())})}):t=="view"&&c(`/device/product/detail/${JSON.stringify({productId:l.id})}`)},Pe=async l=>l===0?void 0:(await P({id:l})).data;return(l,t)=>(H(),qe(F,null,[i(e(Z),null,{default:n(()=>[i(e(ee),{schema:e(X).searchSchema,onSearch:re,"show-reset":!1},null,8,["schema"])]),_:1}),i(e(Z),null,{default:n(()=>[z("div",Qe,[i(e(M),{permission:"Create"},{default:n(()=>[i(e(ze),{type:"primary",onClick:Te,icon:e(Be)},{default:n(()=>[b(h(e(a)("device.createProduct")),1)]),_:1},8,["icon"])]),_:1})]),i(e($),{border:!1,pageSize:e(A),"onUpdate:pageSize":t[0]||(t[0]=o=>q(A)?A.value=o:null),size:"small",currentPage:e(N),"onUpdate:currentPage":t[1]||(t[1]=o=>q(N)?N.value=o:null),columns:e(X).tableColumns,data:e(ye),loading:e(E),height:ne.value,pagination:{total:e(be),pageSizes:[20,40,50,100,1e3]},onRegister:e(ge),showAction:""},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:1}),p.value?(H(),ie(e(le),{key:0,modelValue:p.value,"onUpdate:modelValue":t[13]||(t[13]=o=>p.value=o),title:de.value,size:"50%",direction:"rtl",class:"demo-drawer"},{footer:n(()=>[z("div",null,[i(e(v),{type:"primary",loading:e(E),onClick:t[12]||(t[12]=o=>me(J.value))},{default:n(()=>[b(h(e(E)?"创建中 ...":e(a)("device.create")),1)]),_:1},8,["loading"]),i(e(v),{onClick:pe},{default:n(()=>[b(h(e(a)("device.cancel")),1)]),_:1})])]),default:n(()=>[z("div",Ze,[i(e(Fe),{model:s,rules:fe,ref_key:"ruleFormRef",ref:J,"label-position":"top"},{default:n(()=>[i(e(y),{label:e(a)("device.productName"),prop:"name","label-width":V},{default:n(()=>[i(e(k),{modelValue:s.name,"onUpdate:modelValue":t[2]||(t[2]=o=>s.name=o),autocomplete:"off",placeholder:e(a)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(e(y),{label:e(a)("device.category")},{default:n(()=>[i(e(te),{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=o=>r.value=o)},{default:n(()=>[i(e(B),{value:"1",size:"large"},{default:n(()=>[b(h(e(a)("device.standardCategory")),1)]),_:1}),i(e(B),{value:"2",size:"large"},{default:n(()=>[b(h(e(a)("device.customCategory")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r.value==="1"?(H(),ie(e(y),{key:0,label:e(a)("device.standardCategory"),prop:"category.name","label-width":V},{default:n(()=>[i(e(k),{modelValue:s.category.name,"onUpdate:modelValue":t[4]||(t[4]=o=>s.category.name=o),class:"pointer_input","suffix-icon":e(Ae),onClick:ce,placeholder:e(a)("common.selectText")},null,8,["modelValue","suffix-icon","placeholder"])]),_:1},8,["label"])):se("",!0),i(e(y),{label:e(a)("device.type"),"label-width":V},{default:n(()=>[i(e(k),{modelValue:s.nodeType,"onUpdate:modelValue":t[5]||(t[5]=o=>s.nodeType=o),autocomplete:"off",placeholder:e(a)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(e(y),{label:e(a)("device.factoryName"),"label-width":V},{default:n(()=>[i(e(k),{modelValue:s.factory,"onUpdate:modelValue":t[6]||(t[6]=o=>s.factory=o),autocomplete:"off",placeholder:e(a)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(e(y),{label:e(a)("device.description"),"label-width":V},{default:n(()=>[i(e(k),{modelValue:s.description,"onUpdate:modelValue":t[7]||(t[7]=o=>s.description=o),autocomplete:"off",placeholder:e(a)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(e(y),{label:e(a)("device.isPublished"),prop:"status","label-width":V},{default:n(()=>[i(e(te),{modelValue:s.status,"onUpdate:modelValue":t[8]||(t[8]=o=>s.status=o)},{default:n(()=>[i(e(B),{value:"1",size:"large"},{default:n(()=>[b(h(e(a)("device.publish")),1)]),_:1}),i(e(B),{value:"0",size:"large"},{default:n(()=>[b(h(e(a)("device.stopPublishing")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),i(e(le),{modelValue:D.value,"onUpdate:modelValue":t[11]||(t[11]=o=>D.value=o),class:"innerDrawer",title:e(a)("device.selectCategory"),size:"45%","append-to-body":!0},{default:n(()=>[i(e(ee),{schema:we,onSearch:G,onReset:G},null,8,["schema"]),z("div",ea,[i(e($),{columns:_e,data:R.value},null,8,["columns","data"]),z("div",aa,[i(e(Oe),{"current-page":f.value,"onUpdate:currentPage":t[9]||(t[9]=o=>f.value=o),"page-size":C.value,"onUpdate:pageSize":t[10]||(t[10]=o=>C.value=o),layout:"total, prev, pager, next",total:e(U),onCurrentChange:ue},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])):se("",!0),i(e(Le),{modelValue:e(T),"onUpdate:modelValue":t[14]||(t[14]=o=>q(T)?T.value=o:T=o),title:e(a)("device.standardFunctionDefinition")},{default:n(()=>[i(e($),{columns:xe,data:Q.value,style:{height:"600px"}},null,8,["columns","data"])]),_:1},8,["modelValue","title"])],64))}}),Da=Ie(ta,[["__scopeId","data-v-19dd6b78"]]);export{Da as default};
