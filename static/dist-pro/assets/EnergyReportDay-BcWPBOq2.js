import{_ as ae}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{g as re,c as oe,f as l,_ as le}from"./index-CAdyeJt3.js";import{_ as de}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";import{u as ne}from"./useTable-Cg8mTZpf.js";import{g as se,b as pe}from"./index-BTXJkdku.js";import{F as ce,M as ie}from"./element-plus--V1NSjC4.js";import{g as ue}from"./data-Cu4NlBkL.js";import{e as ye}from"./export-BUcENNsn.js";import{x as me,r as i,X as N,c as ge,j as fe,ag as u,y as m,G as _,H as d,P as n,u as r,z as x,O as V,a4 as L,L as U,M as H,l as A,n as ve}from"./vue-chunks-C1K3ngR7.js";/* empty css                *//* empty css                  *//* empty css                        *//* empty css                *//* empty css               */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                         *//* empty css                  *//* empty css                       */import"./index-DfycOL0q.js";const be=me({__name:"EnergyReportDay",setup(Ie){const y=re(),{t:p}=oe(),S=i(0),M=i(!1),w=i(!1),g=i("1"),E=i(!1),z=i([]),e=N({reportType:"report",type:"day",search:"",productId:"",propertyIds:[],startTime:l(new Date(new Date().setHours(0,0,0,0)),"yyyy-MM-dd"),endTime:l(new Date(new Date),"yyyy-MM-dd HH:mm:ss")}),B=ge(()=>window.innerHeight-290),T=i([]),b=i([]),G=i([{categoryId:"1",displayName:p("device.deviceReport")},{categoryId:"2",displayName:p("device.tagReport")},{categoryId:"3",displayName:p("device.areaReport")}]),F=()=>{M.value=!0,P().finally(()=>{M.value=!1})},$=async()=>{try{w.value=!0;let a={},t=y.getProject;switch(g.value){case"1":a={start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":a={start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":a={start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:t.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}await ye(a)}catch(a){console.error("导出失败:",a)}finally{w.value=!1}},q=a=>{h.value=1,g.value=a.props.name,P()},K=a=>{D(a)},{tableRegister:O,tableState:C,tableMethods:X}=ne({fetchDataApi:async()=>{const{currentPage:a,pageSize:t}=C;if(!e.productId||e.propertyIds.length===0)return{list:[],total:0};let c={},f=y.getProject;switch(g.value){case"1":c={page:r(a),size:r(t),start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Product"};break;case"2":c={page:r(a),size:r(t),start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Group"};break;case"3":c={page:r(a),size:r(t),start:l(e.startTime,"yyyy-MM-dd"),end:l(e.endTime,"yyyy-MM-dd"),projectId:f.enable?y.getProjectId:void 0,search:e.search,productId:e.productId,propertyIds:e.propertyIds.join(","),type:e.type,reportType:e.reportType,resourceType:"Position"};break}let s=N({});try{switch(g.value){case"1":case"2":case"3":s=(await ue(c)).data;break}const I=s.tableLabel.map(v=>({label:v.label,field:v.prop,fixed:v.fixed}));return z.value=I,{list:s.tableData,total:s.totalRow}}catch(I){return console.error("获取报表数据失败:",I),{list:[],total:0}}}}),{dataList:J,total:Q,currentPage:h,pageSize:j}=C,{getList:P}=X,W=async()=>{let a=await se({page:1,size:999999});a.code===200&&(b.value=a.data?.list?.map(t=>({label:t.name,value:t.id})),b.value.length>0&&(e.productId=b.value[0].value,await D(b.value[0].value)))},D=async a=>{let t=await pe({productId:a,valueType:"L"});t.code===200&&(T.value=[...t.data?.properties?.map(c=>({label:c.name,value:c.id}))],S.value++,await ve(),T.value.length>0?(e.propertyIds=[T.value[0].value],P()):e.propertyIds=[])};fe(()=>{W()});const Y=({row:a,rowIndex:t})=>a.dn==="小计"?"warning-row":a.position==="合计"||a.categorySub==="合计"||a.group==="合计"?"even-row":"";return(a,t)=>{const c=u("el-option"),f=u("el-select"),s=u("el-form-item"),I=u("el-input"),v=u("el-date-picker"),R=u("el-button"),Z=u("el-form"),ee=u("el-tab-pane"),te=u("el-tabs");return m(),_(r(ae),null,{default:d(()=>[n(Z,{model:e,class:"search-form",inline:!0},{default:d(()=>[n(s,{label:r(p)("device.productName")},{default:d(()=>[n(f,{modelValue:e.productId,"onUpdate:modelValue":t[0]||(t[0]=o=>e.productId=o),clearable:"",onChange:K,style:{width:"120px"}},{default:d(()=>[(m(!0),x(V,null,L(b.value,o=>(m(),_(c,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),n(s,{label:r(p)("device.attributeName")},{default:d(()=>[(m(),_(f,{modelValue:e.propertyIds,"onUpdate:modelValue":t[1]||(t[1]=o=>e.propertyIds=o),multiple:"",clearable:"",key:S.value,style:{"min-width":"150px"}},{default:d(()=>[(m(!0),x(V,null,L(T.value,o=>(m(),_(c,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label"]),n(s,{label:r(p)("device.deviceName")},{default:d(()=>[n(I,{modelValue:e.search,"onUpdate:modelValue":t[2]||(t[2]=o=>e.search=o),placeholder:r(p)("common.inputText")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(s,{label:r(p)("device.startTime")},{default:d(()=>[n(v,{modelValue:e.startTime,"onUpdate:modelValue":t[3]||(t[3]=o=>e.startTime=o),type:"date"},null,8,["modelValue"])]),_:1},8,["label"]),n(s,null,{default:d(()=>[n(R,{type:"primary",onClick:F,loading:M.value,icon:r(ce)},{default:d(()=>[U(H(r(p)("device.query")),1)]),_:1},8,["loading","icon"]),n(R,{onClick:$,loading:w.value,icon:r(ie)},{default:d(()=>[U(H(r(p)("device.exportData")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"]),n(te,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=o=>g.value=o),class:"demo-tabs",onTabClick:q},{default:d(()=>[(m(!0),x(V,null,L(G.value,o=>(m(),_(ee,{key:o.categoryId,label:o.displayName,name:o.categoryId},{default:d(()=>[n(r(de),{border:!1,pageSize:r(j),"onUpdate:pageSize":t[4]||(t[4]=k=>A(j)?j.value=k:null),size:"small",currentPage:r(h),"onUpdate:currentPage":t[5]||(t[5]=k=>A(h)?h.value=k:null),columns:z.value,data:r(J),loading:E.value,height:B.value,pagination:{total:r(Q),pageSizes:[20,40,50,100,1e3]},onRegister:r(O),showAction:"",rowClassName:Y},null,8,["pageSize","currentPage","columns","data","loading","height","pagination","onRegister"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})}}}),Ae=le(be,[["__scopeId","data-v-6453af46"]]);export{Ae as default};
