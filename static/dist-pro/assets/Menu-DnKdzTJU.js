import{d as j,g as F,a as H,e as z}from"./index-5XhoBoFQ.js";import{u as G}from"./useTable-Cg8mTZpf.js";import{c as K,I as P,e as _,i as b,_ as U}from"./index-CAdyeJt3.js";import{_ as W}from"./Table.vue_vue_type_script_lang-D3v-kC-o.js";/* empty css               */import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CrtdylkU.js";import{m as q,i as Q,b as u,p as Y}from"./element-plus--V1NSjC4.js";import{_ as Z}from"./Dialog.vue_vue_type_style_index_0_lang-aEWcq84Q.js";import{_ as ee}from"./SysMenWrite.vue_vue_type_script_setup_true_lang-DxdkOXR6.js";import{x as te,r as l,X as w,P as s,O as m,ag as N,y as h,z as ae,H as c,A as ie,u as o,L as x,M as S,G as k,K as I,aa as se}from"./vue-chunks-C1K3ngR7.js";import"./index-DfycOL0q.js";/* empty css                        *//* empty css                *//* empty css                  */import"./el-checkbox-group-Cm0j4lwI.js";/* empty css                *//* empty css                         *//* empty css                  *//* empty css                       *//* empty css                  */import"./Form-CzZbC4Aj.js";/* empty css               *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";/* empty css                */import"./wang-editor-Bckixh16.js";import"./useForm-CD85wrwf.js";import"./useValidator-Barz9SCp.js";import"./AddButtonPermission.vue_vue_type_script_setup_true_lang-ClaqqdUG.js";const oe={class:"mb-10px"};function M(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!se(f)}const ne=te({__name:"Menu",setup(f){const{t}=K();l("menu");const{tableRegister:A,tableState:C,tableMethods:O}=G({fetchDataApi:async()=>{const a=await F();if(a.code===200)return{list:a.data||[]}}}),{dataList:V,loading:T}=C,{getList:y}=O,J=w([{field:"index",label:t("userDemo.index"),type:"index"},{field:"meta.title",label:t("menu.menuName"),slots:{default:a=>{const e=a.row.meta.title;return s(m,null,[t(e)])}}},{field:"meta.classifyName",label:t("device.classifyName"),slots:{default:a=>{const e=a.row.meta.classifyName;return s(m,null,[t(e)])}}},{field:"meta.icon",label:t("menu.icon"),slots:{default:a=>{const e=a.row.meta.icon;return e?s(m,null,[s(P,{icon:e},null)]):null}}},{field:"meta.permission",label:t("menu.permission"),slots:{default:a=>{const e=a.row.permissionList;if(!e||Object.keys(e).length===0)return null;const i=Array.isArray(e)?e:[e];return s(m,null,[i.map((r,n)=>s("span",{key:n},[t(r.label),n<i.length-1&&", "]))])}}},{field:"component",label:t("menu.component"),slots:{default:a=>{const e=a.row.component;return s(m,null,[e==="#"?t("device.topDirectory"):e==="##"?t("device.subDirectory"):e])}}},{field:"path",label:t("menu.path")},{field:"status",label:t("menu.status"),slots:{default:a=>s(m,null,[s(q,{type:a.row.status===1?"success":"danger"},{default:()=>[a.row.status===1?t("userDemo.enable"):t("userDemo.disable")]})])}},{field:"action",label:t("userDemo.action"),width:240,slots:{default:a=>{let e,i;const r=a.row;return s(m,null,[s(_,{permission:"Edit"},{default:()=>[s(N("el-button"),{type:"primary",text:!0,onClick:()=>D(r,"edit"),disabled:r.type===1||r.type===0},M(e=t("exampleDemo.edit"))?e:{default:()=>[e]})]}),s(_,{permission:"Delete"},{default:()=>[s(N("el-button"),{type:"danger",text:!0,onClick:()=>D(r,"del"),disabled:r.type===1||r.type===0},M(i=t("exampleDemo.del"))?i:{default:()=>[i]})]})])}}}]);w([{field:"meta.title",label:t("menu.menuName"),component:"Input"}]),l({});const p=l(!1),g=l(""),v=l(),d=l(""),L=l(),B=l(!1),E=()=>{p.value=!1},D=async(a,e)=>{if(e==="del"){Q.confirm(t("common.delMessage"),t("common.delWarning"),{confirmButtonText:t("common.ok"),cancelButtonText:t("common.cancel"),type:"warning"}).then(()=>{j({id:a.id}).then(i=>{i.code===200&&(u({type:"success",message:t("device.operationSuccess")}),y())}).catch(i=>{console.error("删除失败",i),u({type:"error",message:t("device.operationFailed")})})}).catch(()=>{u({type:"info",message:t("device.operationCancelled")})});return}g.value=t(e==="edit"?"exampleDemo.edit":"exampleDemo.detail"),d.value=e,v.value=a,p.value=!0},R=()=>{g.value=t("exampleDemo.add"),v.value=void 0,p.value=!0,d.value="add"},$=async()=>{const a=o(L),e=await a?.submit();if(d.value==="add"){e.permissionList&&(e.meta.permission=e.permissionList.map(n=>n.value)),(e.type==0||e.type==3)&&(e.meta.alwaysShow=!0),e.type==3&&(e.meta.isScada=!0);let i={};if(e.type==2||e.type==3){let n="";e.meta.isScada?n=e?.type==3?"":"/preview/"+e?.page:n=e?.type==3?"":"preview/"+e?.page,e.meta.icon="svg-icon:pages",i={priority:e?.priority,path:n,component:e?.type==3?"#":"views/Scada/Scada",redirect:e?.redirect?e?.redirect:"",name:e?.meta.title,meta:JSON.stringify(e?.meta),status:e?.status,type:e?.type,permissionList:JSON.stringify(e?.permissionList),parentId:e?.parentId}}else(e.type==0||e.type==1)&&(i={path:e?.path?e?.path:"",component:e?.component,name:e?.name,meta:JSON.stringify(e?.meta),redirect:e?.redirect?e?.redirect:"",status:e?.status,type:e?.type,permissionList:JSON.stringify(e?.permissionList),priority:e?.priority,parentId:e?.parentId});(await H(i)).code===200&&(p.value=!1,u.success(t("device.saveSuccessMenuTakeEffectAfterLogin")),y())}else if(d.value==="edit"){e.permissionList&&(e.meta.permission=e.permissionList.map(n=>n.value));let i={};if(e.type==2||e.type==3){let n="";e.meta.isScada?n=e?.type==3?"":"/preview/"+e?.page:n=e?.type==3?"":"preview/"+e?.page,i={id:e?.id,path:n,component:e?.type==3?"#":"views/Scada/Scada",redirect:"",priority:e?.priority,name:e?.meta.title,meta:JSON.stringify(e?.meta),status:e?.status,type:e?.type,permissionList:JSON.stringify(e?.permissionList),parentId:e?.parentId}}else i={id:e?.id,path:e?.path?e?.path:"",component:e?.component,name:e?.name,meta:JSON.stringify(e?.meta),redirect:e?.redirect?e?.redirect:"",status:e?.status,type:e?.type,permissionList:JSON.stringify(e?.permissionList),priority:e?.priority,parentId:e?.parentId};(await z(i)).code===200&&(p.value=!1,u.success(t("device.saveSuccessMenuTakeEffectAfterLogin")),y())}};return w({password:""}),(a,e)=>(h(),ae(m,null,[s(o(X),null,{default:c(()=>[ie("div",oe,[s(o(_),{permission:"Create"},{default:c(()=>[s(o(b),{type:"primary",onClick:R,icon:o(Y)},{default:c(()=>[x(S(o(t)("device.create")),1)]),_:1},8,["icon"])]),_:1})]),s(o(W),{columns:J,"default-expand-all":"","node-key":"id",data:o(V),loading:o(T),onRegister:o(A)},null,8,["columns","data","loading","onRegister"])]),_:1}),s(o(Z),{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=i=>p.value=i),title:g.value,maxHeight:"400px","body-style":{padding:"0"}},{footer:c(()=>[d.value!=="detail"?(h(),k(o(b),{key:0,type:"primary",loading:B.value,onClick:$},{default:c(()=>[x(S(o(t)("exampleDemo.save")),1)]),_:1},8,["loading"])):I("",!0),s(o(b),{onClick:E},{default:c(()=>[x(S(o(t)("dialogDemo.close")),1)]),_:1})]),default:c(()=>[d.value!=="detail"?(h(),k(ee,{key:0,ref_key:"writeRef",ref:L,"current-row":v.value},null,8,["current-row"])):I("",!0)]),_:1},8,["modelValue","title"])],64))}}),Be=U(ne,[["__scopeId","data-v-79c246a7"]]);export{Be as default};
