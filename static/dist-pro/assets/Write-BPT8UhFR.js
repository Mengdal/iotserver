import{F as _}from"./Form-CzZbC4Aj.js";import{u as E}from"./useForm-CD85wrwf.js";import{u as L}from"./useValidator-Barz9SCp.js";import{c as N,j as V}from"./index-CAdyeJt3.js";/* empty css                *//* empty css                */import"./el-checkbox-group-Cm0j4lwI.js";import{g as I}from"./index-5XhoBoFQ.js";import{e as f,f as M}from"./tree-R6XTZANN.js";import{w as P,x as T,y as j}from"./element-plus--V1NSjC4.js";import{x as B,r as c,P as s,u as o,O as G,X as K,w as O,y as S,G as q,n as A}from"./vue-chunks-C1K3ngR7.js";/* empty css               *//* empty css                  *//* empty css               *//* empty css                       *//* empty css                  */import"./Highlight.vue_vue_type_script_lang-BYSr0XZy.js";import"./wang-editor-Bckixh16.js";import"./index-DfycOL0q.js";const ce=B({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(h,{expose:x}){const{t:i}=N(),{required:u}=L(),p=h,d=c(),g=c([{field:"roleName",label:i("role.roleName"),component:"Input"},{field:"status",label:i("menu.status"),component:"Select",componentProps:{options:[{label:i("userDemo.disable"),value:0},{label:i("userDemo.enable"),value:1}]}},{field:"menu",label:i("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>s(G,null,[s("div",{class:"flex w-full"},[s("div",{class:"flex-1"},[s(P,{ref:d,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"check-strictly":!0,"expand-on-click-node":!1,data:l.value,"onNode-click":k},{default:e=>s("span",null,[e.data.meta.title])})]),s("div",{class:"flex-1"},[o(r)&&o(r)?.permissionList?s(T,{modelValue:o(r).meta.permission,"onUpdate:modelValue":e=>o(r).meta.permission=e},{default:()=>[o(r)?.permissionList.map(e=>s(j,{label:e.value},{default:()=>[e.label]}))]}):null])])])}}}]),r=c(),k=e=>{r.value=e},b=K({roleName:[u()],role:[u()],status:[u()]}),{formRegister:w,formMethods:v}=E(),{setValues:y,getFormData:F,getElFormExpose:R}=v,l=c([]);(async()=>{const e=await I();if(e){if(l.value=e.data.list,!p.currentRow)return;await A();const a=[];f(p.currentRow.menu,t=>{a.push({id:t.id,permission:t.meta?.permission||[]})}),f(l.value,t=>{const m=V(a,n=>n.id===t.id);if(m>-1){const n={...t.meta||{}};n.permission=a[m].permission,t.meta=n}});for(const t of a)o(d)?.setChecked(t.id,!0,!1)}})();const C=async()=>{if(await(await R())?.validate().catch(t=>{})){const t=await F(),m=o(d)?.getCheckedKeys()||[],n=M(o(l),D=>m.includes(D.id));return t.menu=n||[],t}};return O(()=>p.currentRow,e=>{e&&y(e)},{deep:!0,immediate:!0}),x({submit:C}),(e,a)=>(S(),q(o(_),{rules:b,onRegister:o(w),schema:g.value},null,8,["rules","onRegister","schema"]))}});export{ce as default};
